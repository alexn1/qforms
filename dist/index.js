!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("qforms",[],t):"object"==typeof exports?exports.qforms=t():e.qforms=t()}(global,(()=>(()=>{var __webpack_modules__={9641:()=>{},7063:()=>{},6672:()=>{},9448:()=>{},7992:()=>{},4194:()=>{},854:()=>{},4454:()=>{},2180:()=>{},4548:()=>{},641:()=>{},7703:()=>{},3526:()=>{},7369:()=>{},6461:()=>{},4429:()=>{},1001:()=>{},2770:()=>{},4820:()=>{},6312:()=>{},3767:()=>{},1118:()=>{},3078:()=>{},7333:()=>{},4533:()=>{},2201:()=>{},9606:()=>{},7951:()=>{},6029:()=>{},9708:()=>{},1695:()=>{},8287:()=>{},947:()=>{},1211:()=>{},4202:()=>{},6215:()=>{},2433:()=>{},6564:()=>{},2453:()=>{},4909:()=>{},5781:()=>{},1850:()=>{},2963:()=>{},6558:()=>{},2806:()=>{},7231:()=>{},9784:()=>{},6159:()=>{},949:()=>{},2287:()=>{},4091:()=>{},9820:()=>{},4502:()=>{},6850:()=>{},2625:()=>{},4804:()=>{},7401:()=>{},2016:()=>{},2876:()=>{},1290:()=>{},237:()=>{},618:()=>{},6224:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Result=t.DatabaseResult=t.TableResult=t.UpdateEx=t.UpdateResult=t.InsertExResult=void 0;class InsertExResult{}t.InsertExResult=InsertExResult;class UpdateResult{}t.UpdateResult=UpdateResult;class UpdateEx{}t.UpdateEx=UpdateEx;class TableResult{}t.TableResult=TableResult;class DatabaseResult{}t.DatabaseResult=DatabaseResult;t.Result=class Result{static addInsertToResult(e,t,s,r){e[t]||(e[t]=new DatabaseResult),e[t][s]||(e[t][s]=new TableResult),e[t][s].insert||(e[t][s].insert=[]),e[t][s].insert.push(r)}static addInsertExToResult(e,t,s,r,o){e[t]||(e[t]=new DatabaseResult),e[t][s]||(e[t][s]=new TableResult),e[t][s].insertEx||(e[t][s].insertEx=new InsertExResult),e[t][s].insertEx[r]=o}static addUpdateToResult(e,t,s,r,o){e[t]||(e[t]=new DatabaseResult),e[t][s]||(e[t][s]=new TableResult),e[t][s].update||(e[t][s].update=new UpdateResult),e[t][s].update[r]=o}static addUpdateExToResult(e,t,s,r,o){e[t]||(e[t]=new DatabaseResult),e[t][s]||(e[t][s]=new TableResult),e[t][s].updateEx||(e[t][s].updateEx=new UpdateEx),e[t][s].updateEx[r]=o}static addDeleteToResult(e,t,s,r){e[t]||(e[t]=new DatabaseResult),e[t][s]||(e[t][s]=new TableResult),e[t][s].delete||(e[t][s].delete=[]),e[t][s].delete.push(r)}static addTableToResult(e,t,s,r){if(e[t]||(e[t]={}),e[t][s])throw new Error(`table ${s} already exists`);e[t][s]=r}}},7722:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3307:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BackHostApp=void 0;const o=r(s(3685)),i=r(s(6860)),a=r(s(3211)),n=r(s(7147)),l=r(s(1017)),c=r(s(3986)),d=r(s(9710)),u=r(s(6508)),h=s(3745),g=s(9918),p=s(111),m=s(3874),w=s(2469),f=s(5637),b=s(1937),C=s(80),y=s(2527),v=s(4795),F=s(1784),D=s(8491),_=s(3443),P=s(1349),x=s(8978),j=s(4147),k=l.default.join(__dirname,"backend"),E=process.env.APPS_DIR_PATH||"./apps",O=process.env.LISTEN_HOST||"localhost",M=process.env.LISTEN_PORT&&parseInt(process.env.LISTEN_PORT)||7e3;class BackHostApp{constructor(e={}){this.params=e,this.applications={},this.createAppQueue={},this.startTime=new Date}async init(){(0,x.debug)("BackHostApp.init"),this.checkNodeVersion(),this.initDirPaths(),this.checkApplicationFolder(),this.createTempDirsIfNotExistSync(),this.createEventLog(),this.initExpressServer(),await this.initModules(),await this.initHttpServer()}async run(){(0,x.debug)(`${this.constructor.name}.run`),await BackHostApp.runHttpServer(this.httpServer,this.getHost(),this.getPort()),this.httpServer.on("error",this.onHttpServerError.bind(this)),this.initWebSocketServer(),this.listenProcessEvents(),(0,x.log)(this.composeStartMessage(this.getHost(),this.getPort()))}getHost(){return this.params.host||O}getPort(){return this.params.port||M}async initHttpServer(){this.httpServer=o.default.createServer(this.express)}checkNodeVersion(){const[e]=process.versions.node.split(".");if(parseInt(e)<14)throw new Error(`min node version required 14, current ${e}`)}checkApplicationFolder(){if(!n.default.existsSync(this.appsDirPath))throw new Error(`Application folder '${this.appsDirPath}' doesn't exist`)}createTempDirsIfNotExistSync(){g.BkHelper.createDirIfNotExistsSync(this.runtimeDirPath),g.BkHelper.createDirIfNotExistsSync(this.sessionDirPath)}createEventLog(){this.eventLog=new _.EventLog(this.params.logger)}async initModules(){this.indexModule=new f.IndexModule(this),await this.indexModule.init(),this.monitorModule=new w.MonitorModule(this),await this.monitorModule.init(),this.viewerModule=new C.ViewerModule(this),await this.viewerModule.init(),this.editorModule=new y.EditorModule(this),await this.editorModule.init()}initWebSocketServer(){this.wsServer=new h.WebSocketServer({hostApp:this,httpServer:this.httpServer})}initDirPaths(){this.appsDirPath=l.default.resolve(this.params.appsDirPath||E),this.distDirPath=this.params.distDirPath||this.appsDirPath,this.backendDirPath=k,this.frontendDirPath=l.default.resolve(l.default.join(k,"../frontend")),this.runtimeDirPath=l.default.resolve(this.params.runtimeDirPath||"./runtime"),this.sessionDirPath=l.default.join(this.runtimeDirPath,"session")}composeStartMessage(e,t){let s="\n";return s+=`NODE_ENV=${process.env.NODE_ENV}\n`,s+=`QFORMS_LOG_LEVEL=${process.env.QFORMS_LOG_LEVEL}\n`,s+="\n",s+=`QForms server v${j.version} listening on http://${e}:${t}${this.isDevelopment()?"/index2":""}\n`,s+=`\tcwd: ${process.cwd()}\n`,s+=`\tappsDirPath: ${this.appsDirPath}\n`,s+=`\tdistDirPath: ${this.distDirPath}\n`,s+=`\tbackendDirPath: ${this.backendDirPath}\n`,s+=`\tfrontendDirPath: ${this.frontendDirPath}\n`,s+=`\truntimeDirPath: ${this.runtimeDirPath}\n`,s+=`\tsessionDirPath: ${this.sessionDirPath}\n`,this.isDevelopment()&&(s+=`\tmonitor: http://${e}:${t}/monitor\n`),s+=`\tstarted at: ${(new Date).toISOString()}\n`,s}listenProcessEvents(){process.on("message",this.onProcessMessage.bind(this)),process.on("SIGINT",this.onProcessSIGINT.bind(this)),process.on("SIGTERM",this.onProcessSIGTERM.bind(this)),process.on("exit",this.onProcessExit.bind(this)),process.on("uncaughtException",this.onUncaughtException.bind(this)),process.on("unhandledRejection",this.onUnhandledRejection.bind(this))}getSecretSync(){const e=l.default.join(this.runtimeDirPath,"secret.txt");let t;return t=g.BkHelper.getFileContentSync(e),t||(t=g.BkHelper.getRandomString(20),g.BkHelper.writeFileSync(e,t),t)}initExpressServer(){this.express=(0,i.default)(),this.express.set("handleException",this.params.handleException||!0),this.express.enable("strict routing"),this.express.use(c.default.json({limit:"20mb",reviver:g.BkHelper.dateTimeReviver})),this.express.use(c.default.urlencoded({extended:!1})),this.express.use((0,d.default)()),this.express.use((0,u.default)({store:new v.FileSessionStore(this.sessionDirPath),secret:this.getSecretSync(),key:"sid",resave:!1,saveUninitialized:!1})),this.express.options("/error",((e,t,s)=>{(0,x.log)("options /error"),t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Content-Type, Content-Length"),t.end()})),this.express.post("/error",this.postError.bind(this)),this.isDevelopment()&&(this.express.get("/index2",this.indexGet.bind(this)),this.express.post("/index2",this.indexPost.bind(this))),this.express.get("/monitor",this.monitorGet.bind(this)),this.express.get("/:module/:appDirName/:appFileName/:env/:domain/",this.moduleGet.bind(this)),this.express.post("/:module/:appDirName/:appFileName/:env/:domain/",this.modulePost.bind(this)),this.express.get("/:module/:appDirName/:appFileName/:env/:domain/*",this.moduleGetFile.bind(this)),this.express.use(i.default.static(this.frontendDirPath,{setHeaders:(e,t,s)=>{(0,x.log)(`static: /${l.default.relative(this.frontendDirPath,t)} ${e.statusCode}`)}})),this.initCustomRoutes(),this.express.use(this._e404.bind(this)),this.express.use(this._e500.bind(this))}async createApplicationIfNotExists(e){const t=this.applications[e.getRoute()];if(t)return t;if(Array.isArray(this.createAppQueue[e.getRoute()])){(0,x.debug)("application is creating:",e.getRoute());const t=P.EmptyPromise.create();return this.createAppQueue[e.getRoute()].push(t),t}this.createAppQueue[e.getRoute()]=[];try{const t=this.applications[e.getRoute()]=await this.createApplication(e);(0,x.debug)("application created, start resolve loop",e.getRoute(),this.createAppQueue[e.getRoute()].length);for(const s of this.createAppQueue[e.getRoute()])s.resolve(t);return t}catch(t){(0,x.error)("application not created, start reject loop",e.getRoute(),this.createAppQueue[e.getRoute()].length);for(const s of this.createAppQueue[e.getRoute()])s.reject(t);throw t}finally{this.createAppQueue[e.getRoute()]=null}}getApplication(e){const t=this.applications[e.getRoute()];if(!t)throw new Error(`no application for route: ${e.getRoute()}`);return t}getApplicationByRoute(e){return this.applications[e]}getAppFilePath(e){return l.default.join(this.appsDirPath,e.getAppDirName(),e.getAppFileName()+".json")}async createApplication(e){(0,x.debug)(`BackHostApp.createApplication: ${e.getRoute()}`);const t=this.getAppFilePath(e),s=this.makeDistDirPathForApp(t),r=await m.BkApplication.loadAppInfo(t,s),o=new(this.getApplicationClass(r))(r,this,e.getEnv());return await o.init(e),o}getApplicationClass(e){const t=D.BaseModel.getAttr(e.appFile.data,"modelClass");if(t){const e=global[t];if(!e)throw new Error(`no class ${t}`);return e}return m.BkApplication}async createApp(e){if((0,x.debug)("BackHostApp.createApp"),!e.body.folder)throw new Error("folder required: "+e.body.folder);if(!e.body.name)throw new Error("name required: "+e.body.name);const t=e.body.folder,s=e.body.name,r=l.default.join(this.appsDirPath,t),o=l.default.join(r,s+".json");await g.BkHelper.createDirIfNotExists(r),await F.ApplicationEditor.createAppFile(o,{name:s});const i=this.makeDistDirPathForApp(o);return await m.BkApplication.getAppInfos(this.appsDirPath,i)}composeContextData(e,t){const s=e instanceof b.HttpError&&e.context?e.context.getRoute():null;return{headers:t.headers,method:t.method,host:t.headers.host,originalUrl:t.originalUrl,uri:t.params[0],platformVersion:j.version,appVersion:s?this.applications[s].getVersion():null,route:s,body:t.body,status:e instanceof b.HttpError&&e.status||null,data:e instanceof b.HttpError&&e.data||null}}async logError(e,t){(0,x.log)("BackHostApp.logError:",a.default.red(e.message));try{await this.eventLog.log({type:"error",source:"server",message:e.message,stack:e.stack,data:t&&JSON.stringify(this.composeContextData(e,t),null,4),ip:t&&p.Context.getIpFromReq(t)})}catch(e){(0,x.error)(a.default.red(e))}}async logEvent(e,t,s){(0,x.log)("BackHostApp.logEvent",t);try{await this.eventLog.log({type:"log",source:"server",message:t,data:s&&JSON.stringify(s,null,4),ip:e.getIp()})}catch(e){(0,x.error)(a.default.red(e))}}async indexGet(e,t,s){(0,x.log)(a.default.magenta("indexGet"));try{const e=await this.indexModule.render();t.end(e)}catch(e){s(e)}}async indexPost(e,t,s){(0,x.log)(a.default.magenta("indexPost"),e.params);try{const s=await this.createApp(e);t.json({appInfos:s.map((e=>({fullName:e.fullName,envs:e.envs})))})}catch(e){s(e)}}async monitorGet(e,t,s){(0,x.log)(a.default.magenta("monitorGet"),e.headers);try{if(!this.params.monitor)return void t.end("Please set monitor username/password in app params");if(this.monitorModule.authorize(e)){const e=this.monitorModule.render();t.end(e)}else t.statusCode=401,t.setHeader("WWW-Authenticate",'Basic realm="My Realm"'),t.end("Unauthorized")}catch(e){s(e)}}async moduleGet(e,t,s){(0,x.log)(a.default.magenta.underline("GET"),`${e.params.module}/${e.params.appDirName}/${e.params.appFileName}/${e.params.env}/${e.params.domain}`);let r=null;try{if("viewer"===e.params.module){r=new p.Context({req:e,res:t,domain:this.getDomainFromRequest(e)});const o=await this.createApplicationIfNotExists(r);o.isAvailable()?await this.viewerModule.handleGet(r,o):s()}else"editor"===e.params.module&&this.isDevelopment()?(r=new p.Context({req:e,res:t,domain:this.getDomainFromRequest(e)}),await this.editorModule.handleEditorGet(e,t,r)):s()}catch(e){s(e)}finally{r&&r.destroy()}}async modulePost(e,t,s){(0,x.debug)(a.default.magenta.underline("BackHostApp.modulePost"),e.params,e.body),(0,x.log)(a.default.magenta.underline("POST"),`${e.params.module}/${e.params.appDirName}/${e.params.appFileName}/${e.params.env}/${e.params.domain}`,`${e.body.page}.${e.body.form}.${e.body.ds}.${e.body.action}`);let r=null;try{if("viewer"===e.params.module){r=new p.Context({req:e,res:t,domain:this.getDomainFromRequest(e)});const s=await this.createApplicationIfNotExists(r);await this.viewerModule.handlePost(r,s)}else if("editor"===e.params.module)if(this.isDevelopment()){r=new p.Context({req:e,res:t,domain:this.getDomainFromRequest(e)});await this.editorModule.handleEditorPost(e,t,r)}else s();else s()}catch(e){s(e)}finally{r&&r.destroy()}}async moduleGetFile(e,t,s){if((0,x.debug)(a.default.magenta.underline("BackHostApp.moduleGetFile"),e.originalUrl),(0,x.log)(a.default.magenta.underline("GET"),e.originalUrl),"viewer"===e.params.module){let r=null;try{r=new p.Context({req:e,res:t,domain:this.getDomainFromRequest(e)});const o=await this.createApplicationIfNotExists(r);await this.viewerModule.handleGetFile(r,o,s)}catch(e){e.message=`moduleGetFile error: ${e.message}`,s(e)}finally{r&&r.destroy()}}else s()}async _e404(e,t,s){(0,x.debug)(a.default.magenta(e.method),"error/404",e.originalUrl),s(new b.HttpError({message:`${e.method} ${e.originalUrl} not found`,status:404}))}async _e500(e,t,s,r){(0,x.debug)(a.default.magenta("module.exports.e500:"),t.method,t.originalUrl,e),(0,x.log)(a.default.red(e.message));const o="string"==typeof e?new b.HttpError({message:e}):e;if(s.status(o.status||500),t.headers["content-type"]&&-1!==t.headers["content-type"].indexOf("application/json"))s.end(this.isDevelopment()||404===o.status?o.message:"Internal Software Error");else{const e=o.status||500,t=this.isDevelopment()||404===o.status?o.message:"Internal Software Error",r=this.isDevelopment()&&404!==o.status?o.stack:"";s.end(`<!DOCTYPE html>\n<html>\n<title>${e} ${t}</title>\n<body>\n    <h1>${t}</h1>\n    <h2>${e}</h2>\n    <pre>${r}</pre>\n</body>\n</html>`)}await this.logError(o,t)}static runHttpServer(e,t,s){return new Promise(((r,o)=>{try{const i=t=>{(0,x.error)("tempErrorHandler",t),e.off("error",i),o(t)};e.on("error",i),e.listen(s,t,(()=>{e.off("error",i),r()}))}catch(e){o(e)}}))}async onProcessMessage(e){if((0,x.log)("BackHostApp.onProcessMessage"),"shutdown"===e){try{await this.shutdown()}catch(e){(0,x.error)("shutdown error:",e.message)}process.exit(0)}}async onProcessSIGINT(){(0,x.debug)("BackHostApp.onProcessSIGINT"),(0,x.log)(" Received INT signal (Ctrl+C), shutting down gracefully...");try{await this.shutdown(),process.exit(0)}catch(e){(0,x.error)("shutdown error:",e.message),process.exit(1)}}async onProcessSIGTERM(){(0,x.debug)("BackHostApp.onProcessSIGTERM"),(0,x.log)("Received SIGTERM (kill) signal, shutting down forcefully.");try{await this.shutdown(),process.exit(0)}catch(e){(0,x.error)("shutdown error:",e.message),process.exit(1)}}onProcessExit(e){(0,x.debug)("BackHostApp.onProcessExit:",e),(0,x.log)("exit:",e)}async onUncaughtException(e,t){(0,x.error)(a.default.red("BackHostApp.onUncaughtException"),e),e.message=`uncaughtException: ${e.message}`,await this.logError(e)}async onUnhandledRejection(e,t){(0,x.error)(a.default.red("BackHostApp.onUnhandledRejection"),e),e.message=`unhandledRejection: ${e.message}`,await this.logError(e)}async shutdown(){(0,x.debug)("BackHostApp.shutdown");const e=Object.keys(this.applications);for(let t=0;t<e.length;t++){const s=e[t],r=this.applications[s];await r.deinit()}}onHttpServerError(e){(0,x.error)(a.default.red("BackHostApp.onHttpServerError"),e.code,e.message)}getDomainFromRequest(e){if(!e)throw new Error("need req param");const t=e.headers.host;if(!t)throw new Error("no host");const[s,r]=t.split(":"),[o]=s.split(".");if(!o)throw new Error("trouble getting a domain");return o}async postError(e,t,s){(0,x.debug)(a.default.blue("BackHostApp.postError"),e.body.message),(0,x.log)("client error:",a.default.red(e.body.message));try{const s=JSON.stringify({headers:e.headers,domain:this.getDomainFromRequest(e)},null,4);await this.eventLog.log({type:e.body.type,source:e.body.source,message:e.body.message,stack:e.body.stack,data:`${e.body.data}\n${s}`,ip:e.body.ip||p.Context.getIpFromReq(e)}),t.header("Access-Control-Allow-Origin","*"),t.end("ok")}catch(e){s(e)}}getFrontendDirPath(){return this.frontendDirPath}initCustomRoutes(){}alias(e,t,[s,r,o,i,a],n,l){this.express[e](t,(async(e,t,c)=>{if(e.params.module=s,e.params.appDirName=r,e.params.appFileName=o,i&&(e.params.env=i),a&&(e.params.domain=a),l)for(const t in l)e.query[t]=l[t]?l[t]:e.params[t];await this[n](e,t,c)}))}getPostAlias(e,t,s){this.alias("get",e,t,"moduleGet",s),this.alias("post",e,t,"modulePost",s)}getNodeEnv(){return process.env.NODE_ENV||null}isDevelopment(){return"development"===this.getNodeEnv()}isProduction(){return!this.isDevelopment()}getParams(){return this.params}broadcastResult(e,t,s){(0,x.debug)("BackHostApp.broadcastResult");for(const r in this.applications)if(t.getRoute()===r&&this.applications[r]===e)e.broadcastDomesticResultToClients(t,s);else{this.applications[r].broadcastForeignResultToClients(t,s)}}static test(){(0,x.debug)("BackHostApp.test")}getDistDirPath(){return this.distDirPath}makeDistDirPathForApp(e){const t=l.default.basename(l.default.dirname(e));return l.default.join(this.getDistDirPath(),t)}getLogger(){return this.eventLog}getFrontLogUrl(){return this.params.frontLogUrl}}t.BackHostApp=BackHostApp},8491:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0;class BaseModel{constructor(e,t){if(this.data=e,this.parent=t,!e)throw new Error(`new ${this.constructor.name}: no data`)}static getClassName(e){return e["@class"]}static getAttr(e,t){return e["@attributes"][t]}static getName(e){return BaseModel.getAttr(e,"name")}getClassName(){return this.data["@class"]}getName(){return BaseModel.getName(this.data)}static attributes(e){return e["@attributes"]}attributes(){return this.data["@attributes"]}getAttr(e){if(!this.isAttr(e))throw new Error(`no attribute '${e}'`);return this.data["@attributes"][e]}setAttr(e,t){this.data["@attributes"][e]=t}isAttr(e){return void 0!==this.data["@attributes"][e]}isData(e,t){if(!e)throw new Error("isData: no colName");if(!t)throw new Error("isData: no name");return!!this.getColItemData(e,t)}getData(){return this.data}getCol(e){if(!e)throw new Error("getCol: no name");const t=this.data[e];if(!t)throw new Error(`getCol: no col ${e}`);return t}getItemNames(e){return this.getCol(e).map((e=>BaseModel.getName(e)))}getColItemData(e,t){const s=BaseModel.findColDataByName(this.getCol(e),t);return s||null}removeColData(e,t){const s=this.getCol(e),r=BaseModel.findColDataByName(s,t);if(!r)throw new Error(`removeColData: no ${t} in ${e}`);return s.splice(s.indexOf(r),1),r}static findColDataByName(e,t){return e.find((e=>BaseModel.getName(e)===t))}addModelData(e,t){const s=BaseModel.getName(t);if(this.getColItemData(e,s))throw new Error(`${s} already exists in ${e}`);this.getCol(e).push(t)}getApp(){throw new Error("getApp: not implemented")}replaceDataColItem(e,t,s){const r=this.getCol(e),o=r.indexOf(t);if(-1===o)throw new Error(`replaceDataColItem: no ${BaseModel.getName(t)} in ${e}`);return r[o]=s,o}getParent(){if(!this.parent)throw new Error("no parent");return this.parent}}t.BaseModel=BaseModel},9918:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BkHelper=void 0;const o=r(s(7147)),i=r(s(4230)),a=r(s(1017)),n=r(s(2488)),l=r(s(3211)),c=r(s(4809)),d=s(8978);function u(e,t){const s=i.default.sync(a.default.join(e,"*."+t));return i.default.sync(a.default.join(e,"*/")).forEach((e=>{u(e,t).forEach((e=>{s.push(e)}))})),s}async function h(e,t,s){(await BkHelper._glob(a.default.join(e,"*."+t))).forEach((e=>{s.push(e)}));const r=await BkHelper._glob(a.default.join(e,"*/"));for(let e=0;e<r.length;e++){const o=r[e];await h(o,t,s)}}class BkHelper{static getRandomString(e){const t="abcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let i=0;i<e;i++){const e=(r=0,o=t.length-1,Math.floor(Math.random()*(o-r+1))+r);s+=t.substr(e,1)}var r,o;return s}static getFilePathsSync(e,t,s){return u(a.default.join(e,t),s).map((t=>(0,n.default)(a.default.relative(e,t))))}static _glob(e){return new Promise(((t,s)=>{(0,i.default)(e,((e,r)=>{e?s(e):t(r)}))}))}static async getFilePaths(e,t){const s=[];await h(e,t,s);return s.map((t=>(0,n.default)(a.default.relative(e,t))))}static currentTime(){const e=new Date,t=[e.getHours(),e.getMinutes(),e.getSeconds()],s=t.map((e=>e.toString()));for(let e=0;e<t.length;e++)t[e]<10&&(s[e]="0"+s[e]);return s.join(":")}static templateToJsString(e,t){return e.replace(/\$\{([\w.@]+)\}/g,((e,s)=>Object.prototype.hasOwnProperty.call(t,s)?`BkHelper.decodeValue('${BkHelper.encodeValue(t[s])}')`:"undefined"))}static readTextFile(e){return new Promise(((t,s)=>{o.default.readFile(e,"utf8",((e,r)=>{e?s(e):t(r)}))}))}static async getFileContent(e){return await BkHelper.exists(e)?BkHelper.readTextFile(e):null}static getFileContentSync(e){return o.default.existsSync(e)?o.default.readFileSync(e,"utf8"):null}static readBinaryFile(e){return(0,d.debug)(l.default.blue("BkHelper.readBinaryFile"),e),new Promise(((t,s)=>{o.default.readFile(e,((e,r)=>{e?s(e):t(r)}))}))}static createPath(e){if(0===e.length)throw new Error("no path elements");return 1===e.length?"/":e.join("/")}static getDirPath(e){const t=e.split("/");return BkHelper.createPath(t.slice(0,t.length-1))}static async createDirIfNotExists2(e){const t=e.split("/");for(let e=1;e<=t.length;e++){const s=BkHelper.createPath(t.slice(0,e));await BkHelper.exists(s)||await BkHelper.createDirIfNotExists(s)}}static createDirIfNotExists(e){return(0,d.debug)(l.default.blue("BkHelper.createDirIfNotExists"),e),new Promise(((t,s)=>{o.default.exists(e,(r=>{r?t():o.default.mkdir(e,(e=>{e?s(e):t()}))}))}))}static createDirIfNotExistsSync(e){o.default.existsSync(e)||o.default.mkdirSync(e)}static moveArrItem(e,t,s){const r=e.indexOf(t);if(-1===r)throw new Error("cannot find element");const o=r+s;if(o<0)throw new Error("cannot up top element");if(o>e.length-1)throw new Error("cannot down bottom element");e.splice(o,0,e.splice(r,1)[0])}static copyFile3(e,t){return new Promise(((s,r)=>{const i=o.default.createReadStream(e);i.on("error",(e=>{r(e)}));const a=o.default.createWriteStream(t);a.on("error",(e=>{r(e)})),a.on("close",(()=>{s()})),i.pipe(a)}))}static exists(e){return new Promise((t=>{o.default.exists(e,(e=>{t(e)}))}))}static writeFile(e,t){return(0,d.debug)(l.default.blue("BkHelper.writeFile"),e),new Promise(((s,r)=>{o.default.writeFile(e,t,"utf8",(e=>{e?r(e):s()}))}))}static writeFileSync(e,t){return(0,d.debug)(l.default.blue("BkHelper.writeFileSync"),e),o.default.writeFileSync(e,t,"utf8")}static async writeFile2(e,t){const s=BkHelper.getDirPath(e);return await BkHelper.createDirIfNotExists2(s),await BkHelper.writeFile(e,t)}static mapObject(e,t){return Object.keys(e).reduce(((s,r)=>{const[o,i]=t(r,e[r]);return s[o]=i,s}),{})}static fsUnlink(e){return new Promise(((t,s)=>{o.default.unlink(e,(e=>{e?s(e):t()}))}))}static today(e){let t=Date.now();null!=e&&(t+=BkHelper.MINUTE()*e);const s=new Date(t);return t=new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime(),null!=e&&(t-=BkHelper.MINUTE()*e),new Date(t)}static dateTimeReviver(e,t){if("string"==typeof t){if(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d{3})?(Z|([+-])(\d{2}):(\d{2}))?$/.exec(t))return new Date(t)}return t}static decodeValue(e){if(void 0===e)throw new Error("decodeValue undefined");if(null===e)throw new Error("decodeValue null");try{return JSON.parse(e,BkHelper.dateTimeReviver)}catch(t){throw new Error(`decodeValue failed: ${e}`)}}static encodeValue(e){return JSON.stringify(e)}static decodeObject(e){const t={};for(const s in e){if("string"!=typeof e[s])throw new Error(`cannot decode: ${s}, type: ${typeof e[s]}`);t[s]=BkHelper.decodeValue(e[s])}return t}static SECOND(){return 1e3}static MINUTE(){return 60*BkHelper.SECOND()}static HOUR(){return 60*BkHelper.MINUTE()}static DAY(){return 24*BkHelper.HOUR()}static WEEK(){return 7*BkHelper.DAY()}static Session_save(e){return new Promise(((t,s)=>{e.save((e=>{e?s(e):t()}))}))}static addMinutes(e,t){e.setMinutes(e.getMinutes()+t)}static removeTimezoneOffset(e){BkHelper.addMinutes(e,-e.getTimezoneOffset())}static addTimezoneOffset(e){BkHelper.addMinutes(e,e.getTimezoneOffset())}static cloneDate(e){return new Date(e.getTime())}static fillArray(e){return Array.from(Array(e).keys())}static formatDate(e,t){const s=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),i=e.getHours(),a=e.getMinutes(),n=e.getSeconds(),l={YYYY:s,M:r,D:o,h:i,m:a,s:n,MM:r<10?`0${r}`:r,DD:o<10?`0${o}`:o,hh:i<10?`0${i}`:i,mm:a<10?`0${a}`:a,ss:n<10?`0${n}`:n};return t.replace(/\{([\w.]+)\}/g,((e,t)=>l[t]?l[t]:e))}static getFirstField(e){const[t]=Object.keys(e);if(!t)throw new Error("getFirstField: no fields");return e[t]}static getCommandLineParams(){return process.argv.map((e=>e.split("="))).reduce(((e,[t,s])=>(e[t]=s,e)),{})}static getWebSocketIP(e){return e.upgradeReq.headers["x-real-ip"]?e.upgradeReq.headers["x-real-ip"]:e.upgradeReq.socket.remoteAddress}static getWebSocketPort(e){return e.upgradeReq.headers["x-real-port"]?e.upgradeReq.headers["x-real-port"]:e.upgradeReq.socket.remotePort}static templateArray(e){return e.map((e=>{const t=typeof e;if("number"===t||"boolean"===t)return e;if("string"===t)return`'${e}'`;throw new Error(`wrong type for array item: ${t}`)}))}static test(){(0,d.debug)("BkHelper.test")}static formatNumber(e){return new Intl.NumberFormat("ru-RU").format(e)}static formatTime2(e){let t=e,s="";e<0&&(t=-t,s="-");let r=Math.floor(t/3600),o=Math.floor((t-3600*r)/60),i=Math.floor(t-3600*r-60*o);return r<10&&(r="0"+r),o<10&&(o="0"+o),i<10&&(i="0"+i),0===Math.floor(t/3600)?`${s}${o}m:${i}s`:`${s}${r}h:${o}m:${i}s`}static registerGlobalClass(e){if(global[e.name])throw new Error(`global.${e.name} already used`);global[e.name]=e}static getContentFromDataUrl(e){const[t,s]=e.split(";"),r=t.split(":")[1],o=s.split(",")[1];return[r,Buffer.from(o,"base64")]}static async post(e,t){const s=await(0,c.default)(e,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(s.ok)return await s.json();throw new Error(`${s.status} ${s.statusText}: ${await s.text()}`)}}t.BkHelper=BkHelper,BkHelper.registerGlobalClass(BkHelper)},111:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;class Context{constructor(e={}){if(this.options=e,this.connections={},this.querytime={params:{}},this.query=Object.assign({},this.getReq()&&this.getReq().query?this.getReq().query:{}),this.params=Object.assign({},this.getReq()&&this.getReq().body.params?this.getReq().body.params:{}),this.files={},this.getReq()&&this.getReq().files)for(const e in this.getReq().files)this.files[e]=this.getReq().files[e].buffer}getRoute(){return`${this.getAppDirName()}/${this.getAppFileName()}/${this.getEnv()}/${this.getDomain()}`}getVirtualPath(){return`/${this.getModule()}/${this.getAppDirName()}/${this.getAppFileName()}/${this.getEnv()}/${this.getDomain()}`}getUser(){const e=this.getRoute();return this.getReq().session.user&&this.getReq().session.user[e]?this.getReq().session.user[e]:null}getClientTimezoneOffset(){return void 0!==this.getReq().session.tzOffset&&null!==this.getReq().session.tzOffset?this.getReq().session.tzOffset:null}getTimeOffset(){const e=this.getClientTimezoneOffset();return null!==e?(new Date).getTimezoneOffset()-e:null}getCookies(){return Object.assign({},this.getReq()&&this.getReq().cookies?this.getReq().cookies:{})}getQuery(){return Object.assign({},this.getReq()&&this.getReq().query?this.getReq().query:{})}getParams(){const e=this.getUser(),t=this.getTimeOffset();return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.getCookies()),this.query),this.params),this.querytime?this.querytime.params:{}),e?{userId:e.id,userName:e.name}:{}),null!==t?{timeOffset:t}:{})}getReq(){return this.options.req}getRes(){if(!this.options.res)throw new Error("getRes: no res");return this.options.res}getBody(){return this.getReq().body}getModule(){return this.options.module?this.options.module:this.getReq().params.module}getDomain(){if(this.options.domain)return this.options.domain;if(this.getReq().params.domain)return this.getReq().params.domain;throw new Error("domain not defined")}getAppDirName(){return this.options.appDirName?this.options.appDirName:this.getReq().params.appDirName}getAppFileName(){return this.options.appFileName?this.options.appFileName:this.getReq().params.appFileName}getEnv(){return this.options.env?this.options.env:this.getReq().params.env}getUri(){return this.getReq().params[0]}getIp(){return Context.getIpFromReq(this.getReq())}getHost(){return this.getReq().headers.host}getProtocol(){return this.getReq().headers["x-forwarded-proto"]||"http"}setVersionHeaders(e,t){this.getRes().setHeader("qforms-platform-version",e),t&&this.getRes().setHeader("qforms-app-version",t)}setParam(e,t){this.params[e]=t}getParam(e){return this.getParams()[e]}isDebugMode(){return"1"===this.query.debug}getUrl(){const e=this.getReq(),t=`${e.protocol}://${e.get("host")}${e.originalUrl}`;return new URL(t)}static getIpFromReq(e){return e.headers["x-forwarded-for"]||e.connection.remoteAddress}destroy(){}}t.Context=Context},8759:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Converter=void 0;const o=r(s(1017)),i=s(1177),a=s(1784),n=s(8491),l=s(8978),c=o.default.join(__dirname,"backend");t.Converter=class Converter{static async reformat(e){(0,l.debug)("Convert.reformat",e);const t=new i.JsonFile(e);await t.read();const s=new a.ApplicationEditor(t,o.default.join(c,"editor"));s.reformat(),await s.save();const r=s.getData().pageLinks.map((e=>n.BaseModel.getName(e)));for(const e of r){const t=await s.getPage(e);t.reformat(),await t.save()}}}},1349:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmptyPromise=void 0;class EmptyPromise extends Promise{static create(){let e,t;const s=new EmptyPromise((function(s,r){e=s,t=r}));return s.resolve=e,s.reject=t,s}}t.EmptyPromise=EmptyPromise},3443:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventLog=void 0;const r=s(4411),o=s(9918);t.EventLog=class EventLog{constructor(e){this.pool=(null==e?void 0:e.db)&&r.BkPostgreSqlDatabase.createPool(e.db),this.url=null==e?void 0:e.url}async create(e){if(!this.pool)throw new Error("no pool");await r.BkPostgreSqlDatabase.queryResult(this.pool,"insert into log(created, type, source, message, stack, data, ip) values ({created}, {type}, {source}, {message}, {stack}, {data}, {ip})",{created:new Date,type:e.type,source:e.source,message:e.message&&e.message.substring(0,255),stack:e.stack||null,data:e.data||null,ip:e.ip||null})}async log(e){if(this.pool&&await this.create(e),this.url){return await this.logToEventLog(e)}}async logToEventLog(e){if(!this.url)throw new Error("no url");try{const{_id:t}=await o.BkHelper.post(this.url,e);return t}catch(e){return null}}}},4795:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileSessionStore=void 0;const o=r(s(1017)),i=r(s(6508)),a=s(9918),n=s(8978);class FileSessionStore extends i.default.Store{constructor(e){super(),this.dirPath=e,this.store={}}set(e,t,s){(0,n.debug)("FileSessionStore.set",e,t),this.store[e]=t;const r=o.default.join(this.dirPath,`${e}.json`),i=JSON.stringify(t,null,4);a.BkHelper.writeFile(r,i).then((()=>{s(null)}))}get(e,t){const s=this.store[e];if(s)t(null,s);else{const s=o.default.join(this.dirPath,`${e}.json`);a.BkHelper.getFileContent(s).then((s=>{if(s)try{const r=this.store[e]=JSON.parse(s);t(null,r)}catch(e){t(e)}else t(null,null)}))}}destroy(e,t){(0,n.debug)("FileSessionStore.destroy",e),delete this.store[e],t(null)}}t.FileSessionStore=FileSessionStore},1937:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpError=void 0;class HttpError extends Error{constructor(e){super(e.message),this.context=e.context,this.status=e.status,this.data=e.data}}t.HttpError=HttpError},1177:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonFile=void 0;const r=s(9918),o=s(8491),i=s(8978);t.JsonFile=class JsonFile{constructor(e,t=null){this.filePath=e,this.data=t,this.content=null}async create(){if(await r.BkHelper.exists(this.filePath))throw new Error(`File ${this.filePath} already exists`);this.data||(this.content?this.data=JSON.parse(this.content):this.data={}),this.content=JSON.stringify(this.data,null,4),await r.BkHelper.writeFile2(this.filePath,this.content)}async read(){const e=await r.BkHelper.readTextFile(this.filePath);this.content=e,this.data=JSON.parse(e)}async save(){(0,i.debug)("JsonFile.save",this.filePath),this.content=JSON.stringify(this.data,null,4),await r.BkHelper.writeFile2(this.filePath,this.content)}getAttr(e){const t=o.BaseModel.getAttr(this.data,e);if(void 0===t)throw new Error(`no attribute '${e}'`);return t}}},7317:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Links=void 0;const r=s(997);t.Links=({links:e})=>(0,r.jsx)(r.Fragment,{children:e.map(((e,t)=>"string"==typeof e?(0,r.jsx)("link",{rel:"stylesheet",href:e},t):"object"==typeof e?(0,r.jsx)("link",{rel:e.rel,href:e.href,crossOrigin:e.crossorigin?"anonymous":void 0},t):void 0))})},3024:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scripts=void 0;const r=s(997);t.Scripts=({scripts:e})=>(0,r.jsx)(r.Fragment,{children:e.map(((e,t)=>(0,r.jsx)("script",{type:"text/javascript",src:e},t)))})},3745:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketServer=void 0;const o=r(s(5352)),i=r(s(7310)),a=r(s(3211)),n=s(111),l=s(8978);t.WebSocketServer=class WebSocketServer{constructor(e){this.options=e,this.server=new o.default.Server({server:e.httpServer,path:"/"}),this.server.on("error",this.onError.bind(this)),this.server.on("connection",this.onConnection.bind(this))}async onError(e){(0,l.error)("WebSocketServer.onError",e)}async onConnection(e){(0,l.debug)("WebSocketServer.onConnection",e.upgradeReq.url),(0,l.log)("wss:",a.default.bgYellow(a.default.black(decodeURIComponent(e.upgradeReq.url))));const t=i.default.parse(e.upgradeReq.url,!0);if(!t.query.route)throw new Error("no route");if(!t.query.uuid)throw new Error("no uuid");e.route=t.query.route,e.uuid=t.query.uuid,e.userId=t.query.userId,e.customFields={version:t.query.version},e.on("close",this.onClose.bind(this,e)),e.on("message",this.onMessage.bind(this,e));const[s,r,o,c]=t.query.route.split("/"),d=new n.Context({module:"viewer",appDirName:s,appFileName:r,env:o,domain:c});(await this.getHostApp().createApplicationIfNotExists(d)).addClient(e),e.send(JSON.stringify({type:"info",data:{hello:e.uuid}})),d.destroy()}async onClose(e,t,s){(0,l.debug)("WebSocketServer.onSocketClose",e.route,e.uuid,t,s),this.getHostApp().getApplicationByRoute(e.route).removeClient(e)}async onMessage(e,t,s){(0,l.debug)("WebSocketServer.onMessage",e.route,e.uuid,t,s)}getHostApp(){return this.options.hostApp}}},5346:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionEditor=void 0;const r=s(4655);class ActionEditor extends r.Editor{static createData(e){if(!e.name)throw new Error("no name");return{"@class":"Action","@attributes":{name:e.name,caption:e.caption||e.name}}}getColName(){return"actions"}}t.ActionEditor=ActionEditor},1784:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationEditor=void 0;const o=r(s(1017)),i=s(4655),a=s(9918),n=s(3874),l=s(1177),c=s(506),d=s(8978);class ApplicationEditor extends i.Editor{constructor(e,t){super(e.data,void 0,t),this.appFile=e,this.appInfo=n.BkApplication.makeAppInfoFromAppFile(e)}getAppFile(){return this.data,this.appFile}static createData(e){if(!e.name)throw new Error("no name");return{"@class":"Application","@attributes":{formatVersion:"0.1",name:e.name,caption:e.caption||e.name,authentication:e.authentication||"false",user:e.user||"admin",password:e.password||"admin",lang:e.lang||"en",theme:e.theme||"standard",cssBlock:void 0!==e.cssBlock?e.cssBlock:"",viewClass:void 0!==e.viewClass?e.viewClass:"",ctrlClass:void 0!==e.ctrlClass?e.ctrlClass:"",modelClass:void 0!==e.modelClass?e.modelClass:""},env:e.env?e.env:{},databases:[...e.databases?e.databases.map(i.Editor.createItemData):[]],dataSources:[...e.dataSources?e.dataSources.map(i.Editor.createItemData):[]],actions:[...e.actions?e.actions.map(i.Editor.createItemData):[]],pageLinks:[...e.pageLinks?e.pageLinks.map(i.Editor.createItemData):[]]}}static async createAppFile(e,t){const s=ApplicationEditor.createData(t),r=new l.JsonFile(e,s);return await r.create(),r}async newPageAndPageLinkData(e){const t=o.default.join(this.appInfo.dirPath,"pages"),s=o.default.join(t,e.name),r=o.default.join(s,e.name+".json"),i=c.PageEditor.createData(e),a=new l.JsonFile(r,i);await a.create();return{page:i,pageLink:this.newItemData("PageLink","pageLinks",e)}}async save(){(0,d.debug)("ApplicationEditor.save"),await this.appFile.save()}async removePageFile(e){const t=this.createItemEditor("pageLinks",e),s=o.default.join(this.appInfo.dirPath,t.getAttr("fileName"));await a.BkHelper.fsUnlink(s)}async createPageEditor(e){const t=o.default.join(this.appInfo.dirPath,e),s=new l.JsonFile(t);return await s.read(),new c.PageEditor(this,s,this.getEditorPath())}async getPage(e){const t=this.createItemEditor("pageLinks",e).getAttr("fileName");return await this.createPageEditor(t)}async createJs(e){const t=await this.getCustomFilePath("js"),s=o.default.join(this.getEditorPath(),"Editor/ApplicationEditor/Application.js.ejs");return await this.createFileByParams(t,s,{application:this.getName(),_class:this.constructor.name.replace("Editor","")})}async createModelBackJs(e){const t=o.default.join(await this.getCustomDirPath(),"Model.back.ts"),s=o.default.join(this.getEditorPath(),"Editor/ApplicationEditor/Model.back.ts.ejs");return await this.createFileByParams(t,s,{name:this.getName()})}async getCustomDirPath(){return this.appInfo.dirPath}reformat(){this.data=this.appFile.data=ApplicationEditor.createData(Object.assign(Object.assign({},this.attributes()),{env:this.data.env,databases:this.data.databases,dataSources:this.data.dataSources,actions:this.data.actions,pageLinks:this.data.pageLinks}))}}t.ApplicationEditor=ApplicationEditor},4483:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnEditor=void 0;const r=s(4655);class ColumnEditor extends r.Editor{static createData(e){if(!e.name)throw new Error("no name");if(void 0!==e.key&&"string"!=typeof e.key)throw new Error("key not string");if(void 0!==e.auto&&"string"!=typeof e.auto)throw new Error("auto not string");if(void 0!==e.nullable&&"string"!=typeof e.nullable)throw new Error("nullable not string");return{"@class":"Column","@attributes":{name:e.name,caption:e.caption||e.name,type:e.type||"",dbType:e.dbType||"",key:e.key||"false",auto:e.auto||"false",nullable:e.nullable||"true"}}}getColName(){return"columns"}}t.ColumnEditor=ColumnEditor},2576:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceEditor=void 0;const o=r(s(1017)),i=s(1784),a=s(506),n=s(4655);class DataSourceEditor extends n.Editor{static createData(e){return{"@class":"DataSource","@attributes":Object.assign({},DataSourceEditor.createAttributes(e)),keyColumns:[...e.keyColumns?e.keyColumns.map(n.Editor.createItemData):[]]}}static createAttributes(e){if(!e.name)throw new Error("no name");return{name:e.name,database:e.database||"default",table:e.table||"",modelClass:void 0!==e.modelClass?e.modelClass:""}}async getCollectionDirPath(){const e=await this.getParent().getCustomDirPath();return o.default.join(e,"dataSources")}async createModelBackJs(e){const t=o.default.join(await this.getCustomDirPath(),"Model.back.ts"),s=o.default.join(this.getEditorPath(),"Editor/DataSourceEditor/Model.back.ts.ejs");return await this.createFileByParams(t,s,{_class:this.getClassName(),page:e.page?e.page:"",form:e.form?e.form:"",dataSource:this.getName()})}getColName(){return"dataSources"}async save(){this.getParent()instanceof i.ApplicationEditor?await this.getParent().getAppFile().save():this.getParent()instanceof a.PageEditor?await this.getParent().pageFile.save():await this.getParent().getParent().pageFile.save()}}t.DataSourceEditor=DataSourceEditor},2882:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoSqlDataSourceEditor=void 0;const r=s(2576),o=s(4655);class NoSqlDataSourceEditor extends r.DataSourceEditor{static createData(e){return{"@class":"NoSqlDataSource","@attributes":Object.assign(Object.assign({},r.DataSourceEditor.createAttributes(e)),{selectQuery:e.selectQuery?e.selectQuery:"",countQuery:e.countQuery?e.countQuery:"",limit:e.limit?e.limit:""}),keyColumns:[...e.keyColumns?e.keyColumns.map(o.Editor.createItemData):[]]}}}t.NoSqlDataSourceEditor=NoSqlDataSourceEditor},6032:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SqlDataSourceEditor=void 0;const r=s(2576),o=s(4655);class SqlDataSourceEditor extends r.DataSourceEditor{static createData(e){return{"@class":"SqlDataSource","@attributes":Object.assign(Object.assign({},r.DataSourceEditor.createAttributes(e)),{singleQuery:e.singleQuery?e.singleQuery:"",multipleQuery:e.multipleQuery?e.multipleQuery:"",countQuery:e.countQuery?e.countQuery:"",limit:e.limit?e.limit:""}),keyColumns:[...e.keyColumns?e.keyColumns.map(o.Editor.createItemData):[]]}}}t.SqlDataSourceEditor=SqlDataSourceEditor},9464:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseEditor=void 0;const r=s(4655);class DatabaseEditor extends r.Editor{static createData(e){throw new Error("DatabaseEditor.createData not implemented")}static createAttributes(e){if(!e.name)throw new Error("no name");return{name:e.name,modelClass:void 0!==e.modelClass?e.modelClass:""}}getColName(){return"databases"}}t.DatabaseEditor=DatabaseEditor},7634:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MongoDbDatabaseEditor=void 0;const r=s(9464),o=s(4655);class MongoDbDatabaseEditor extends r.DatabaseEditor{static createData(e){if(!e.name)throw new Error("no name");return{"@class":"MongoDbDatabase","@attributes":Object.assign({},r.DatabaseEditor.createAttributes(e)),params:[...e.params?e.params.map(o.Editor.createItemData):[]],tables:[...e.tables?e.tables.map(o.Editor.createItemData):[]]}}}t.MongoDbDatabaseEditor=MongoDbDatabaseEditor},6329:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MySqlDatabaseEditor=void 0;const r=s(9464),o=s(4655);class MySqlDatabaseEditor extends r.DatabaseEditor{static createData(e){if(!e.name)throw new Error("no name");return{"@class":"MySqlDatabase","@attributes":Object.assign({},r.DatabaseEditor.createAttributes(e)),params:[...e.params?e.params.map(o.Editor.createItemData):[]],tables:[...e.tables?e.tables.map(o.Editor.createItemData):[]]}}}t.MySqlDatabaseEditor=MySqlDatabaseEditor},5635:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PostgreSqlDatabaseEditor=void 0;const r=s(9464),o=s(4655);class PostgreSqlDatabaseEditor extends r.DatabaseEditor{static createData(e){if(!e.name)throw new Error("no name");return{"@class":"PostgreSqlDatabase","@attributes":Object.assign({},r.DatabaseEditor.createAttributes(e)),params:[...e.params?e.params.map(o.Editor.createItemData):[]],tables:[...e.tables?e.tables.map(o.Editor.createItemData):[]]}}}t.PostgreSqlDatabaseEditor=PostgreSqlDatabaseEditor},4655:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Editor=void 0;const n=a(s(1017)),l=s(9632),c=s(8491),d=s(9918),u=i(s(7756)),h=s(8978);class Editor extends c.BaseModel{constructor(e,t,s){super(e,t),this.editorPath=s}getEditorPath(){if(!this.editorPath)throw new Error(`${this.constructor.name}: no editorPath`);return this.editorPath}async createFileByParams(e,t,s){if(await d.BkHelper.exists(e))throw new Error(`File ${n.default.basename(e)} already exists.`);const r=await d.BkHelper.readTextFile(t),o=l.render(r,s);return await d.BkHelper.writeFile2(e,o),o}async getFile(e){(0,h.debug)("Editor.getFile",e);if(await d.BkHelper.exists(e))return await d.BkHelper.readTextFile(e)}async saveFile(e,t){if(!await d.BkHelper.exists(e))throw new Error("File {path.basename(filePath)} doesn't exist.");await d.BkHelper.writeFile2(e,t)}async getCustomFile(e){(0,h.debug)("Editor.getCustomFile",e);const t=await this.getCustomFilePath(e);return this.getFile(t)}async saveCustomFile(e,t){const s=await this.getCustomFilePath(e);await this.saveFile(s,t)}async getCustomFilePath(e){const t=await this.getCustomDirPath();return"js"===e?n.default.join(t,"Controller.front.ts"):"jsx"===e?n.default.join(t,"View.tsx"):"less"===e?n.default.join(t,"View.less"):n.default.join(t,this.getName()+"."+e)}moveDataColItem(e,t,s){d.BkHelper.moveArrItem(this.getCol(e),this.getColItemData(e,t),s)}setColData(e,t){return this.getParent().replaceDataColItem(e,this.data,t)}createItemEditor(e,t){const s=this.getColItemData(e,t),r=c.BaseModel.getClassName(s);return new(0,u[`${r}Editor`])(s,this,this.editorPath)}async getCustomDirPath(){const e=await this.getCollectionDirPath();return n.default.join(e,this.getName())}async getCollectionDirPath(){throw new Error("Editor.getCollectionDirPath not implemented")}moveItemUp(e,t){this.moveDataColItem(e,t,-1)}moveItemDown(e,t){this.moveDataColItem(e,t,1)}newItemData(e,t,s){(0,h.debug)("Editor.newItemData",e,t,s);const{name:r}=s;if(!r)throw new Error("no name");const o=`${e}Editor`,i=u[o];if(!i)throw new Error(`no class ${o}`);const a=i.createData(s);return this.addModelData(t,a),a}getColName(){throw new Error(`${this.constructor.name}.getColName not implemented`)}static createItemData(e){try{const t=e["@attributes"]?Object.assign(Object.assign({class:c.BaseModel.getClassName(e)},c.BaseModel.attributes(e)),e):e;if(!t.class){const t=e["@attributes"]?c.BaseModel.getName(e):e.name;throw new Error(`${t}: no class in data`)}return u[`${t.class}Editor`].createData(t)}catch(t){const s=e["@attributes"]?c.BaseModel.getName(e):e.name;throw t.message=`${s}: ${t.message}`,t}}}t.Editor=Editor},1424:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckBoxFieldEditor=void 0;const r=s(2315);class CheckBoxFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"CheckBoxField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false"})}}}t.CheckBoxFieldEditor=CheckBoxFieldEditor},5249:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckBoxListFieldEditor=void 0;const r=s(2315);class CheckBoxListFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"CheckBoxListField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",dataSourceName:e.dataSourceName?e.dataSourceName:"",valueColumn:e.valueColumn?e.valueColumn:"",displayColumn:e.displayColumn?e.displayColumn:""})}}}t.CheckBoxListFieldEditor=CheckBoxListFieldEditor},7580:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComboBoxFieldEditor=void 0;const r=s(2315);class ComboBoxFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"ComboBoxField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",placeholder:e.placeholder?e.placeholder:"",dataSourceName:e.dataSourceName?e.dataSourceName:"",valueColumn:e.valueColumn?e.valueColumn:"",displayColumn:e.displayColumn?e.displayColumn:"",newRowMode:e.newRowMode?e.newRowMode:"disabled",itemEditPage:e.itemEditPage?e.itemEditPage:"",itemCreatePage:e.itemCreatePage?e.itemCreatePage:"",itemCreateForm:e.itemCreateForm?e.itemCreateForm:"",itemSelectPage:e.itemSelectPage?e.itemSelectPage:""})}}}t.ComboBoxFieldEditor=ComboBoxFieldEditor},2426:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DateFieldEditor=void 0;const r=s(2315);class DateFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"DateField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",format:e.format?e.format:"{DD}.{MM}.{YYYY} {hh}:{mm}:{ss}",timezone:e.timezone?e.timezone:"true",placeholder:e.placeholder?e.placeholder:"",validateOnChange:e.validateOnChange?e.validateOnChange:"true",validateOnBlur:e.validateOnBlur?e.validateOnBlur:"false"})}}}t.DateFieldEditor=DateFieldEditor},1987:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DateTimeFieldEditor=void 0;const r=s(2315);class DateTimeFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"DateTimeField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",format:e.format?e.format:"{DD}.{MM}.{YYYY}",timezone:e.timezone?e.timezone:"true",placeholder:e.placeholder?e.placeholder:"",validateOnChange:e.validateOnChange?e.validateOnChange:"true",validateOnBlur:e.validateOnBlur?e.validateOnBlur:"false"})}}}t.DateTimeFieldEditor=DateTimeFieldEditor},2315:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FieldEditor=void 0;const n=a(s(1017)),l=s(4655),c=i(s(7756));class FieldEditor extends l.Editor{static createAttributes(e){if(!e.name)throw new Error("no name");return{name:e.name,caption:void 0!==e.caption?e.caption:e.name,column:void 0!==e.column?e.column:e.name,defaultValue:void 0!==e.defaultValue?e.defaultValue:"",value:void 0!==e.value?e.value:"",param:void 0!==e.param?e.param:"false",visible:void 0!==e.visible?e.visible:"true",type:void 0!==e.type?e.type:"",width:void 0!==e.width?e.width:"",cssBlock:void 0!==e.cssBlock?e.cssBlock:"",viewClass:void 0!==e.viewClass?e.viewClass:"",ctrlClass:void 0!==e.ctrlClass?e.ctrlClass:"",autoFocus:void 0!==e.autoFocus?e.autoFocus:"false"}}changeClass(e){const t=c[`${e}Editor`].createData(this.attributes());return this.setColData(this.getColName(),t),t}async createJs(e){const t=n.default.join(this.getEditorPath(),"Editor/FieldEditor/Field.js.ejs"),s=await this.getCustomFilePath("js");return await this.createFileByParams(s,t,{page:this.getParent().getParent().getName(),form:this.getParent().getName(),field:this.getName(),formClass:this.getParent().constructor.name.replace("Editor",""),_class:this.constructor.name.replace("Editor","")})}async createJsx(e){const t=n.default.join(this.getEditorPath(),"Editor/FieldEditor/View.jsx.ejs"),s=await this.getCustomFilePath("jsx");return await this.createFileByParams(s,t,{page:this.getParent().getParent().getName(),form:this.getParent().getName(),field:this.getName(),formClass:this.getParent().constructor.name.replace("Editor",""),_class:this.constructor.name.replace("Editor","")})}async createLess(e){const t=n.default.join(this.getEditorPath(),"Editor/FieldEditor/View.less.ejs"),s=await this.getCustomFilePath("less");return await this.createFileByParams(s,t,{page:this.getParent().getParent().getName(),form:this.getParent().getName(),field:this.getName(),formClass:this.getParent().constructor.name.replace("Editor",""),_class:this.constructor.name.replace("Editor","")})}async getCollectionDirPath(){const e=await this.getParent().getCustomDirPath();return n.default.join(e,"fields")}getColName(){return"fields"}}t.FieldEditor=FieldEditor},7484:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileFieldEditor=void 0;const r=s(2315);class FileFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"FileField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false"})}}}t.FileFieldEditor=FileFieldEditor},8868:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageFieldEditor=void 0;const r=s(2315);class ImageFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"ImageField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false"})}}}t.ImageFieldEditor=ImageFieldEditor},3690:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelFieldEditor=void 0;const r=s(2315);class LabelFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"LabelField","@attributes":Object.assign({},r.FieldEditor.createAttributes(e))}}}t.LabelFieldEditor=LabelFieldEditor},6348:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkFieldEditor=void 0;const r=s(2315);class LinkFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"LinkField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{notNull:e.notNull?e.notNull:"false",page:e.page?e.page:"",displayColumn:e.displayColumn?e.displayColumn:""})}}}t.LinkFieldEditor=LinkFieldEditor},9491:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordFieldEditor=void 0;const r=s(2315);class PasswordFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"PasswordField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",placeholder:e.placeholder?e.placeholder:"",validateOnChange:e.validateOnChange?e.validateOnChange:"true",validateOnBlur:e.validateOnBlur?e.validateOnBlur:"false",autocomplete:e.autocomplete?e.autocomplete:""})}}}t.PasswordFieldEditor=PasswordFieldEditor},2685:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneFieldEditor=void 0;const r=s(2315);class PhoneFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"PhoneField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",placeholder:e.placeholder?e.placeholder:"",validateOnChange:e.validateOnChange?e.validateOnChange:"true",validateOnBlur:e.validateOnBlur?e.validateOnBlur:"false",autocomplete:e.autocomplete?e.autocomplete:""})}}}t.PhoneFieldEditor=PhoneFieldEditor},7185:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RadioFieldEditor=void 0;const r=s(2315);class RadioFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"RadioField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",dataSourceName:e.dataSourceName?e.dataSourceName:"",valueColumn:e.valueColumn?e.valueColumn:"",displayColumn:e.displayColumn?e.displayColumn:""})}}}t.RadioFieldEditor=RadioFieldEditor},5238:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextAreaFieldEditor=void 0;const r=s(2315);class TextAreaFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"TextAreaField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",rows:e.rows?e.rows:"",cols:e.cols?e.cols:"",validateOnChange:e.validateOnChange?e.validateOnChange:"true",validateOnBlur:e.validateOnBlur?e.validateOnBlur:"false"})}}}t.TextAreaFieldEditor=TextAreaFieldEditor},4743:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBoxFieldEditor=void 0;const r=s(2315);class TextBoxFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"TextBoxField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",placeholder:e.placeholder?e.placeholder:"",validateOnChange:e.validateOnChange?e.validateOnChange:"true",validateOnBlur:e.validateOnBlur?e.validateOnBlur:"false",autocomplete:e.autocomplete?e.autocomplete:""})}}}t.TextBoxFieldEditor=TextBoxFieldEditor},6252:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeFieldEditor=void 0;const r=s(2315);class TimeFieldEditor extends r.FieldEditor{static createData(e){return{"@class":"TimeField","@attributes":Object.assign(Object.assign({},r.FieldEditor.createAttributes(e)),{readOnly:e.readOnly?e.readOnly:"false",notNull:e.notNull?e.notNull:"false",placeholder:e.placeholder?e.placeholder:"",validateOnChange:e.validateOnChange?e.validateOnChange:"true",validateOnBlur:e.validateOnBlur?e.validateOnBlur:"false"})}}}t.TimeFieldEditor=TimeFieldEditor},5410:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormEditor=void 0;const o=r(s(1017)),i=s(4655),a=s(8978);class FormEditor extends i.Editor{static createAttributes(e){if(!e.name)throw new Error("no name");return{name:e.name,caption:void 0!==e.caption?e.caption:e.name,visible:void 0!==e.visible?e.visible:"true",cssBlock:void 0!==e.cssBlock?e.cssBlock:"",viewClass:void 0!==e.viewClass?e.viewClass:"",ctrlClass:void 0!==e.ctrlClass?e.ctrlClass:"",modelClass:void 0!==e.modelClass?e.modelClass:""}}static createData(e){return(0,a.debug)("FormEditor.createData",e),{"@class":"Form","@attributes":Object.assign({},FormEditor.createAttributes(e)),dataSources:[...e.dataSources?e.dataSources.map(i.Editor.createItemData):[]],actions:[...e.actions?e.actions.map(i.Editor.createItemData):[]],fields:[...e.fields?e.fields.map(i.Editor.createItemData):[]]}}async createJs(e){const t=o.default.join(this.getEditorPath(),"Editor/FormEditor/Form.js.ejs"),s=await this.getCustomFilePath("js");return await this.createFileByParams(s,t,{page:this.getParent().getName(),form:this.getName(),_class:this.constructor.name.replace("Editor","")})}async createJsx(e){const t=o.default.join(this.getEditorPath(),"Editor/FormEditor/Form.jsx.ejs"),s=await this.getCustomFilePath("jsx");return await this.createFileByParams(s,t,{page:this.getParent().getName(),form:this.getName(),_class:this.constructor.name.replace("Editor","")})}async createLess(e){const t=o.default.join(this.getEditorPath(),"Editor/FormEditor/Form.less.ejs"),s=await this.getCustomFilePath("less");return await this.createFileByParams(s,t,{page:this.getParent().getName(),form:this.getName(),_class:this.constructor.name.replace("Editor","")})}async createModelBackJs(e){const t=o.default.join(await this.getCustomDirPath(),"Model.back.ts"),s=o.default.join(this.getEditorPath(),"Editor/FormEditor/Model.back.ts.ejs");return await this.createFileByParams(t,s,{page:this.getParent().getName(),form:this.getName(),_class:this.getClassName()})}async getCollectionDirPath(){const e=await this.getParent().getCustomDirPath();return o.default.join(e,"forms")}getColName(){return"forms"}}t.FormEditor=FormEditor},8582:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormEditor=void 0;const r=s(5410),o=s(4655);class RowFormEditor extends r.FormEditor{static createData(e){return{"@class":"RowForm","@attributes":Object.assign(Object.assign({},r.FormEditor.createAttributes(e)),{newMode:e.newMode?e.newMode:"",backOnly:e.backOnly?e.backOnly:"false",refreshButton:e.refreshButton||"true"}),dataSources:[...e.dataSources?e.dataSources.map(o.Editor.createItemData):[]],actions:[...e.actions?e.actions.map(o.Editor.createItemData):[]],fields:[...e.fields?e.fields.map(o.Editor.createItemData):[]]}}}t.RowFormEditor=RowFormEditor},4783:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormEditor=void 0;const r=s(5410),o=s(4655);class TableFormEditor extends r.FormEditor{static createData(e){return{"@class":"TableForm","@attributes":Object.assign(Object.assign({},r.FormEditor.createAttributes(e)),{editMethod:e.editMethod||"disabled",itemEditPage:e.itemEditPage||"",itemCreatePage:e.itemCreatePage||"",newRowMode:e.newRowMode||"disabled",deleteRowMode:e.deleteRowMode||"disabled",refreshButton:e.refreshButton||"true"}),dataSources:[...e.dataSources?e.dataSources.map(o.Editor.createItemData):[]],actions:[...e.actions?e.actions.map(o.Editor.createItemData):[]],fields:[...e.fields?e.fields.map(o.Editor.createItemData):[]]}}}t.TableFormEditor=TableFormEditor},5851:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyColumnEditor=void 0;const r=s(4655);class KeyColumnEditor extends r.Editor{static createData(e){if(!e.name)throw new Error("no name");return{"@class":"KeyColumn","@attributes":{name:e.name}}}getColName(){return"keyColumns"}}t.KeyColumnEditor=KeyColumnEditor},506:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageEditor=void 0;const o=r(s(1017)),i=s(4655),a=s(8978);class PageEditor extends i.Editor{constructor(e,t,s){super(t.data,e,s),this.appEditor=e,this.pageFile=t}static createData(e){return{"@class":"Page","@attributes":{formatVersion:"0.1",name:e.name,caption:void 0!==e.caption?e.caption:e.name,cssBlock:void 0!==e.cssBlock?e.cssBlock:"",viewClass:void 0!==e.viewClass?e.viewClass:"",ctrlClass:void 0!==e.ctrlClass?e.ctrlClass:"",modelClass:void 0!==e.modelClass?e.modelClass:"",formInTab:void 0!==e.formInTab?e.formInTab:"false"},dataSources:[...e.dataSources?e.dataSources.map(i.Editor.createItemData):[]],actions:[...e.actions?e.actions.map(i.Editor.createItemData):[]],forms:[...e.forms?e.forms.map(i.Editor.createItemData):[]]}}setAttr(e,t){if((0,a.debug)("PageEditor.setAttr",e,t),"name"===e){this.appEditor.createItemEditor("pageLinks",this.getName()).setAttr(e,t)}super.setAttr(e,t)}async save(){await this.pageFile.save()}async createJs(e){const t=o.default.join(this.getEditorPath(),"Editor/PageEditor/Page.js.ejs"),s=await this.getCustomFilePath("js");return await this.createFileByParams(s,t,{page:this.getName(),_class:this.constructor.name.replace("Editor","")})}async createJsx(e){const t=o.default.join(this.getEditorPath(),"Editor/PageEditor/Page.jsx.ejs"),s=await this.getCustomFilePath("jsx");return await this.createFileByParams(s,t,{page:this.getName(),_class:this.constructor.name.replace("Editor","")})}async createLess(e){const t=o.default.join(this.getEditorPath(),"Editor/PageEditor/Page.less.ejs"),s=await this.getCustomFilePath("less");return await this.createFileByParams(s,t,{page:this.getName(),_class:this.constructor.name.replace("Editor","")})}async createModelBackJs(e){const t=o.default.join(await this.getCustomDirPath(),"Model.back.ts"),s=o.default.join(this.getEditorPath(),"Editor/PageEditor/Model.back.ts.ejs");return await this.createFileByParams(t,s,{name:this.getName()})}async getCustomDirPath(){(0,a.debug)("PageEditor.getCustomDirPath");const e=await this.getParent().getCustomDirPath();return o.default.join(e,"pages",this.getName())}reformat(){this.data=this.pageFile.data=PageEditor.createData(Object.assign(Object.assign({},this.attributes()),{dataSources:this.data.dataSources,actions:this.data.actions,forms:this.data.forms}))}}t.PageEditor=PageEditor},4268:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageLinkEditor=void 0;const r=s(4655);class PageLinkEditor extends r.Editor{static createData(e){return{"@class":"PageLink","@attributes":{name:e.name,fileName:e.fileName||`pages/${e.name}/${e.name}.json`,menu:e.menu||("true"===e.startup?"Menu":""),startup:e.startup||"false"}}}getColName(){return"pageLinks"}}t.PageLinkEditor=PageLinkEditor},5439:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParamEditor=void 0;const r=s(4655);class ParamEditor extends r.Editor{static createData(e){if(!e.name)throw new Error("no name");return{"@class":"Param","@attributes":{name:e.name,value:`"${e.value||""}"`}}}getColName(){return"params"}}t.ParamEditor=ParamEditor},9877:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableEditor=void 0;const r=s(4655);class TableEditor extends r.Editor{static createData(e){return{"@class":"Table","@attributes":{name:e.name},columns:[...e.columns?e.columns.map(r.Editor.createItemData):[]]}}getColName(){return"tables"}}t.TableEditor=TableEditor},1900:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionEditorController=void 0;const r=s(4095),o=s(8978);class ActionEditorController extends r.EditorController{async _new(e){(0,o.debug)("ActionEditorController._new");const t=this.createApplicationEditor();let s;if(e.pageFileName){const r=await t.createPageEditor(e.pageFileName);if(e.form){const t=r.createItemEditor("forms",e.form);s=await t.newItemData("Action","actions",e)}else s=await r.newItemData("Action","actions",e);await r.save()}else s=await t.newItemData("Action","actions",e),await t.save();return s}async save(e){const t=this.createApplicationEditor();if(e.pageFileName){const s=await t.createPageEditor(e.pageFileName);if(e.form){s.createItemEditor("forms",e.form).createItemEditor("actions",e.action).setAttr(e.attr,e.value)}else{s.createItemEditor("actions",e.action).setAttr(e.attr,e.value)}await s.save()}else{t.createItemEditor("actions",e.action).setAttr(e.attr,e.value),await t.save()}return null}async delete(e){const t=this.createApplicationEditor();let s;if(e.pageFileName){const r=await t.createPageEditor(e.pageFileName);if(e.form){s=r.createItemEditor("forms",e.form).removeColData("actions",e.action)}else s=r.removeColData("actions",e.action);await r.save()}else s=t.removeColData("actions",e.action),await t.save();return s}async moveUp(e){const t=this.createApplicationEditor();if(e.pageFileName){const s=await t.createPageEditor(e.pageFileName);if(e.form){s.createItemEditor("forms",e.form).moveItemUp("actions",e.action),await s.save()}else s.moveItemUp("actions",e.action),await s.save()}else t.moveItemUp("actions",e.action),await t.save();return null}async moveDown(e){const t=this.createApplicationEditor();if(e.pageFileName){const s=await t.createPageEditor(e.pageFileName);if(e.form){s.createItemEditor("forms",e.form).moveItemDown("actions",e.action),await s.save()}else s.moveItemDown("actions",e.action),await s.save()}else t.moveItemDown("actions",e.action),await t.save();return null}}t.ActionEditorController=ActionEditorController},6351:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationEditorController=void 0;const r=s(7894);class ApplicationEditorController extends r.VisualEditorController{async save(e){const t=this.createApplicationEditor();return t.setAttr(e.attr,e.value),await t.save(),null}async getView(e){const t=await super.getView(e);if("VisualView.html"===e.view){const e=this.createApplicationEditor();t.data.js=await e.getCustomFile("js")}return t}async createController(e){const t=this.createApplicationEditor();return{js:await t.createJs(e)}}async createModelBackJs(e){const t=this.createApplicationEditor();return{js:await t.createModelBackJs(e)}}async saveController(e){const t=this.createApplicationEditor();return await t.saveCustomFile("js",e.text),{js:e.text}}}t.ApplicationEditorController=ApplicationEditorController},6447:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnEditorController=void 0;const r=s(4095),o=s(8978);class ColumnEditorController extends r.EditorController{async save(e){(0,o.debug)("ColumnEditorController.save");const t=this.createApplicationEditor();return t.createItemEditor("databases",e.database).createItemEditor("tables",e.table).createItemEditor("columns",e.column).setAttr(e.attr,e.value),await t.save(),"ok"}async _new(e){(0,o.debug)("ColumnEditorController._new");const t=this.createApplicationEditor(),s=t.createItemEditor("databases",e.database).createItemEditor("tables",e.table).newItemData("Column","columns",e);return await t.save(),s}async delete(e){(0,o.debug)("ColumnEditorController.delete");const t=this.createApplicationEditor(),s=t.createItemEditor("databases",e.database).createItemEditor("tables",e.table).removeColData("columns",e.column);return await t.save(),s}}t.ColumnEditorController=ColumnEditorController},1205:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceEditorController=void 0;const r=s(4095),o=s(8978);class DataSourceEditorController extends r.EditorController{async createDataSourceEditor(e){let t=this.createApplicationEditor();return e.pageFileName&&(t=await t.createPageEditor(e.pageFileName),e.form&&(t=t.createItemEditor("forms",e.form))),t.createItemEditor("dataSources",e.dataSource)}async _new(e){const t=this.createApplicationEditor();let s;if(e.page){const r=await t.createPageEditor(e.page);if(e.form){s=r.createItemEditor("forms",e.form).newItemData(e.class,"dataSources",e)}else s=r.newItemData(e.class,"dataSources",e);await r.save()}else s=t.newItemData(e.class,"dataSources",e),await t.save();return s}async delete(e){const t=this.createApplicationEditor();let s;if(e.page){const r=await t.createPageEditor(e.page);if(e.form){s=r.createItemEditor("forms",e.form).removeColData("dataSources",e.dataSource)}else s=r.removeColData("dataSources",e.dataSource);await r.save()}else s=t.removeColData("dataSources",e.dataSource),await t.save();return s}async moveUp(e){const t=this.createApplicationEditor();if(e.page){const s=await t.createPageEditor(e.page);if(e.form){return s.createItemEditor("forms",e.form).moveItemUp("dataSources",e.dataSource),await s.save(),null}return s.moveItemUp("dataSources",e.dataSource),await s.save(),null}return t.moveItemUp("dataSources",e.dataSource),await t.save(),null}async moveDown(e){const t=this.createApplicationEditor();if(e.page){const s=await t.createPageEditor(e.page);if(e.form){return s.createItemEditor("forms",e.form).moveItemDown("dataSources",e.dataSource),await s.save(),null}return s.moveItemDown("dataSources",e.dataSource),await s.save(),null}return t.moveItemDown("dataSources",e.dataSource),await t.save(),null}async save(e){(0,o.debug)("DataSourceEditorController.save");const t=await this.createDataSourceEditor(e);return t.setAttr(e.attr,e.value),await t.save(),null}async createModelBackJs(e){const t=await this.createDataSourceEditor(e);return{js:await t.createModelBackJs(e)}}async getView(e){const t=await super.getView(e);return e.view,t}}t.DataSourceEditorController=DataSourceEditorController},1625:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseEditorController=void 0;const r=s(4095),o=s(8978);class DatabaseEditorController extends r.EditorController{constructor(){super(...arguments),this.application=null}async init(e){await super.init(e),this.application=await this.hostApp.createApplication(e)}async _new(e){const t=this.createApplicationEditor(),s=t.newItemData(e.class,"databases",e);return await t.save(),s}async save(e){(0,o.debug)("DatabaseEditorController.save");const t=this.createApplicationEditor();return t.createItemEditor("databases",e.database).setAttr(e.attr,e.value),await t.save(),"ok"}async delete(e){const t=this.createApplicationEditor(),s=t.removeColData("databases",e.database);return await t.save(),s}async getView(e){const t=await super.getView(e);if("DatabaseView/DatabaseView.html"===e.view){const s=this.application.getDatabase(e.database);t.data.tables=await s.getTableList()}return t}async getTableInfo(e){const t=this.application.getDatabase(e.database);return{tableInfo:await t.getTableInfo(e.table)}}async moveUp(e){const t=this.createApplicationEditor();return t.moveItemUp("databases",e.database),await t.save(),"ok"}async moveDown(e){const t=this.createApplicationEditor();return t.moveItemDown("databases",e.database),await t.save(),"ok"}}t.DatabaseEditorController=DatabaseEditorController},4095:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EditorController=void 0;const o=r(s(1017)),i=s(1784),a=s(8978);t.EditorController=class EditorController{constructor(e,t){this.appInfo=e,this.hostApp=t}async init(e){}async getView(e){return(0,a.debug)("EditorController.getView"),{data:{}}}createApplicationEditor(){return(0,a.debug)("EditorController.createApplicationEditor"),new i.ApplicationEditor(this.appInfo.appFile,o.default.join(this.hostApp.backendDirPath,"editor"))}}},1314:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FieldEditorController=void 0;const r=s(7894);class FieldEditorController extends r.VisualEditorController{async _new(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName),r=s.createItemEditor("forms",e.form).newItemData(e.class,"fields",e);return await s.save(),r}async save(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName);return s.createItemEditor("forms",e.form).createItemEditor("fields",e.field).setAttr(e.attr,e.value),await s.save(),null}async delete(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName),r=s.createItemEditor("forms",e.form).removeColData("fields",e.field);return await s.save(),r}async changeClass(e){const t=this.createApplicationEditor(),s=await t.getPage(e.page),r=s.createItemEditor("forms",e.form).createItemEditor("fields",e.field).changeClass(e.class);return await s.save(),r}async getView(e){const t=await super.getView(e);if("VisualView.html"===e.view){const s=this.createApplicationEditor(),r=(await s.getPage(e.page)).createItemEditor("forms",e.form).createItemEditor("fields",e.field);return t.data.js=await r.getCustomFile("js"),t.data.jsx=await r.getCustomFile("jsx"),t.data.less=await r.getCustomFile("less"),t}return t}async createController(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form).createItemEditor("fields",e.field);return{js:await s.createJs(e)}}async createView(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form).createItemEditor("fields",e.field);return{jsx:await s.createJsx(e)}}async createStyle(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form).createItemEditor("fields",e.field);return{less:await s.createLess(e)}}async saveController(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form).createItemEditor("fields",e.field);return await s.saveCustomFile("js",e.text),{js:e.text}}async moveUp(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName);return s.createItemEditor("forms",e.form).moveItemUp("fields",e.field),await s.save(),"ok"}async moveDown(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName);return s.createItemEditor("forms",e.form).moveItemDown("fields",e.field),await s.save(),"ok"}}t.FieldEditorController=FieldEditorController},1239:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormEditorController=void 0;const r=s(7894),o=s(8978);class FormEditorController extends r.VisualEditorController{async _new(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName),r=await s.newItemData(e.class,"forms",e);return await s.save(),r}async save(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName);return s.createItemEditor("forms",e.form).setAttr(e.attr,e.value),await s.save(),null}async delete(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName),r=s.removeColData("forms",e.form);return await s.save(),r}async moveUp(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName);return s.moveItemUp("forms",e.form),await s.save(),"ok"}async moveDown(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName);return s.moveItemDown("forms",e.form),await s.save(),"ok"}async getView(e){(0,o.debug)("FormEditorController.getView");const t=await super.getView(e);if("VisualView.html"===e.view){const s=this.createApplicationEditor(),r=(await s.getPage(e.page)).createItemEditor("forms",e.form);return t.data.js=await r.getCustomFile("js"),t.data.jsx=await r.getCustomFile("jsx"),t.data.less=await r.getCustomFile("less"),t}return t}async createController(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form);return{js:await s.createJs(e)}}async createView(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form);return{jsx:await s.createJsx(e)}}async createStyle(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form);return{less:await s.createLess(e)}}async saveController(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form);return await s.saveCustomFile("js",e.text),{js:e.text}}async createModelBackJs(e){const t=this.createApplicationEditor(),s=(await t.getPage(e.page)).createItemEditor("forms",e.form);return{js:await s.createModelBackJs(e)}}}t.FormEditorController=FormEditorController},5246:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyColumnEditorController=void 0;const r=s(4095);class KeyColumnEditorController extends r.EditorController{async _new(e){const t=this.createApplicationEditor();if(e.page){const s=await t.createPageEditor(e.page);if(e.form){const t=s.createItemEditor("forms",e.form).createItemEditor("dataSources",e.dataSource).newItemData("KeyColumn","keyColumns",e);return await s.save(),t}{const t=s.createItemEditor("dataSources",e.dataSource).newItemData("KeyColumn","keyColumns",e);return await s.save(),t}}{const s=t.createItemEditor("dataSources",e.dataSource).newItemData("KeyColumn","keyColumns",e);return await t.save(),s}}async save(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.pageFileName);return s.createItemEditor("forms",e.form).createItemEditor("dataSources",e.dataSource).createItemEditor("keyColumns",e.keyColumn).setAttr(e.attr,e.value),await s.save(),null}async delete(e){const t=this.createApplicationEditor();let s,r;if(e.page)if(r=await t.createPageEditor(e.page),e.form){s=r.createItemEditor("forms",e.form).createItemEditor("dataSources",e.dataSource)}else s=r.createItemEditor("dataSources",e.dataSource);else s=t.createItemEditor("dataSources",e.dataSource);const o=s.removeColData("keyColumns",e.keyColumn);return r?await r.save():await t.save(),o}}t.KeyColumnEditorController=KeyColumnEditorController},91:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageEditorController=void 0;const o=r(s(1017)),i=s(7894),a=s(9918);class PageEditorController extends i.VisualEditorController{async get(e){const t=o.default.join(this.appInfo.dirPath,e.fileName),s=await a.BkHelper.readTextFile(t);return JSON.parse(s)}async save(e){const t=this.createApplicationEditor(),s=await t.createPageEditor(e.fileName);return s.setAttr(e.attr,e.value),await s.save(),null}async _new(e){const t=this.createApplicationEditor(),s=await t.newPageAndPageLinkData(e);return await t.save(),s}async delete(e){const t=this.createApplicationEditor();await t.removePageFile(e.page);const s=t.removeColData("pageLinks",e.page);return await t.save(),s}async getView(e){const t=await super.getView(e);if("VisualView.html"===e.view){const s=this.createApplicationEditor(),r=await s.getPage(e.page);return t.data.js=await r.getCustomFile("js"),t.data.jsx=await r.getCustomFile("jsx"),t.data.less=await r.getCustomFile("less"),t}return t}async createController(e){const t=this.createApplicationEditor(),s=await t.getPage(e.page);return{js:await s.createJs(e)}}async createView(e){const t=this.createApplicationEditor(),s=await t.getPage(e.page);return{jsx:await s.createJsx(e)}}async createStyle(e){const t=this.createApplicationEditor(),s=await t.getPage(e.page);return{less:await s.createLess(e)}}async saveController(e){const t=this.createApplicationEditor(),s=await t.getPage(e.page);return await s.saveCustomFile("js",e.text),{js:e.text}}async createModelBackJs(e){const t=this.createApplicationEditor(),s=await t.getPage(e.page);return{js:await s.createModelBackJs(e)}}}t.PageEditorController=PageEditorController},6946:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageLinkEditorController=void 0;const r=s(4095);class PageLinkEditorController extends r.EditorController{async save(e){const t=this.createApplicationEditor();return t.createItemEditor("pageLinks",e.pageLink).setAttr(e.attr,e.value),await t.save(),null}async moveUp(e){const t=this.createApplicationEditor();return t.moveItemUp("pageLinks",e.page),await t.save(),"ok"}async moveDown(e){const t=this.createApplicationEditor();return t.moveItemDown("pageLinks",e.page),await t.save(),"ok"}}t.PageLinkEditorController=PageLinkEditorController},2962:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParamEditorController=void 0;const r=s(4095),o=s(8978);class ParamEditorController extends r.EditorController{async _new(e){(0,o.debug)("ParamEditorController._new");const t=this.createApplicationEditor(),s=t.createItemEditor("databases",e.database).newItemData("Param","params",e);return await t.save(),s}async save(e){(0,o.debug)("ParamEditorController.save");const t=this.createApplicationEditor();return t.createItemEditor("databases",e.database).createItemEditor("params",e.param).setAttr(e.attr,e.value),await t.save(),null}async delete(e){(0,o.debug)("ParamEditorController.delete");const t=this.createApplicationEditor(),s=t.createItemEditor("databases",e.database).removeColData("params",e.param);return await t.save(),s}}t.ParamEditorController=ParamEditorController},7480:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableEditorController=void 0;const r=s(4095),o=s(8978);class TableEditorController extends r.EditorController{async _new(e){(0,o.debug)("TableEditorController._new");const t=this.createApplicationEditor(),s=t.createItemEditor("databases",e.database).newItemData("Table","tables",e);return await t.save(),s}async delete(e){(0,o.debug)("TableEditorController.delete");const t=this.createApplicationEditor(),s=t.createItemEditor("databases",e.database).removeColData("tables",e.table);return await t.save(),s}async moveUp(e){const t=this.createApplicationEditor();return t.createItemEditor("databases",e.database).moveItemUp("tables",e.table),await t.save(),"ok"}async moveDown(e){const t=this.createApplicationEditor();return t.createItemEditor("databases",e.database).moveItemDown("tables",e.table),await t.save(),"ok"}async save(e){(0,o.debug)("TableEditorController.save");const t=this.createApplicationEditor();return t.createItemEditor("databases",e.database).createItemEditor("tables",e.table).setAttr(e.attr,e.value),await t.save(),null}}t.TableEditorController=TableEditorController},7894:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisualEditorController=void 0;const r=s(4095);class VisualEditorController extends r.EditorController{}t.VisualEditorController=VisualEditorController},2527:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EditorModule=void 0;const n=s(997),l=a(s(1017)),c=a(s(8684)),d=s(9918),u=s(3874),h=s(7317),g=s(3024),p=i(s(7756)),m=s(5024),w=s(8978),f=s(4147),b=["Application","Database","Param","Table","Column","DataSource","KeyColumn","Page","PageLink","Form","Field","Action"],C=["save","_new","delete","getView","saveView","saveController","createView","createStyle","createController","get","getTableInfo","changeClass","moveUp","moveDown","createModelBackJs"];t.EditorModule=class EditorModule{constructor(e){this.hostApp=e}async init(){this.css=(await d.BkHelper.getFilePaths(l.default.join(this.hostApp.getFrontendDirPath(),"editor/public"),"css")).map((e=>`/editor/public/${e}`)),this.js=(await d.BkHelper.getFilePaths(l.default.join(this.hostApp.getFrontendDirPath(),"editor/public"),"js")).map((e=>`/editor/public/${e}`))}getLinks(){return["/lib/codemirror-4.8/lib/codemirror.css","/lib/codemirror-4.8/theme/cobalt.css",...this.css]}getScripts(){return["/lib/codemirror-4.8/lib/codemirror.js","/lib/codemirror-4.8/mode/javascript/javascript.js",...this.js]}async handleEditorGet(e,t,s){(0,w.debug)("EditorModule.handleEditorGet");const r={app:(await u.BkApplication.loadAppInfo(this.hostApp.getAppFilePath(s))).appFile.data,nodeEnv:this.hostApp.getNodeEnv(),logErrorUrl:"/error"},o=c.default.renderToStaticMarkup((0,n.jsx)(h.Links,{links:this.getLinks()})),i=c.default.renderToStaticMarkup((0,n.jsx)(g.Scripts,{scripts:this.getScripts()})),a=(0,m.home)(f.version,Object.assign(Object.assign({},r),{runAppLink:`/viewer/${s.getAppDirName()}/${s.getAppFileName()}/${s.getEnv()}/${s.getDomain()}/?debug=1`}),`/viewer/${s.getAppDirName()}/${s.getAppFileName()}/${s.getEnv()}/${s.getDomain()}/?debug=1`,s.getAppDirName(),s.getAppFileName(),s.getEnv(),o,i);t.end(a)}async handleEditorPost(e,t,s){if((0,w.debug)("EditorModule.handleEditorPost",e.body),-1===b.indexOf(e.body.controller))throw new Error(`unknown controller: ${e.body.controller}`);if(-1===C.indexOf(e.body.action))throw new Error(`unknown action ${e.body.action}`);const r=`${e.body.controller}EditorController`,o=p[r];if(!o)throw new Error(`no class with name ${r}`);const i=new o(await u.BkApplication.loadAppInfo(this.hostApp.getAppFilePath(s)),this.hostApp,null);await i.init(s);const a=e.body.action;if(!i[a])throw new Error(`no method: ${r}.${a}`);const n=await i[a](s.params);if(void 0===n)throw new Error("handleEditorPost: result is undefined");t.json(n)}}},5024:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.home=void 0;t.home=(e,t,s,r,o,i,a,n)=>`<!DOCTYPE html>\n<html class="editor" lang="en">\n<head>\n\x3c!-- ${e} --\x3e\n<meta charset="utf-8">\n<title>${r}/${o}[${i}] - QForms Editor</title>\n\x3c!-- links --\x3e\n${a}\n\x3c!-- scripts --\x3e\n${n}\n\x3c!--<script type="text/javascript">\n    document.addEventListener('DOMContentLoaded', async () => {\n        console.debug('editor.ejs DOMContentLoaded');\n        const data = JSON.parse(document.querySelector('script[type="application/json"]').textContent);\n        const runAppLink = "${s}";\n        const editorFrontHostApp = new EditorFrontHostApp(data, runAppLink);\n        editorFrontHostApp.init();\n        await editorFrontHostApp.run();\n    });\n<\/script>--\x3e\n<script type="application/json">${JSON.stringify(t)}<\/script>\n</head>\n<body class="editor__body">\n<div class="editor__root"></div>\n</body>\n</html>\n`},8103:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(5346),t),o(s(1784),t),o(s(2576),t),o(s(6032),t),o(s(2882),t),o(s(2315),t),o(s(1424),t),o(s(5249),t),o(s(7580),t),o(s(2426),t),o(s(6252),t),o(s(1987),t),o(s(7484),t),o(s(8868),t),o(s(3690),t),o(s(6348),t),o(s(5238),t),o(s(4743),t),o(s(2685),t),o(s(9491),t),o(s(7185),t),o(s(5410),t),o(s(8582),t),o(s(4783),t),o(s(506),t),o(s(4268),t),o(s(5851),t),o(s(9464),t),o(s(6329),t),o(s(5635),t),o(s(7634),t),o(s(9877),t),o(s(5439),t),o(s(4483),t),o(s(1900),t),o(s(1625),t),o(s(1205),t),o(s(5246),t),o(s(6946),t),o(s(2962),t),o(s(7480),t),o(s(6447),t),o(s(7894),t),o(s(6351),t),o(s(1314),t),o(s(1239),t),o(s(91),t)},7756:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(9918),t),o(s(111),t),o(s(8491),t),o(s(3307),t),o(s(8759),t),o(s(1177),t),o(s(7722),t),o(s(1929),t),o(s(8103),t)},5637:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IndexModule=void 0;const o=s(997),i=r(s(1017)),a=r(s(8684)),n=s(3874),l=s(9918),c=s(7317),d=s(3024),u=s(4147);t.IndexModule=class IndexModule{constructor(e){this.hostApp=e}async init(){this.css=(await l.BkHelper.getFilePaths(i.default.join(this.hostApp.getFrontendDirPath(),"index/public"),"css")).map((e=>`/index/public/${e}`)),this.js=(await l.BkHelper.getFilePaths(i.default.join(this.hostApp.getFrontendDirPath(),"index/public"),"js")).map((e=>`/index/public/${e}`))}async fill(){const e=this.hostApp.makeDistDirPathForApp(this.hostApp.appsDirPath),t=await n.BkApplication.getAppInfos(this.hostApp.appsDirPath,e);return{nodeEnv:this.hostApp.getNodeEnv(),appInfos:t.map((e=>({fullName:e.fullName,envs:e.envs})))}}getLinks(){return this.css}getScripts(){return this.js}async render(){const e=a.default.renderToStaticMarkup((0,o.jsx)(c.Links,{links:this.getLinks()})),t=a.default.renderToStaticMarkup((0,o.jsx)(d.Scripts,{scripts:this.getScripts()})),s=await this.fill(),r=JSON.stringify(s);return`<!DOCTYPE html>\n<html>\n<head>\n    \x3c!-- ${u.version}> --\x3e\n    <meta charSet="utf-8">\n    <title>QForms v${u.version}</title>\n    \x3c!-- links --\x3e\n    ${e}\n    \x3c!-- scripts --\x3e\n    ${t}\n    <script type="application/json">${r}<\/script>\n    \x3c!--<script>\n        document.addEventListener('DOMContentLoaded', () => {\n            // console.debug('DOMContentLoaded');\n            const data = JSON.parse(document.querySelector('script[type="application/json"]').textContent);\n            new IndexFrontHostApp(data).init();\n        });\n    <\/script>--\x3e\n</head>\n<body>\n<div id="root"></div>\n</body>\n</html>`}}},2469:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MonitorModule=void 0;const o=s(997),i=r(s(1017)),a=s(9918),n=r(s(8684)),l=s(7317),c=s(3024),d=s(4147);t.MonitorModule=class MonitorModule{constructor(e){this.hostApp=e}async init(){this.css=(await a.BkHelper.getFilePaths(i.default.join(this.hostApp.getFrontendDirPath(),"monitor/public"),"css")).map((e=>`/monitor/public/${e}`)),this.js=(await a.BkHelper.getFilePaths(i.default.join(this.hostApp.getFrontendDirPath(),"monitor/public"),"js")).map((e=>`/monitor/public/${e}`))}fill(){return{nodeEnv:this.hostApp.getNodeEnv(),uptime:Date.now()-this.hostApp.startTime.getTime(),applications:Object.keys(this.hostApp.applications).map((e=>{const t=this.hostApp.applications[e];return{route:e,version:t.getVersion(),pages:Object.keys(t.pages).map((e=>({name:e}))),clients:t.clients.map((e=>({uuid:e.uuid,userId:e.userId,ip:a.BkHelper.getWebSocketIP(e),version:e.customFields.version})))}}))}}getLinks(){return this.css}getScripts(){return this.js}checkCredentials(e){const t=e.headers.authorization.substr(6),s=new Buffer(t,"base64").toString(),[r,o]=s.split(":");return r===this.hostApp.getParams().monitor.username&&o===this.hostApp.getParams().monitor.password}authorize(e){if(this.hostApp.isDevelopment())return!0;if(!this.hostApp.getParams().monitor)throw new Error("no monitor params");return e.headers.authorization&&"Basic"===e.headers.authorization.substr(0,5)&&this.checkCredentials(e)}render(){const e=n.default.renderToStaticMarkup((0,o.jsx)(l.Links,{links:this.getLinks()})),t=n.default.renderToStaticMarkup((0,o.jsx)(c.Scripts,{scripts:this.getScripts()})),s=JSON.stringify(this.fill());return`<!DOCTYPE html>\n<html class="monitor" lang="en">\n<head>\n    \x3c!-- ${d.version}> --\x3e\n    <meta charSet="utf-8">\n    <title>QForms monitor v${d.version}</title>\n    \x3c!-- links --\x3e\n    ${e}\n    \x3c!-- scripts --\x3e\n    ${t}\n    <script type="application/json">${s}<\/script>\n</head>\n<body class="monitor__body">\n    <div class="monitor__root"></div>\n</body>\n</html>`}}},1185:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkAction=void 0;const r=s(4484);class BkAction extends r.BkModel{fillAttributes(e){e.name=this.getAttr("name"),e.caption=this.getAttr("caption")}}t.BkAction=BkAction},3874:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BkApplication=void 0;const a=i(s(1017)),n=s(5828),l=s(8491),c=s(4484),d=s(9918),u=s(5721),h=s(1177),g=s(1937),p=s(6224),m=s(7348),w=i(s(7791)),f=s(8978),b=s(4147);class BkApplication extends c.BkModel{constructor(e,t,s="local"){if(super(e.appFile.data),this.appInfo=e,this.hostApp=t,this.env=s,this.databases=[],this.actions=[],this.dataSources=[],this.pages={},this.clients=[],!t)throw new Error("BkApplication: no hostApp")}async init(e){await super.init(e),await this.createColItems("databases",e),await this.createColItems("actions",e),await this.createColItems("dataSources",e),this.links=await this.getLinks(e),this.scripts=await this.getScripts(e),await this.createMenu(e)}getHostApp(){return this.hostApp}async getLinks(e){const t=e.getVirtualPath();return(await d.BkHelper.getFilePaths(this.getPublicDirPath(),"css")).map((e=>`${t}/${e}`))}async getScripts(e){const t=e.getVirtualPath(),s=this.getPublicDirPath();return(await d.BkHelper.getFilePaths(s,"js")).map((e=>`${t}/${e}`))}async deinit(){(0,f.debug)(`Application.deinit: ${this.getName()}`),await super.deinit();for(const e of this.databases)await e.deinit()}getDirPath(){return this.appInfo.dirPath}getDistDirPath(){return this.appInfo.distDirPath}getPublicDirPath(){const e=this.getDistDirPath();if(!e)throw new Error("no distDirPath");return a.default.join(e,"public")}getText(){const e=this.getAttr("lang")||"en";return w[e]}getVersion(){return null}fillAttributes(e){e.class=this.getClassName(),e.name=this.getAttr("name"),e.caption=this.getAttr("caption"),e.lang=this.getAttr("lang"),e.theme=this.getAttr("theme"),e.cssBlock=this.getAttr("cssBlock"),e.viewClass=this.getAttr("viewClass"),e.ctrlClass=this.getAttr("ctrlClass")}async fill(e){const t=Date.now(),s=await super.fill(e);return s.route=e.getRoute(),s.domain=e.getDomain(),s.virtualPath=e.getVirtualPath(),s.logErrorUrl=this.getHostApp().getFrontLogUrl()||"/error",s.versions={platform:b.version,app:this.getVersion()},await this.fillCollection(s,"databases",e),await this.fillCollection(s,"actions",e),await this.fillCollection(s,"dataSources",e),s.nodeEnv=this.getHostApp().getNodeEnv(),s.text=this.getText(),s.menu=this.menu,s.nav=this.nav,s.uuid=(0,n.v4)(),s.actions=this.getCol("actions").map((e=>({name:l.BaseModel.getName(e),caption:l.BaseModel.getAttr(e,"caption")}))),s.pages=await this.fillPages(e),s.user=this.isAuthentication()?await this.getClientUserFromServerUser(e):null,s.time=Date.now()-t,s}async getClientUserFromServerUser(e){const t=e.getUser();return{id:t.id,login:t.name}}async createMenu(e){const t={},s={},r=this.getItemNames("pageLinks");for(const e of r){const r=this.createPageLink(e),o=r.getAttr("menu");if(o){const e=r.getPageFilePath(),i=new h.JsonFile(e);await i.read(),t[o]||(t[o]=[]),t[o].push({type:"page",page:r.getAttr("name"),caption:i.getAttr("caption")}),s[o]||(s[o]=[]),s[o].push({page:r.getAttr("name"),caption:i.getAttr("caption")})}}const o=this.getCol("actions");o.length&&(t.Actions=o.map((e=>({type:"action",action:l.BaseModel.getName(e),caption:l.BaseModel.getAttr(e,"caption")})))),this.menu=t,this.nav=s}createPageLink(e){const t=this.getColItemData("pageLinks",e);return new u.BkPageLink(t,this)}async createPage(e){if(!this.isData("pageLinks",e))throw new Error(`no page with name: ${e}`);const t=this.createPageLink(e).getAttr("fileName"),s=a.default.join(this.getDirPath(),t),r=await d.BkHelper.readTextFile(s),o=JSON.parse(r),i=await this.createChildModel("pages",o);return await i.init(),i}authorizePage(e,t){return!0}async getPage(e,t){const s=e.getUser();if(s&&!1===this.authorizePage(s,t))throw new Error("authorization error");return this.pages[t]?this.pages[t]:this.pages[t]=await this.createPage(t)}getStartupPageLinkNames(){return this.getCol("pageLinks").filter((e=>"true"===l.BaseModel.getAttr(e,"startup"))).map((e=>l.BaseModel.getName(e)))}async fillPages(e){const t=[];if(e.query.page){const s=await this.getPage(e,e.query.page),r=await s.fill(e);t.push(r)}else for(const s of this.getStartupPageLinkNames()){const r=await this.getPage(e,s),o=await r.fill(e);t.push(o)}return t}async authenticate(e,t,s){return(0,f.debug)("Application.authenticate"),t===this.getAttr("user")&&s===this.getAttr("password")?{id:1,name:t}:null}isAuthentication(){return"true"===this.getAttr("authentication")}async getUsers(e){return null}async rpc(e,t){if((0,f.debug)("BkApplication.rpc",e,t.getBody()),this[e])return await this[e](t);throw new g.HttpError({message:`no remote proc ${this.constructor.name}.${e}`,data:{method:`${this.constructor.name}.rpc`},context:t})}getEnv(){return this.env}getEnvVarValue(e){if(!e)throw new Error("no name");const t=this.getEnv(),s=this.data.env[t];if(!s)throw new Error(`no env ${t}`);if(s[e])return s[e];throw new Error(`no env ${e} in ${t}`)}getApp(){return this}findDatabase(e){return this.databases.find((t=>t.getName()===e))}getDatabase(e){const t=this.findDatabase(e);if(!t)throw new Error(`no database with name: ${e}`);return t}async initContext(e){}static makeAppInfoFromAppFile(e,t){const{data:s,filePath:r}=e,o=a.default.basename(a.default.dirname(r)),i=a.default.basename(r,a.default.extname(r));return{appFile:e,name:l.BaseModel.getName(s),caption:l.BaseModel.getAttr(s,"caption"),fullName:(0,a.join)(o,i),envs:BkApplication.getEnvList(s),dirName:o,fileName:i,filePath:a.default.resolve(r),fileNameExt:a.default.basename(r),extName:a.default.extname(r),dirPath:a.default.resolve(a.default.dirname(r)),distDirPath:t}}static async loadAppInfo(e,t){const s=new h.JsonFile(e);await s.read();return BkApplication.makeAppInfoFromAppFile(s,t)}static async getAppInfos(e,t){const s=await d.BkHelper._glob(a.default.join(e,"*/*.json")),r=[];for(let e=0;e<s.length;e++){const o=s[e],i=await BkApplication.loadAppInfo(o,t);i&&r.push(i)}return r}findDataSource(e){return this.dataSources.find((t=>t.getName()===e))}getDataSource(e){const t=this.findDataSource(e);if(!t)throw new Error(`${this.getName()}: no data source ${e}`);return t}getViewClassName(){return this.getAttr("viewClass")||"ApplicationView"}async connect(e){try{for(const t of this.databases)await t.connect(e)}catch(t){for(const t of this.databases)t.isConnected(e)&&await t.release(e);throw t}}async release(e){for(const t of this.databases)await t.release(e)}addClient(e){this.clients.push(e)}removeClient(e){const t=this.clients.indexOf(e);if(-1===t)throw new Error(`cannot find socket: ${e.route} ${e.uuid}`);this.clients.splice(t,1)}broadcastDomesticResultToClients(e,t){if((0,f.debug)("Application.broadcastDomesticResultToClients",e.getReq().body.uuid,t),!e.getReq().body.uuid)throw new Error("no uuid");if(!t)throw new Error("no result");const s=e.getReq().body.uuid;for(const e of this.clients)e.uuid!==s&&e.send(JSON.stringify({type:"result",data:t}))}broadcastForeignResultToClients(e,t){if((0,f.debug)("Application.broadcastForeignResultToClients",e.getReq().body.uuid,t),!e.getReq().body.uuid)throw new Error("no uuid");if(!t)throw new Error("no result");const s=this.composeForeignResult(t);if(s){const t=e.getReq().body.uuid;for(const e of this.clients)e.uuid!==t&&e.send(JSON.stringify({type:"result",data:s}))}}composeForeignResult(e){let t=null;for(const s in e){const r=this.findDatabase(s);if(r)for(const o in e[s]){r.findTable(o)&&(t||(t=new p.Result),t[s]||(t[s]={}),t[s][o]={refresh:!0})}}return t}getTitle(e){return this.getAttr("caption")}getLoginViewClassName(){return"LoginView"}isAvailable(){return!0}async handleGetFile(e,t){const s=a.default.join(this.getPublicDirPath(),e.getUri());await d.BkHelper.exists(s)?e.getRes().sendFile(s):(e.getRes().status(404).end("Not Found"),await this.getHostApp().logError(new Error(`not found ${e.getUri()}`),e.getReq()))}renderIndexHtml(e,t,s,r,o,i,a){return(0,m.home)(this,e,t,s,r,o,i,a)}static getEnvList(e){return["local",...e.env?Object.keys(e.env).filter((e=>"local"!==e)):[]]}}t.BkApplication=BkApplication},4437:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkColumn=void 0;const r=s(4484);class BkColumn extends r.BkModel{fillAttributes(e){e.name=this.getAttr("name"),e.caption=this.getAttr("caption"),e.type=this.getAttr("type")}isKey(){return"true"===this.getAttr("key")}isAuto(){return"true"===this.getAttr("auto")}getApp(){return this.getParent().getParent().getParent()}}t.BkColumn=BkColumn},9727:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BkDataSource=void 0;const o=r(s(1017)),i=s(4484),a=s(9918),n=s(7017),l=s(6676),c=s(5915),d=s(8141),u=s(8978);class BkDataSource extends i.BkModel{constructor(){super(...arguments),this.keyColumns=[],this.rows=[]}getDirPath(){return o.default.join(this.getParent().getDirPath(),"dataSources",this.getName())}getJsonFilePath(){return o.default.join(this.getDirPath(),`${this.getName()}.json`)}async init(e){await super.init(e),this.keyColumns=this.getKeyColumns();const t=this.getJsonFilePath();if(await a.BkHelper.exists(t)){const e=await a.BkHelper.readTextFile(t);this.rows=JSON.parse(e)}}getKeyColumns(){const e=this.getItemNames("keyColumns");if(!e.length)throw new Error(`${this.getFullName()}: DataSource without table must have at least one key column`);return e}checkKeyColumns(e){for(const t of this.keyColumns)if(!e.hasOwnProperty(t))throw new Error(`${this.getFullName()}: no key column '${t}' in result set`)}checkKeyFields(){const e=this.getForm().fields.map((e=>e.getAttr("column")));for(const t of this.keyColumns)if(!e.includes(t))throw new Error(`[${this.getFullName()}]: no field with key column: ${t}`)}checkRow(e){this.checkKeyColumns(e),this.isDefaultOnForm()&&this.checkFields(e)}checkRows(e){e[0]&&this.checkRow(e[0])}checkNotUsedColumns(e){const t=Object.keys(e),s=this.getForm().fields.map((e=>e.getAttr("column"))).filter((e=>!!e));for(const r of t)if(!s.includes(r))throw(0,u.debug)("rowColumns:",t),(0,u.debug)("formColumns:",s),(0,u.debug)("row:",e),new Error(`${this.getFullName()}: not used column "${r}" in result set`)}checkFields(e){for(const t of this.getForm().fields){const s=t.getAttr("column");if(s){if(!e.hasOwnProperty(s))throw new Error(`[${t.getFullName()}]: no column '${s}' in result set`)}else if(!t.getAttr("value"))throw new Error(`[${t.getFullName()}]: no column and no value attr for calculation`)}}encodeRows(e){return e.map((e=>this.encodeRow(e)))}encodeRow(e){if(!e)throw new Error("encodeRow: need row");const t={};if(this.isDefaultOnForm())for(const s of this.getForm().fields){const r=s.getAttr("column");if(t[r]=s.valueToRaw(e[r]),s.isAttr("displayColumn")){const r=s.getAttr("displayColumn");t[r]=s.valueToRaw(e[r])}}else for(const s in e)t[s]=a.BkHelper.encodeValue(e[s]);return t}getApp(){return this.getParent().getApp()}getKeyValuesFromKey(e){const t=JSON.parse(e);if(t.length!==this.keyColumns.length)throw new Error(`key length mismatch: ${t.length} of ${this.keyColumns.length}`);const s={};for(let e=0;e<this.keyColumns.length;e++){s[this.keyColumns[e]]=t[e]}return s}getKeyFromValues(e){const t=[];for(let s=0;s<this.keyColumns.length;s++){const r=this.keyColumns[s],o=e[r];if(null==o)throw new Error(`getKeyFromValues: no value of ${r} column`);t.push(o)}return JSON.stringify(t)}getFullName(){return this.isOnForm()?[this.getParent().getPage().getName(),this.getParent().getName(),this.getName()].join("."):this.getParent()instanceof n.BkPage?[this.getParent().getName(),this.getName()].join("."):this.getName()}static keyToParams(e,t="key"){if("string"!=typeof e)throw new Error("key not string");const s={},r=JSON.parse(e);if(1===r.length)s[t]=r[0];else{if(!(r.length>1))throw new Error(`invalid key: ${e}`);for(let e=0;e<r.length;e++)s[`${t}${e+1}`]=r[e]}return s}calcNewKeyValues(e,t){return this.keyColumns.reduce(((s,r)=>{if(void 0===e[r])throw new Error(`no key column in values: ${r}`);return s[r]=void 0!==t[r]?t[r]:e[r],s}),{})}calcNewKey(e,t){const s=this.getKeyValuesFromKey(e),r=this.calcNewKeyValues(s,t);return this.getKeyFromValues(r)}fillAttributes(e){e.class=this.getClassName(),e.name=this.getAttr("name"),this.isAttr("database")&&(e.database=this.getAttr("database")),this.isAttr("table")&&(e.table=this.getAttr("table"))}async fill(e){const t=await super.fill(e);return t.keyColumns=this.keyColumns,t.rows=await this.getRows(),t}async getRows(){return this.rows}isOnForm(){return this.getParent()instanceof l.BkForm}isDefaultOnForm(){return"default"===this.getName()&&this.isOnForm()}isDefaultOnRowForm(){return"default"===this.getName()&&this.getParent()instanceof c.BkRowForm}isDefaultOnTableForm(){return"default"===this.getName()&&this.getParent()instanceof d.BkTableForm}async read(e){throw new Error(`${this.constructor.name}.select not implemented`)}async create(e,t=null){throw new Error(`${this.constructor.name}.create not implemented`)}async update(e){throw new Error(`${this.constructor.name}.update not implemented`)}async delete(e){throw new Error(`${this.constructor.name}.delete not implemented`)}getForm(){if(!this.isOnForm())throw new Error(`${this.getFullName()}: not form data source`);return this.getParent()}getAccess(e){return{create:!0,read:!0,update:!0,delete:!0}}getDatabase(){throw new Error(`${this.constructor.name}.getDatabase not implemented`)}getLimit(){return""!==this.getAttr("limit")?parseInt(this.getAttr("limit")):null}}t.BkDataSource=BkDataSource},1693:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkNoSqlDataSource=void 0;const r=s(6576),o=s(6224),i=s(9727),a=s(9918),n=s(8978);class BkNoSqlDataSource extends r.BkPersistentDataSource{constructor(e,t){super(e,t),this.table=this.getAttr("table")?this.getDatabase().getTable(this.getAttr("table")):null}async fill(e){const t=await super.fill(e);if(this.isDefaultOnForm()&&this.checkKeyFields(),this.isDefaultOnForm()&&this.getParent().isNewMode(e)){const e=this.getLimit();return e&&(t.limit=e),t.rows=[],t.count=0,t}this.getLimit()&&(e.params.frame=1);try{const[s,r]=await this.read(e);t.rows=s,t.count=r}catch(e){throw e.message=`select error of ${this.getFullName()}: ${e.message}`,e}return this.isDefaultOnRowForm()&&t.rows[0]&&this.getParent().dumpRowToParams(t.rows[0],e.querytime.params),this.getLimit()&&(t.limit=e.params.limit),t}async read(e){if(!0!==this.getAccess(e).read)throw new Error(`[${this.getFullName()}]: access denied`);const t=this.getLimit();if(t){if(!e.params.frame)throw new Error("no frame param");e.setParam("skip",(e.params.frame-1)*t),e.setParam("limit",t)}const s=Date.now(),r=await this.getDatabase().queryRows(e,this.getSelectQuery(e),this.getSelectParams(e));(0,n.debug)("rows query time:",Date.now()-s),this.checkRows(r);const o=this.encodeRows(r);let i=null;if(this.isDefaultOnTableForm()&&this.getLimit())try{const t=Date.now();i=await this.getDatabase().queryScalar(e,this.getCountQuery(e),this.getSelectParams(e)),(0,n.debug)("count query time:",Date.now()-t)}catch(e){throw e.message=`${this.getFullName()}: ${e.message}`,e}return[o,i]}async create(e,t=null){if((0,n.debug)("NoSqlDataSource.create"),!0!==this.getAccess(e).create)throw new Error(`[${this.getFullName()}]: access denied.`);if(!this.table)throw new Error(`${this.getFullName()}: no link to table object: ${this.getAttr("table")}`);const s=this.getAttr("database"),r=this.getAttr("table"),a=t||this.decodeRow(e.getBody().row);(0,n.debug)("values",a);const l=await this.getDatabase().insertOne(e,r,a);(0,n.debug)("insertResult:",l);const c={_id:l.insertedId},d=this.getKeyFromValues(c);if(!d)throw new Error("create: cannot calc row key");(0,n.debug)("key:",d);const u=i.BkDataSource.keyToParams(d),[h]=await this.getDatabase().queryRows(e,this.getSelectQuery(e),u);if(!h)throw new Error("select query does not return row");this.checkRow(h);const g=this.encodeRow(h),p=new o.Result;return o.Result.addInsertToResult(p,s,r,d),o.Result.addInsertExToResult(p,s,r,d,g),p}async update(e){if((0,n.debug)("NoSqlDataSource.update"),!0!==this.getAccess(e).update)throw new Error(`[${this.getFullName()}]: access denied.`);if(!this.table)throw new Error(`no database table desc: ${this.getAttr("table")}`);const t=this.getAttr("database"),s=this.getAttr("table"),r=this.decodeChanges(e.getBody().changes),a=Object.keys(r)[0];(0,n.debug)("key:",a);const l=this.getKeyValuesFromKey(a),c=r[a],d=await this.getDatabase().updateOne(e,s,l,{$set:c});(0,n.debug)("updateResult",d);const u=this.calcNewKey(a,c),h=i.BkDataSource.keyToParams(u);(0,n.debug)("newKey:",u);const[g]=await this.getDatabase().queryRows(e,this.getSelectQuery(e),h);if(!g)throw new Error("select query does not return row");this.checkRow(g);const p=this.encodeRow(g),m=new o.Result;return o.Result.addUpdateToResult(m,t,s,a,u),o.Result.addUpdateExToResult(m,t,s,a,p),m}async delete(e){if(!0!==this.getAccess(e).delete)throw new Error(`${this.getFullName()}: access denied`);const{key:t}=e.params,s=this.getKeyValuesFromKey(t),r=await this.getDatabase().deleteOne(e,this.getAttr("table"),s);(0,n.debug)("updateResult",r);const i=new o.Result;return o.Result.addDeleteToResult(i,this.getAttr("database"),this.getAttr("table"),t),i}getSelectQuery(e){const t=this.getAttr("selectQuery");if(!t)throw new Error(`${this.getFullName()}: no selectQuery`);return t}getCountQuery(e){const t=this.getAttr("countQuery");if(!t)throw new Error(`${this.getFullName()}: no countQuery`);return t}getSelectParams(e){return e.getParams()}checkRow(e){this.checkKeyColumns(e),this.isDefaultOnForm()}encodeRow(e){if(!e)throw new Error("encodeRow: need row");const t={};if(this.isDefaultOnForm())for(const s of this.getForm().fields){const r=s.getAttr("column");if(t[r]=void 0!==e[r]?s.valueToRaw(e[r]):"null",s.isAttr("displayColumn")){const r=s.getAttr("displayColumn");t[r]=s.valueToRaw(e[r])}}else for(const s in e)t[s]=a.BkHelper.encodeValue(e[s]);return t}}t.BkNoSqlDataSource=BkNoSqlDataSource},6576:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkPersistentDataSource=void 0;const r=s(9727);class BkPersistentDataSource extends r.BkDataSource{constructor(e,t){super(e,t),this.table=null,this.getAttr("table")&&(this.table=this.getDatabase().getTable(this.getAttr("table")))}getChanges(e){return this.decodeChanges(e.getBody().changes)}decodeChanges(e){const t={};for(const s in e)t[s]=this.decodeRow(e[s]);return t}decodeRow(e){const t=this.getForm();if(!t)throw new Error("not form ds");const s={};for(const r of t.fields){const t=r.getAttr("column");if(Object.prototype.hasOwnProperty.call(e,t)){const o=r.rawToValue(e[t]);s[t]=r.valueToDbValue(o)}}return s}getDatabase(){const e=this.getAttr("database");if(!e)throw new Error(`${this.getFullName()}: no database name`);return this.getApp().getDatabase(e)}getTable(){if(!this.table)throw new Error(`${this.getFullName()}: no table`);return this.table}}t.BkPersistentDataSource=BkPersistentDataSource},5683:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkSqlDataSource=void 0;const r=s(6576),o=s(9727),i=s(9918),a=s(6224),n=s(8978);class BkSqlDataSource extends r.BkPersistentDataSource{async fill(e){const t=await super.fill(e);if(this.isDefaultOnForm()&&this.checkKeyFields(),this.isDefaultOnForm()&&this.getParent().isNewMode(e)){const e=this.getLimit();return e&&(t.limit=e),t.rows=[],t.count=0,t}this.getLimit()&&(e.params.frame=1);try{const[s,r]=await this.read(e);t.rows=s,t.count=r}catch(e){throw e.message=`read error of ${this.getFullName()}: ${e.message}`,e}return this.isDefaultOnRowForm()&&t.rows[0]&&this.getParent().dumpRowToParams(t.rows[0],e.querytime.params),this.getLimit()&&(t.limit=e.params.limit),t}getKeyColumns(){return this.table?this.table.getKeyColumns():super.getKeyColumns()}getCountQuery(e){let t=this.getAttr("countQuery");if(!t)throw new Error(`${this.getFullName()}: no countQuery`);return this.isOnForm()&&(t=this.getParent().replaceThis(e,t)),t=this.templateQuery(e,t),t}getSingleQuery(e){let t=this.getAttr("singleQuery");if(!t)throw new Error(`no singleQuery: ${this.getFullName()}`);return this.isOnForm()&&(t=this.getParent().replaceThis(e,t)),t=this.templateQuery(e,t),t}getMultipleQuery(e){let t=this.getAttr("multipleQuery");if(!t)throw new Error(`no multipleQuery: ${this.getFullName()}`);return this.isOnForm()&&(t=this.getParent().replaceThis(e,t)),t=this.templateQuery(e,t),t}templateQuery(e,t){const s=this.getSelectParams(e);let r=t;return r=t.replace(/\[([\w.@]+)\]/g,((e,t)=>s[t]?s[t]:e)),r}getSelectParams(e){return e.getParams()}async read(e){if(!0!==this.getAccess(e).read)throw new Error(`[${this.getFullName()}]: access denied`);const t=this.getLimit();if(t){if(!e.params.frame)throw new Error("no frame param");e.params.offset=(e.params.frame-1)*t,e.params.limit=t}const s=this.isDefaultOnRowForm()?this.getSingleQuery(e):this.getMultipleQuery(e),r=this.getSelectParams(e),o=await this.getDatabase().queryRows(e,s,r);this.checkRows(o);const i=this.encodeRows(o);let a=null;if(this.isDefaultOnTableForm()&&this.getLimit())try{const t=await this.getDatabase().queryScalar(e,this.getCountQuery(e),r);a=parseInt(t,10)}catch(e){throw e.message=`${this.getFullName()}: ${e.message}`,e}return[i,a]}async create(e,t=null){if((0,n.debug)("SqlDataSource.create"),!0!==this.getAccess(e).create)throw new Error(`[${this.getFullName()}]: access denied.`);if(!this.table)throw new Error(`${this.getFullName()}: no link to table object: ${this.getAttr("table")}`);const s=this.getAttr("database"),r=this.getAttr("table"),i=t||this.decodeRow(e.getBody().row),l=this.getAutoColumnTypes(),c=await this.getDatabase().insertRow(e,r,i,l);(0,n.debug)("newRow:",c);const d=this.getKeyFromValues(c);if(!d)throw new Error("insert: cannot calc row key");(0,n.debug)("key:",d);const u=o.BkDataSource.keyToParams(d),h=this.getSingleQuery(e),[g]=await this.getDatabase().queryRows(e,h,u);if(!g)throw new Error("singleQuery does not return row");this.checkRow(g);const p=this.encodeRow(g),m=new a.Result;return a.Result.addInsertToResult(m,s,r,d),a.Result.addInsertExToResult(m,s,r,d,p),m}async update(e){if((0,n.debug)("SqlDataSource.update"),!0!==this.getAccess(e).update)throw new Error(`[${this.getFullName()}]: access denied.`);if(!this.table)throw new Error(`no database table desc: ${this.getAttr("table")}`);const t=this.getAttr("database"),s=this.getAttr("table"),r=this.getChanges(e),[l]=Object.keys(r),c=this.getKeyValuesFromKey(l),d=r[l],u=this.getDatabase().getUpdateQuery(s,d,c),h=i.BkHelper.mapObject(d,((e,t)=>[`val_${e}`,t])),g=i.BkHelper.mapObject(c,((e,t)=>[`key_${e}`,t])),p=Object.assign(Object.assign({},h),g);await this.getDatabase().queryResult(e,u,p);const m=this.calcNewKey(l,d),w=o.BkDataSource.keyToParams(m);(0,n.debug)("key:",l),(0,n.debug)("newKey:",m),(0,n.debug)("newKeyParams:",w);const f=this.getSingleQuery(e),[b]=await this.getDatabase().queryRows(e,f,w);if(!b)throw new Error("singleQuery does not return row");this.checkRow(b);const C=this.encodeRow(b),y=new a.Result;return a.Result.addUpdateToResult(y,t,s,l,m),a.Result.addUpdateExToResult(y,t,s,l,C),y}async delete(e){if(!0!==this.getAccess(e).delete)throw new Error(`${this.getFullName()}: access denied`);const{key:t}=e.params,s=this.getKeyValuesFromKey(t),r=this.getAttr("database"),o=this.getAttr("table"),i=this.getDatabase().getDeleteQuery(o,s);await this.getDatabase().queryResult(e,i,s);const n=new a.Result;return a.Result.addDeleteToResult(n,r,o,t),n}fillAttributes(e){e.class=this.getClassName(),e.name=this.getAttr("name"),e.database=this.getAttr("database"),e.table=this.getAttr("table")}getAutoColumns(){if(!this.table)throw new Error("getAutoColumns: no table");const e=this.table;return this.keyColumns.filter((t=>e.getColumn(t).isAuto()))}getAutoColumnTypes(){if(!this.table)throw new Error("getAutoColumnTypes: no table");const e=this.table;return this.getAutoColumns().reduce(((t,s)=>(t[s]=e.getColumn(s).getAttr("type"),t)),{})}}t.BkSqlDataSource=BkSqlDataSource},6688:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkDatabase=void 0;const r=s(4484);class BkDatabase extends r.BkModel{constructor(){super(...arguments),this.tables=[],this.params=[],this.fillCollections=["tables"]}async init(e){await this.createColItems("tables",e),await this.createColItems("params",e)}fillAttributes(e){e.name=this.getAttr("name")}async connect(e){throw new Error(`${this.constructor.name}.connect not implemented`)}isConnected(e){return!!e.connections[this.getName()]}getConnection(e){if(!e)throw new Error("no context");const t=this.getName();if(!e.connections[t])throw new Error(`not connected: ${t}`);return e.connections[t]}async release(e){throw new Error(`${this.constructor.name}.release not implemented`)}async queryResult(e,t,s=null){throw new Error(`${this.constructor.name}.queryResult not implemented`)}async queryRows(e,t,s=null){throw new Error(`${this.constructor.name}.queryRows not implemented`)}async queryScalar(e,t,s=null){throw new Error(`${this.constructor.name}.queryScalar not implemented`)}async begin(e){throw new Error(`${this.constructor.name}.begin not implemented`)}async commit(e){throw new Error(`${this.constructor.name}.commit not implemented`)}async rollback(e,t){throw new Error(`${this.constructor.name}.rollback not implemented`)}getDatabaseName(e){return this.getParam("database").getValue()}getConfig(e){const t={host:this.getParam("host").getValue(),database:this.getDatabaseName(e),user:this.getParam("user").getValue(),password:this.getParam("password").getValue()};return this.isData("params","port")&&(t.port=this.getParam("port").getValue()),t}getDefaultPort(){throw new Error(`${this.constructor.name}.getDefaultPort not implemented`)}getApp(){return this.getParent()}findTable(e){return this.tables.find((t=>t.getName()===e))}findParam(e){return this.params.find((t=>t.getName()===e))}getTable(e){if(!e)throw new Error("getTable: no name");const t=this.findTable(e);if(!t)throw new Error(`no table with name: ${e}`);return t}getParam(e){if(!e)throw new Error("getParam: no name");const t=this.findParam(e);if(!t)throw new Error(`no param with name: ${e}`);return t}async insertRow(e,t,s,r={}){throw new Error(`${this.constructor.name}.insertRow not implemented`)}async getTableList(){throw new Error(`${this.constructor.name}.getTableList not implemented`)}async getTableInfo(e){throw new Error(`${this.constructor.name}.getTableInfo not implemented`)}async transaction(e,t){await this.begin(e);try{const s=await t();return await this.commit(e),s}catch(t){throw await this.rollback(e,t),t}}async use(e,t){await this.connect(e);try{return await t(this)}finally{await this.release(e)}}}t.BkDatabase=BkDatabase},537:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BkMongoDbDatabase=void 0;const mongodb_1=__webpack_require__(8013),BkNoSqlDatabase_1=__webpack_require__(5717),console_1=__webpack_require__(8978);class BkMongoDbDatabase extends BkNoSqlDatabase_1.BkNoSqlDatabase{async connect(e){if((0,console_1.debug)("MongoDbDatabase.connect",this.getName()),!e)throw new Error("no context");this.checkDeinited();const t=this.getName();if(e.connections[t])throw new Error(`already connected: ${t}`);const s=this.getUrl(),r=new mongodb_1.MongoClient(s);(0,console_1.debug)(`MongoDbDatabase: connecting to ${s}`),await r.connect();const o=r.startSession();e.connections[t]={client:r,session:o}}getUrl(){const{host:e,user:t,password:s,port:r}=this.getConfig();return`mongodb://${t&&s?`${t}:${s}@`:""}${process.env.DB_HOST||e}:${r||this.getDefaultPort()}/?directConnection=true`}async release(e){if((0,console_1.debug)("MongoDbDatabase.release",this.getName()),!e)throw new Error("no context");const{client:t,session:s}=this.getConnection(e);s.endSession(),await t.close(),e.connections[this.getName()]=null}async updateOne(e,t,s,r){const o=Object.keys(s).reduce(((e,t)=>(e[t]="_id"===t?new mongodb_1.ObjectId(s[t]):s[t],e)),{});return(0,console_1.debug)("colName",t),(0,console_1.debug)("_filter:",o),(0,console_1.debug)("update",r),await this.getDbLink(e).collection(t).updateOne(o,r)}async insertOne(e,t,s){return await this.getDbLink(e).collection(t).insertOne(s)}async deleteOne(e,t,s){const r=BkMongoDbDatabase.makeObjectIds(s);return await this.getDbLink(e).collection(t).deleteOne(r)}static makeObjectIds(e,t=["_id"]){return Object.keys(e).reduce(((s,r)=>(s[r]=t.includes(r)?new mongodb_1.ObjectId(e[r]):e[r],s)),{})}getDbLink(e){const t=this.getConnection(e).client,{database:s}=this.getConfig();return t.db(s)}async queryResult(context,query,params=null){const db=this.getDbLink(context),fn="async"===query.trim().substring(0,5)?eval(query):eval(`(db, params, ObjectId) => (${query})`),result=await fn(db,params,mongodb_1.ObjectId);return result}async queryRows(e,t,s=null){(0,console_1.debug)("MongoDbDatabase.query",t,s);const r=await this.queryResult(e,t,s);return r instanceof mongodb_1.FindCursor||r instanceof mongodb_1.AggregationCursor?await r.toArray():[r]}async queryScalar(e,t,s=null){const r=await this.queryResult(e,t,s);if(r instanceof mongodb_1.FindCursor||r instanceof mongodb_1.AggregationCursor){const e=await r.toArray(),[t]=e;if(!t)throw new Error("queryScalar: no first row");const s=Object.keys(t)[0];if(!s)throw new Error("queryScalar: no first field");return t[s]}return r}getDefaultPort(){return 27017}async begin(e){(0,console_1.debug)("MongoDbDatabase.begin"),this.getConnection(e).session.startTransaction()}async commit(e){(0,console_1.debug)("MongoDbDatabase.commit"),this.getConnection(e).session.commitTransaction()}async rollback(e,t){(0,console_1.debug)("MongoDbDatabase.rollback"),this.getConnection(e).session.abortTransaction()}}exports.BkMongoDbDatabase=BkMongoDbDatabase},5717:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkNoSqlDatabase=void 0;const r=s(6688);class BkNoSqlDatabase extends r.BkDatabase{async updateOne(e,t,s,r){throw new Error(`${this.constructor.name}.updateOne not implemented`)}async insertOne(e,t,s){throw new Error(`${this.constructor.name}.insertOne not implemented`)}async deleteOne(e,t,s){throw new Error(`${this.constructor.name}.deleteOne not implemented`)}}t.BkNoSqlDatabase=BkNoSqlDatabase},334:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkMySqlDatabase=void 0;const r=s(2744),o=s(2093),i=s(8978);class BkMySqlDatabase extends o.BkSqlDatabase{constructor(){super(...arguments),this.pool=null}async deinit(){(0,i.debug)(`MySqlDatabase.deinit: ${this.getName()}`),await super.deinit(),null!==this.pool&&(await new Promise((e=>{this.pool.end((()=>{e()}))})),this.pool=null)}getPool(){return this.pool||(this.pool=(0,r.createPool)(this.getConfig())),this.pool}getConfig(){return(0,i.debug)("MySqlDatabase.getConfig"),Object.assign(Object.assign({},super.getConfig()),{queryFormat:BkMySqlDatabase.queryFormat})}static async Pool_getConnection(e){return new Promise(((t,s)=>{e.getConnection(((e,r)=>{e?s(e):t(r)}))}))}async queryRows(e,t,s=null){(0,i.debug)("MySqlDatabase.queryRows",t,s),o.BkSqlDatabase.checkParams(t,s);const r=await this.getConnection(e);return new Promise(((e,o)=>{r.query({sql:t,typeCast:BkMySqlDatabase.typeCast,nestTables:true},s,((t,s,r)=>{if(t)o(t);else{const t=this._getRows(s,r);e(t)}}))}))}async queryResult(e,t,s=null){(0,i.debug)("MySqlDatabase.queryResult",t,s),o.BkSqlDatabase.checkParams(t,s);const r=await this.getConnection(e);return new Promise(((e,o)=>{r.query({sql:t,typeCast:BkMySqlDatabase.typeCast,nestTables:false},s,((t,s,r)=>{t?o(t):e(s)}))}))}_getRows(e,t){const s={};for(let e=0;e<t.length;e++){const r=t[e];s[r.name]||(s[r.name]=0),s[r.name]++,r.numb=s[r.name]-1}const r=[];for(let s=0;s<e.length;s++){const o=e[s],i={};for(let e=0;e<t.length;e++){const s=t[e];i[s.name+(s.numb>0?s.numb:"")]=o[s.table][s.name]}r.push(i)}return r}begin(e){(0,i.debug)("MySqlDatabase.begin");const t=this.getConnection(e);return new Promise(((e,s)=>{t.beginTransaction((t=>{t?s(t):e()}))}))}commit(e){(0,i.debug)("MySqlDatabase.commit");const t=this.getConnection(e);return new Promise(((e,s)=>{t.commit((t=>{t?s(t):e()}))}))}rollback(e,t){(0,i.debug)("MySqlDatabase.rollback:",this.getName(),t.message);const s=this.getConnection(e);return new Promise(((e,t)=>{s.rollback((()=>{e()}))}))}static queryFormat(e,t={}){(0,i.debug)("MySqlDatabase.queryFormat",e,t);const s=e.replace(/\{([\w\.@]+)\}/g,((e,s)=>{if(t.hasOwnProperty(s))return(0,r.escape)(t[s]);throw new Error(`no query param: ${s}`)}));return(0,i.debug)("real db sql: "+s),s}static typeCast(e,t){return["DATE","DATETIME","TIME","TIMESTAMP"].includes(e.type)?e.string():t()}async getTableList(){(0,i.debug)("MySqlDatabase.getTableList");const e=this.getConfig();return new Promise(((t,s)=>{const o=(0,r.createConnection)(e);o.connect(),o.query("show tables",((e,r,a)=>{if(o.end(),e)s(e);else{const e=r.map((e=>e[a[0].name]));(0,i.debug)("tables:",e),t(e)}}))}))}async getTableInfo(e){(0,i.debug)("MySqlDatabase.getTableInfo:",e);const t=this.getConfig();return new Promise(((s,o)=>{const a=(0,r.createConnection)(t);a.connect();const n=`SELECT COLUMN_NAME, COLUMN_TYPE, IS_NULLABLE, COLUMN_KEY, COLUMN_DEFAULT, EXTRA, COLUMN_COMMENT FROM information_schema.columns WHERE table_schema = '${t.database}' and table_name = '${e}'`;a.query(n,((e,t)=>{if(a.end(),e)o(e);else{const e=t.map((e=>({name:e.COLUMN_NAME,type:this.getColumnTypeByDataType(e.COLUMN_TYPE),key:"PRI"===e.COLUMN_KEY,auto:"auto_increment"===e.EXTRA,nullable:"YES"===e.IS_NULLABLE,comment:e.COLUMN_COMMENT,dbType:e.COLUMN_TYPE})));(0,i.debug)("tableInfo:",e),s(e)}}))}))}getColumnTypeByDataType(e){switch(e){case"int(10) unsigned":case"int unsigned":return"number";case"varchar(255)":case"varchar(15)":case"text":return"string";case"datetime":return"date";default:return null}}async insertRow(e,t,s,r={}){(0,i.debug)(`MySqlDatabase.insertRow ${t}`,s,r);const o=Object.keys(r);if(o.length>1)throw new Error("mysql does not support more than one auto increment column");const a=this.getInsertQuery(t,s),n=await this.queryResult(e,a,s);if(1===o.length){if(!n.insertId)throw new Error("no insertId");return Object.assign({[o[0]]:n.insertId},s)}return Object.assign({},s)}async connect(e){if((0,i.debug)("MySqlDatabase.connect",this.getName()),!e)throw new Error("no context");this.checkDeinited();const t=this.getName();if(e.connections[t])throw new Error(`already connected: ${t}`);e.connections[t]=await BkMySqlDatabase.Pool_getConnection(this.getPool())}async release(e){if((0,i.debug)("MySqlDatabase.release",this.getName()),!e)throw new Error("no context");this.getConnection(e).release(),e.connections[this.getName()]=null}}t.BkMySqlDatabase=BkMySqlDatabase},4411:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BkPostgreSqlDatabase=void 0;const o=r(s(4357)),i=s(5900),a=s(2093),n=s(8978);class BkPostgreSqlDatabase extends a.BkSqlDatabase{constructor(){super(...arguments),this.pool={}}async deinit(){(0,n.debug)(`PostgreSqlDatabase.deinit: ${this.getName()}`),await super.deinit();for(const e in this.pool){const t=this.pool[e];(0,n.debug)("ending pool:",e,t.totalCount),await t.end(),(0,n.debug)("pool ended")}this.pool={}}getPool(e){const t=this.getConfig(e),s=JSON.stringify(t);return this.pool[s]||((0,n.debug)(`creating connection pool for ${this.getName()}(${s})`),this.pool[s]=BkPostgreSqlDatabase.createPool(t)),this.pool[s]}static createPool(e){return new i.Pool(e)}async connect(e){if((0,n.debug)("PostgreSqlDatabase.connect",this.getName()),!e)throw new Error("no context");this.checkDeinited();const t=this.getName();if(e.connections[t])throw new Error(`already connected: ${t}`);const s=this.getPool(e);e.connections[t]=await s.connect()}async release(e){if((0,n.debug)("PostgreSqlDatabase.release",this.getName()),!e)throw new Error("no context");this.getConnection(e).release(),e.connections[this.getName()]=null}async queryResult(e,t,s=null){e.query.sql&&(0,n.debug)(o.default.blue("PostgreSqlDatabase.queryResult"),{query:t,params:s}),a.BkSqlDatabase.checkParams(t,s);const{sql:r,values:i}=BkPostgreSqlDatabase.formatQuery(t,s);e.query.sql&&((0,n.debug)("sql:",r),(0,n.debug)("values:",i));return await this.getConnection(e).query(r,i)}static async queryResult(e,t,s=null){(0,n.debug)(o.default.blue("static PostgreSqlDatabase.queryResult"),t),a.BkSqlDatabase.checkParams(t,s);const{sql:r,values:i}=BkPostgreSqlDatabase.formatQuery(t,s);return await e.query(r,i)}async queryRows(e,t,s=null){return(await this.queryResult(e,t,s)).rows}async begin(e){if((0,n.debug)("PostgreSqlDatabase.begin",this.getName()),!e)throw new Error("no context");await this.getConnection(e).query("begin")}async commit(e){if((0,n.debug)("PostgreSqlDatabase.commit",this.getName()),!e)throw new Error("no context");await this.getConnection(e).query("commit")}async rollback(e,t){if((0,n.debug)(o.default.red("PostgreSqlDatabase.rollback: "),this.getName(),t.message),!e)throw new Error("no context");await this.getConnection(e).query("rollback")}static formatQuery(e,t){if(!t)return{sql:e,values:null};const s=a.BkSqlDatabase.getUsedParams(e),r=Object.keys(t).filter((e=>s.indexOf(e)>-1)),o=r.map((e=>t[e]));return{sql:e.replace(/\{([\w\.@]+)\}/g,((e,t)=>r.indexOf(t)>-1?`$${r.indexOf(t)+1}`:e)),values:o}}getDeleteQuery(e,t){return`delete from "${e}" where ${Object.keys(t).map((e=>`"${e}" = {${e}}`)).join(" and ")}`}getUpdateQuery(e,t,s){return BkPostgreSqlDatabase.getUpdateQuery(e,t,s)}static getUpdateQuery(e,t,s){const r=Object.keys(t),o=Object.keys(s);if(0===r.length)throw new Error("getUpdateQuery: no values");if(0===o.length)throw new Error("getUpdateQuery: no where");return`update "${e}" set ${r.map((e=>`"${e}" = {val_${e}}`)).join(", ")} where ${o.map((e=>`"${e}" = {key_${e}}`)).join(" and ")}`}getInsertQuery(e,t){const s=Object.keys(t);if(!s.length)return`insert into "${e}" default values`;return`insert into "${e}"(${s.map((e=>`"${e}"`)).join(", ")}) values (${s.map((e=>`{${e}}`)).join(", ")})`}async getTableList(){(0,n.debug)("PostgreSqlDatabase.getTableList");return(await this.query("select \"table_name\" from information_schema.tables where table_schema = 'public'")).map((e=>e.table_name))}async getTableInfo(e){(0,n.debug)("PostgreSqlDatabase.getTableInfo");const t=await this.getTableKeyColumns(e);return(await this.query(`select * from INFORMATION_SCHEMA.COLUMNS where table_name = '${e}' order by ordinal_position`)).map((e=>({name:e.column_name,type:this.getColumnTypeByDataType(e.data_type),key:!!t.find((t=>t.attname===e.column_name)),auto:!(!e.column_default||"nextval"!==e.column_default.substr(0,7)),nullable:"YES"===e.is_nullable,comment:null,dbType:e.data_type})))}getColumnTypeByDataType(e){switch(e){case"integer":case"numeric":case"bigint":return"number";case"character varying":case"text":case"bytea":return"string";case"json":case"jsonb":case"ARRAY":return"object";case"boolean":return"boolean";case"timestamp with time zone":case"timestamp without time zone":return"date";default:return null}}async getTableKeyColumns(e){(0,n.debug)("PostgreSqlDatabase.getTableKeyColumns");return await this.query(`SELECT a.attname, format_type(a.atttypid, a.atttypmod) AS data_type\nFROM   pg_index i\nJOIN   pg_attribute a ON a.attrelid = i.indrelid AND a.attnum = ANY(i.indkey)\nWHERE  i.indrelid = '"${e}"'::regclass AND i.indisprimary;`)}async query(e){const t=this.getConfig(),s=new i.Client(t);await s.connect();const r=await s.query(e);return await s.end(),r.rows}async queryAutoValues(e,t,s){(0,n.debug)("PostgreSqlDatabase.queryAutoValues",s);const r=Object.keys(s);if(!r.length)throw new Error("no auto columns");const o=r.map((e=>`select currval('"${t}_${e}_seq"')`)).join("; "),i=await this.queryResult(e,o);if(i instanceof Array)return r.reduce(((e,t,r)=>{const o=i[r];let[{currval:a}]=o.rows;if("number"===s[t]&&"string"==typeof a&&(a=Number(a)),typeof a!==s[t])throw new Error(`wrong type of auto value: ${typeof a}, should be ${s[t]}`);return e[t]=a,e}),{});{let[{currval:e}]=i.rows;const t=r[0];if("number"===s[t]&&"string"==typeof e&&(e=Number(e)),typeof e!==s[t])throw new Error(`wrong type of auto value: ${typeof e}, should be ${s[t]}`);return{[t]:e}}}async insertRow(e,t,s,r={}){(0,n.debug)(`PostgreSqlDatabase.insertRow ${t}`,s,r);const o=this.getInsertQuery(t,s);await this.queryResult(e,o,s);if(Object.keys(r).length>0){const o=await this.queryAutoValues(e,t,r);return(0,n.debug)("auto:",o),Object.assign(Object.assign({},o),s)}return Object.assign({},s)}async queryScalar(e,t,s){const r=(await this.queryRows(e,t,s))[0];if(!r)throw new Error("queryScalar must return one row");const[o]=Object.keys(r);if(!o)throw new Error("no column in result set");const i=r[o];if(void 0===i)throw new Error("scalar value undefined");return i}}t.BkPostgreSqlDatabase=BkPostgreSqlDatabase},2093:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkSqlDatabase=void 0;const r=s(6688),o=s(8978);class BkSqlDatabase extends r.BkDatabase{getUpdateQuery(e,t,s){(0,o.debug)("BkSqlDatabase.getUpdateQuery",e);const r=Object.keys(t),i=Object.keys(s);if(0===r.length)throw new Error("getUpdateQuery: no values");if(0===i.length)throw new Error("getUpdateQuery: no where");return`update ${e} set ${r.map((e=>`${e} = {val_${e}}`)).join(", ")} where ${i.map((e=>`${e} = {key_${e}}`)).join(" and ")}`}getInsertQuery(e,t){(0,o.debug)("BkSqlDatabase.getInsertQuery");const s=Object.keys(t);return`insert into ${e}(${s.join(", ")}) values (${s.map((e=>`{${e}}`)).join(", ")})`}getDeleteQuery(e,t){(0,o.debug)("BkSqlDatabase.getDeleteQuery");return`delete from ${e} where ${Object.keys(t).map((e=>`${e} = {${e}}`)).join(" and ")}`}static getUsedParams(e){const t=e.match(/\{([\w\.@]+)\}/g);return t?t.map((e=>e.substr(1,e.length-2))):[]}static checkParams(e,t){const s=BkSqlDatabase.getUsedParams(e),r=t?Object.keys(t):[],o=s.filter((e=>-1===r.indexOf(e)));if(o.length>0)throw new Error(`not passed params: ${o.join(",")}, passed: ${r.join(",")}, query: ${e}`)}}t.BkSqlDatabase=BkSqlDatabase},7117:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkCheckBoxField=void 0;const r=s(7677);class BkCheckBoxField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull")}}t.BkCheckBoxField=BkCheckBoxField},1231:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkCheckBoxListField=void 0;const r=s(7677);class BkCheckBoxListField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.dataSourceName=this.getAttr("dataSourceName"),e.valueColumn=this.getAttr("valueColumn"),e.displayColumn=this.getAttr("displayColumn")}}t.BkCheckBoxListField=BkCheckBoxListField},1558:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkComboBoxField=void 0;const r=s(7677);class BkComboBoxField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.placeholder=this.getAttr("placeholder"),e.dataSourceName=this.getAttr("dataSourceName"),e.valueColumn=this.getAttr("valueColumn"),e.displayColumn=this.getAttr("displayColumn"),e.newRowMode=this.getAttr("newRowMode"),e.itemEditPage=this.getAttr("itemEditPage"),e.itemCreatePage=this.getAttr("itemCreatePage"),e.itemCreateForm=this.getAttr("itemCreateForm"),e.itemSelectPage=this.getAttr("itemSelectPage")}}t.BkComboBoxField=BkComboBoxField},1938:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkDateField=void 0;const r=s(7677),o=s(9918);class BkDateField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.format=this.getAttr("format"),e.timezone=this.getAttr("timezone"),e.placeholder=this.getAttr("placeholder"),e.validateOnChange=this.getAttr("validateOnChange"),e.validateOnBlur=this.getAttr("validateOnBlur")}valueToRaw(e){let t;if(e&&!this.isTimezone()){const s=o.BkHelper.cloneDate(e);o.BkHelper.removeTimezoneOffset(s),t=o.BkHelper.encodeValue(s)}else t=o.BkHelper.encodeValue(e);return t}rawToValue(e){const t=o.BkHelper.decodeValue(e);return t&&!this.isTimezone()&&o.BkHelper.addTimezoneOffset(t),t}}t.BkDateField=BkDateField},1288:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkDateTimeField=void 0;const r=s(7677),o=s(9918);class BkDateTimeField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.format=this.getAttr("format"),e.timezone=this.getAttr("timezone"),e.placeholder=this.getAttr("placeholder"),e.validateOnChange=this.getAttr("validateOnChange"),e.validateOnBlur=this.getAttr("validateOnBlur")}valueToRaw(e){let t;if(e&&!this.isTimezone()){const s=o.BkHelper.cloneDate(e);o.BkHelper.removeTimezoneOffset(s),t=o.BkHelper.encodeValue(s)}else t=o.BkHelper.encodeValue(e);return t}rawToValue(e){const t=o.BkHelper.decodeValue(e);return t&&!this.isTimezone()&&o.BkHelper.addTimezoneOffset(t),t}}t.BkDateTimeField=BkDateTimeField},7677:function(__unused_webpack_module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.BkField=void 0;const path_1=__importDefault(__webpack_require__(1017)),BkModel_1=__webpack_require__(4484),BkHelper_1=__webpack_require__(9918);class BkField extends BkModel_1.BkModel{fillAttributes(e){e.class=this.getClassName(),e.name=this.getAttr("name"),e.caption=this.getAttr("caption"),e.column=this.getAttr("column"),e.defaultValue=this.getAttr("defaultValue"),e.value=this.getAttr("value"),e.param=this.getAttr("param"),e.visible=this.getAttr("visible"),e.type=this.getAttr("type"),e.width=this.getAttr("width"),e.cssBlock=this.getAttr("cssBlock"),e.viewClass=this.getAttr("viewClass"),e.ctrlClass=this.getAttr("ctrlClass"),e.autoFocus=this.getAttr("autoFocus")}getDirPath(){return path_1.default.join(this.getParent().getDirPath(),"fields",this.getName())}fillDefaultValue(context,row){const column=this.getAttr("column");if(!column)return;const defaultValue=this.getForm().replaceThis(context,this.getAttr("defaultValue")),params=context.getParams(),js=BkHelper_1.BkHelper.templateToJsString(defaultValue,params);let value;try{value=eval(js),void 0!==value&&(row[column]=this.valueToRaw(value))}catch(e){throw new Error(`[${this.getFullName()}] fillDefaultValue eval error: ${e.toString()}`)}}dumpRowValueToParams(e,t){const s=this.getFullName();try{const r=this.getAttr("column");if(!r)throw new Error("no column attr");const o=e[r],i=void 0!==o?this.rawToValue(o):null;t[s]=i}catch(e){throw e.message=`${s}: ${e.message}`,e}}getFullName(){return[this.getForm().getPage().getName(),this.getForm().getName(),this.getName()].join(".")}getApp(){return this.getParent().getParent().getParent()}getPage(){return this.getParent().getParent()}getForm(){return this.getParent()}isParam(){return this.isAttr("param")&&"true"===this.getAttr("param")}valueToRaw(e){return BkHelper_1.BkHelper.encodeValue(e)}rawToValue(e){return BkHelper_1.BkHelper.decodeValue(e)}isTimezone(){return"true"===this.getAttr("timezone")}getDatabaseTableColumn(){if(!this.getAttr("column"))throw new Error(`${this.getFullName()}: column attr is empty`);return this.getForm().getDataSource("default").getTable().getColumn(this.getAttr("column"))}getType(){if(this.getAttr("column"))return this.getDatabaseTableColumn().getAttr("type");if(this.getAttr("type"))return this.getAttr("type");throw new Error(`${this.getFullName()}: type attr is empty`)}getDbType(){return this.getDatabaseTableColumn().getAttr("dbType")}valueToDbValue(e){return"json"===this.getDbType()?JSON.stringify(e):e}}exports.BkField=BkField},3002:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkFileField=void 0;const r=s(7677);class BkFileField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull")}}t.BkFileField=BkFileField},2547:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkImageField=void 0;const r=s(7677);class BkImageField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull")}}t.BkImageField=BkImageField},8266:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkLabelField=void 0;const r=s(7677);class BkLabelField extends r.BkField{}t.BkLabelField=BkLabelField},3855:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkLinkField=void 0;const r=s(7677);class BkLinkField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.notNull=this.getAttr("notNull"),e.page=this.getAttr("page"),e.displayColumn=this.getAttr("displayColumn")}}t.BkLinkField=BkLinkField},3955:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkPasswordField=void 0;const r=s(7677);class BkPasswordField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.placeholder=this.getAttr("placeholder"),e.validateOnChange=this.getAttr("validateOnChange"),e.validateOnBlur=this.getAttr("validateOnBlur"),e.autocomplete=this.getAttr("autocomplete")}}t.BkPasswordField=BkPasswordField},4905:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkPhoneField=void 0;const r=s(7677);class BkPhoneField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.placeholder=this.getAttr("placeholder"),e.validateOnChange=this.getAttr("validateOnChange"),e.validateOnBlur=this.getAttr("validateOnBlur"),e.autocomplete=this.getAttr("autocomplete")}}t.BkPhoneField=BkPhoneField},6908:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkRadioField=void 0;const r=s(7677);class BkRadioField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.dataSourceName=this.getAttr("dataSourceName"),e.valueColumn=this.getAttr("valueColumn"),e.displayColumn=this.getAttr("displayColumn")}}t.BkRadioField=BkRadioField},1451:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkTextAreaField=void 0;const r=s(7677);class BkTextAreaField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.rows=this.getAttr("rows"),e.cols=this.getAttr("cols"),e.validateOnChange=this.getAttr("validateOnChange"),e.validateOnBlur=this.getAttr("validateOnBlur")}}t.BkTextAreaField=BkTextAreaField},236:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkTextBoxField=void 0;const r=s(7677);class BkTextBoxField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.placeholder=this.getAttr("placeholder"),e.validateOnChange=this.getAttr("validateOnChange"),e.validateOnBlur=this.getAttr("validateOnBlur"),e.autocomplete=this.getAttr("autocomplete")}}t.BkTextBoxField=BkTextBoxField},4296:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkTimeField=void 0;const r=s(7677);class BkTimeField extends r.BkField{fillAttributes(e){super.fillAttributes(e),e.readOnly=this.getAttr("readOnly"),e.notNull=this.getAttr("notNull"),e.placeholder=this.getAttr("placeholder"),e.validateOnChange=this.getAttr("validateOnChange"),e.validateOnBlur=this.getAttr("validateOnBlur")}}t.BkTimeField=BkTimeField},6676:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BkForm=void 0;const o=r(s(1017)),i=s(4484),a=s(1937),n=s(8978);class BkForm extends i.BkModel{constructor(e,t){super(e,t),this.dataSources=[],this.actions=[],this.fields=[],this.fillCollections=["dataSources","actions","fields"]}async init(e){await this.createColItems("dataSources",e),await this.createColItems("actions",e),await this.createColItems("fields",e)}getDirPath(){return o.default.join(this.getParent().getDirPath(),"forms",this.getName())}fillAttributes(e){e.class=this.getClassName(),e.name=this.getAttr("name"),e.caption=this.getAttr("caption"),e.visible=this.getAttr("visible"),e.cssBlock=this.getAttr("cssBlock"),e.viewClass=this.getAttr("viewClass"),e.ctrlClass=this.getAttr("ctrlClass")}async fill(e){if(this.findDataSource("default"))return super.fill(e);const t=this._getSurrogateDataSourceResponse(e);this.dumpRowToParams(t.rows[0],e.querytime.params);const s=await super.fill(e);return s.dataSources.push(t),s}_getSurrogateDataSourceResponse(e){const t={id:"[1]"};for(const s of this.fields)s.fillDefaultValue(e,t);return{class:"DataSource",name:"default",keyColumns:["id"],rows:[t]}}dumpRowToParams(e,t){for(const s of this.fields)s.isParam()&&s.dumpRowValueToParams(e,t)}replaceThis(e,t){return t.replace(/\{([@\w.]+)\}/g,((e,t)=>{if(-1!==t.indexOf(".")){const e=t.split(".");return"this"===e[0]&&(e[0]=this.getPage().getName()),"{"+e.join(".")+"}"}return e})).replace(/\[([@\w.]+)\]/g,((e,t)=>{if(-1!==t.indexOf(".")){const e=t.split(".");return"this"===e[0]&&(e[0]=this.getPage().getName()),"["+e.join(".")+"]"}return e}))}async rpc(e,t){if((0,n.debug)("BkForm.rpc",e,t.getBody()),this[e])return await this[e](t);throw new a.HttpError({message:`no remote proc ${this.constructor.name}.${e}`,data:{method:`${this.constructor.name}.rpc`},context:t})}getApp(){return this.getParent().getParent()}getPage(){return this.getParent()}getFullName(){return`${this.getPage().getName()}.${this.getName()}`}isNewMode(e){return!!e.getBody().newMode}findField(e){return this.fields.find((t=>t.getName()===e))}getField(e){const t=this.findField(e);if(!t)throw new Error(`${this.getFullName()}: no field ${e}`);return t}findDataSource(e){return this.dataSources.find((t=>t.getName()===e))}getDataSource(e){const t=this.findDataSource(e);if(!t)throw new Error(`${this.getFullName()}: no data source ${e}`);return t}}t.BkForm=BkForm},5915:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkRowForm=void 0;const r=s(6676);class BkRowForm extends r.BkForm{isNewMode(e){if(this.isAttr("newMode")){const e=this.getAttr("newMode");if("true"===e)return!0;if("false"===e)return!1}return super.isNewMode(e)}fillAttributes(e){super.fillAttributes(e),e.newMode=this.getAttr("newMode"),e.refreshButton=this.getAttr("refreshButton")}}t.BkRowForm=BkRowForm},8141:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkTableForm=void 0;const r=s(6676);class BkTableForm extends r.BkForm{fillAttributes(e){super.fillAttributes(e),e.editMethod=this.getAttr("editMethod"),e.itemEditPage=this.getAttr("itemEditPage"),e.itemCreatePage=this.getAttr("itemCreatePage"),e.newRowMode=this.getAttr("newRowMode"),e.deleteRowMode=this.getAttr("deleteRowMode"),e.refreshButton=this.getAttr("refreshButton")}}t.BkTableForm=BkTableForm},4484:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkModel=void 0;const r=s(8491);class BkModel extends r.BaseModel{constructor(){super(...arguments),this.deinited=!1,this.fillCollections=[]}async init(e){}async deinit(){this.checkDeinited(),this.deinited=!0}checkDeinited(){if(this.deinited)throw new Error(`${this.getName()} is already deinited and cannot be used`)}async fill(e){const t={name:""};this.fillAttributes(t);for(const s of this.fillCollections)await this.fillCollection(t,s,e);return t}fillAttributes(e){throw new Error(`${this.constructor.name}.fillAttributes not implemented`)}isBackOnly(){return this.isAttr("backOnly")&&"true"===this.getAttr("backOnly")}async fillCollection(e,t,s){if(this[t]){e[t]=[];for(const r of this[t]){if(r.isBackOnly())continue;const o=await r.fill(s);e[t].push(o)}}}async createColItems(e,t){for(const s of this.getCol(e))await this.createColItem(e,s,t)}async createColItem(e,t,s){try{const r=await this.createChildModel(e,t);await r.init(s),this[e].push(r)}catch(e){const s=r.BaseModel.getName(t),o=r.BaseModel.getClassName(t);throw e.message=`${o}[${s}]: ${e.message}`,e}}async createChildModel(e,t){const o=r.BaseModel.getAttr(t,"modelClass");if(o){const e=global[o];if(!e)throw new Error(`no global class ${o}`);return new e(t,this)}const i=r.BaseModel.getClassName(t),a=s(7756)[`Bk${i}`];if(!a)throw new Error(`no class backend.${i}`);return new a(t,this)}getDirPath(){return null}async rpc(e,t){throw new Error(`${this.constructor.name}.rpc not implemented`)}}t.BkModel=BkModel},7017:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BkPage=void 0;const o=r(s(1017)),i=s(4484),a=s(1937),n=s(8978);class BkPage extends i.BkModel{constructor(){super(...arguments),this.dataSources=[],this.actions=[],this.forms=[]}async init(e){await this.createColItems("dataSources",e),await this.createColItems("actions",e),await this.createColItems("forms",e)}getDirPath(){return o.default.join(this.getParent().getDirPath(),"pages",this.getName())}fillAttributes(e){e.name=this.getAttr("name"),e.caption=this.getAttr("caption"),e.cssBlock=this.getAttr("cssBlock"),e.viewClass=this.getAttr("viewClass"),e.ctrlClass=this.getAttr("ctrlClass"),this.isAttr("formInTab")&&(e.formInTab=this.getAttr("formInTab"))}async fill(e){const t=await super.fill(e);return await this.fillCollection(t,"dataSources",e),await this.fillCollection(t,"actions",e),await this.fillCollection(t,"forms",e),t.newMode=!!e.getBody().newMode,t}async rpc(e,t){if((0,n.debug)("BkPage.rpc",e,t.getBody()),this[e])return await this[e](t);throw new a.HttpError({message:`no remote proc ${this.constructor.name}.${e}`,data:{method:`${this.constructor.name}.rpc`},context:t})}getApp(){return this.getParent()}findForm(e){return this.forms.find((t=>t.getName()===e))}getForm(e){const t=this.findForm(e);if(!t)throw new Error(`${this.getName()}: no form ${e}`);return t}findDataSource(e){return this.dataSources.find((t=>t.getName()===e))}getDataSource(e){const t=this.findDataSource(e);if(!t)throw new Error(`${this.getName()}: no form ${e}`);return t}}t.BkPage=BkPage},5721:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BkPageLink=void 0;const o=r(s(1017)),i=s(4484);class BkPageLink extends i.BkModel{getPageFilePath(){return o.default.join(this.getParent().getDirPath(),this.getAttr("fileName"))}}t.BkPageLink=BkPageLink},1718:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BkParam=void 0;const BkModel_1=__webpack_require__(4484);class BkParam extends BkModel_1.BkModel{getValue(){const value=this.getAttr("value");try{return eval(value)}catch(e){throw e.message=`eval error: ${e.message}, ${this.getName()} = ${value}`,e}}getApp(){return this.getParent().getApp()}}exports.BkParam=BkParam},2956:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BkTable=void 0;const r=s(4484);class BkTable extends r.BkModel{constructor(e,t){super(e,t),this.columns=[],this.fillCollections=["columns"]}async init(e){await this.createColItems("columns",e)}getKeyColumns(){const e=this.columns.filter((e=>e.isKey())).map((e=>e.getName()));if(0===e.length)throw new Error(`no key columns in table: ${this.getName()}`);return e}getApp(){return this.getParent().getParent()}getColumn(e){const t=this.columns.find((t=>t.getName()===e));if(!t)throw new Error(`no column ${e}`);return t}fillAttributes(e){e.name=this.getAttr("name")}}t.BkTable=BkTable},80:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewerModule=t.RowForm=t.TableFormTextBoxFieldController=t.TextBoxField=t.NoSqlDataSource=t.TableForm=void 0;const o=s(997),i=r(s(1017)),a=r(s(6689)),n=r(s(8684)),l=s(9918),c=s(1937),d=s(6224),u=s(7317),h=s(3024),g=s(7274),p=s(2686),m=s(5642),w=s(7534),f=s(8978),b=s(4147);var C=s(9249);Object.defineProperty(t,"TableForm",{enumerable:!0,get:function(){return C.TableForm}}),Object.defineProperty(t,"NoSqlDataSource",{enumerable:!0,get:function(){return C.NoSqlDataSource}}),Object.defineProperty(t,"TextBoxField",{enumerable:!0,get:function(){return C.TextBoxField}}),Object.defineProperty(t,"TableFormTextBoxFieldController",{enumerable:!0,get:function(){return C.TableFormTextBoxFieldController}}),Object.defineProperty(t,"RowForm",{enumerable:!0,get:function(){return C.RowForm}});const y=["page","select","insert","update","_delete","rpc","logout","test"];t.ViewerModule=class ViewerModule{constructor(e){this.hostApp=e}async init(){if((0,f.debug)("ViewerModule.init","getFrontendDirPath:",this.hostApp.getFrontendDirPath()),this.css=(await l.BkHelper.getFilePaths(i.default.join(this.hostApp.getFrontendDirPath(),"viewer/public"),"css")).map((e=>`/viewer/public/${e}`)),this.js=(await l.BkHelper.getFilePaths(i.default.join(this.hostApp.getFrontendDirPath(),"viewer/public"),"js")).map((e=>`/viewer/public/${e}`)),(0,f.debug)("ViewerModule.css:",this.css),(0,f.debug)("ViewerModule.js:",this.js),!this.js.length)throw new Error("no qforms js")}getLinks(){return this.css}getScripts(){return this.js}async handleGet(e,t){(0,f.debug)("ViewerModule.handleGet",e.getDomain(),e.query,e.getReq().url);const s=e.getReq();!t.isAuthentication()||s.session.user&&s.session.user[e.getRoute()]?(e.setVersionHeaders(b.version,t.getVersion()),await this.index(e,t)):await this.loginGet(e,t)}async handlePost(e,t){const s=e.getReq();if("login"===s.body.action)await this.loginPost(e,t);else{if(t.isAuthentication()&&(!s.session.user||!s.session.user[e.getRoute()]))throw new c.HttpError({message:"Unauthorized",status:401,context:e});await this.handleAction(e,t)}}async handleAction(e,t){const s=e.getReq();if(-1===y.indexOf(s.body.action))throw new Error(`unknown action: ${s.body.action}`);e.setVersionHeaders(b.version,t.getVersion()),await this[s.body.action](e,t)}async renderHtml(e,t){(0,f.debug)("ViewerModule.renderHtml");const s=n.default.renderToStaticMarkup((0,o.jsx)(u.Links,{links:[...this.getLinks(),...e.links]})),r=n.default.renderToStaticMarkup((0,o.jsx)(h.Scripts,{scripts:[...this.getScripts(),...e.scripts]})),i=await e.fill(t),l=new w.FrontHostApp({debug:t.isDebugMode(),url:t.getUrl(),cookies:t.getCookies()}),c=new g.Application(i);c.init();const d=p.ApplicationController.create(c,l);d.init();const m=a.default.createElement(d.getViewClass(),{ctrl:d}),C=n.default.renderToString(m);return e.renderIndexHtml(t,d,b.version,s,r,i,C)}async loginGet(e,t){(0,f.debug)("ViewerModule.loginGet");const s=n.default.renderToStaticMarkup((0,o.jsx)(u.Links,{links:[...this.getLinks(),...t.links]})),r=n.default.renderToStaticMarkup((0,o.jsx)(h.Scripts,{scripts:[...this.getScripts(),...t.scripts]})),i=(0,m.login)(b.version,e,t,s,r,{name:t.getName(),text:t.getText(),title:t.getTitle(e),errMsg:null,username:e.query.username});e.getRes().end(i)}async loginPost(e,t){(0,f.debug)("ViewerModule.loginPost");const s=e.getReq(),r=e.getRes();if(void 0===s.body.tzOffset)throw new Error("no tzOffset");if(void 0===s.body.username)throw new Error("no username");if(void 0===s.body.password)throw new Error("no password");await t.connect(e);try{const i=await t.authenticate(e,s.body.username,s.body.password);if(i){if(!i.id)throw new Error("no user id");if(!i.name)throw new Error("no user name");void 0===s.session.user&&(s.session.user={}),s.session.ip=e.getIp(),s.session.tzOffset=JSON.parse(s.body.tzOffset),s.session.user[e.getRoute()]=i,r.redirect(s.url),this.getHostApp().logEvent(e,`login ${t.getName()}/${e.getDomain()} ${i.name}`)}else{const i=n.default.renderToStaticMarkup((0,o.jsx)(u.Links,{links:[...this.getLinks(),...t.links]})),a=n.default.renderToStaticMarkup((0,o.jsx)(h.Scripts,{scripts:[...this.getScripts(),...t.scripts]})),l=(0,m.login)(b.version,e,t,i,a,{name:t.getName(),text:t.getText(),title:t.getTitle(e),errMsg:t.getText().login.WrongUsernameOrPassword,username:s.body.username,password:s.body.password});r.status(401).end(l)}}finally{await t.release(e)}}async index(e,t){(0,f.debug)("ViewerModule.index");const s=e.getRes();await t.connect(e);try{await t.initContext(e);const r=await this.renderHtml(t,e);s.end(r)}finally{await t.release(e)}}async page(e,t){(0,f.debug)("ViewerModule.page",e.getReq().body.page);const s=e.getReq(),r=e.getRes();await t.connect(e);try{await t.initContext(e);const o=await t.getPage(e,s.body.page),i=await o.fill(e);if(void 0===i)throw new Error("page action: response is undefined");r.json({page:i})}finally{await t.release(e)}}async select(e,t){(0,f.debug)("ViewerModule.select",e.getReq().body.page);const s=e.getReq(),r=e.getRes(),o=Date.now();let i;if(s.body.page){const r=await t.getPage(e,s.body.page);i=s.body.form?r.getForm(s.body.form).getDataSource(s.body.ds):r.getDataSource(s.body.ds)}else i=t.getDataSource(s.body.ds);await i.getDatabase().use(e,(async s=>{await t.initContext(e);const[a,n]=await i.read(e),l=Date.now()-o;(0,f.debug)("select time:",l),r.json({rows:a,count:n,time:l})}))}async insert(e,t){(0,f.debug)("ViewerModule.insert",e.getReq().body.page);const s=e.getReq(),r=e.getRes(),o=(await t.getPage(e,s.body.page)).getForm(s.body.form).getDataSource("default");await o.getDatabase().use(e,(async s=>{await t.initContext(e);const i=await s.transaction(e,(async()=>{const t=await o.create(e);if(void 0===t)throw new Error("insert action: result is undefined");return t}));r.json(i),this.hostApp.broadcastResult(t,e,i)}))}async update(e,t){(0,f.debug)("ViewerModule.update",e.getReq().body.page);const s=e.getReq(),r=e.getRes(),o=(await t.getPage(e,s.body.page)).getForm(s.body.form).getDataSource("default");await o.getDatabase().use(e,(async s=>{await t.initContext(e);const i=await s.transaction(e,(async()=>{const t=await o.update(e);if(void 0===t)throw new Error("action update: result is undefined");return t}));r.json(i),this.hostApp.broadcastResult(t,e,i)}))}async _delete(e,t){(0,f.debug)("ViewerModule._delete",e.getReq().body.page);const s=e.getReq(),r=e.getRes(),o=(await t.getPage(e,s.body.page)).getForm(s.body.form).getDataSource("default");await o.getDatabase().use(e,(async s=>{await t.initContext(e);const i=await s.transaction(e,(async()=>{const t=await o.delete(e);if(void 0===t)throw new Error("delete result is undefined");return t}));r.json(i),this.hostApp.broadcastResult(t,e,i)}))}async rpc(e,t){(0,f.debug)("ViewerModule.rpc",e.getReq().body);const s=e.getReq(),r=e.getRes();let o;if(s.body.page)if(s.body.form){o=(await t.getPage(e,s.body.page)).getForm(s.body.form)}else o=await t.getPage(e,s.body.page);else o=t;try{const i=await o.rpc(s.body.name,e);if(void 0===i)throw new Error("rpc action: result is undefined");if(Array.isArray(i)){const[s,o]=i;if(r.json(s),!(o instanceof d.Result))throw new Error("_result is not Result");this.hostApp.broadcastResult(t,e,o)}else r.json(i),i instanceof d.Result&&this.hostApp.broadcastResult(t,e,i)}catch(t){const o=t.message;t.message=`rpc error ${s.body.name}: ${t.message}`,t.context=e,await this.hostApp.logError(t,s),r.json({errorMessage:o})}}async logout(e,t){(0,f.debug)("ViewerModule.logout");const s=e.getReq(),r=e.getRes();if(!s.session.user||!s.session.user[e.getRoute()])throw new Error(`no user for route ${e.getRoute()}`);delete s.session.user[e.getRoute()],await l.BkHelper.Session_save(s.session),r.json(null)}async test(e,t){(0,f.debug)("ViewerModule.test",e.getReq().body);e.getReq();e.getRes().json(null)}async handleGetFile(e,t,s){await t.handleGetFile(e,s)}getHostApp(){return this.hostApp}}},7348:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.home=void 0;t.home=(e,t,s,r,o,i,a,n)=>`<!DOCTYPE html>\n<html class="${e.getViewClassName()} ${e.getAttr("theme")} ${"1"===t.query.debug?"debug":""} ${"1"===t.query.frame?"iframe":"not-iframe"}" lang="${e.getAttr("lang")}">\n<head>\n    \x3c!-- qforms v${r} --\x3e\n    \x3c!-- app v${e.getVersion()}  --\x3e\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${s.getTitle()}</title>\n    \x3c!-- links --\x3e\n    ${o}\n    \x3c!-- scripts --\x3e\n    ${i}\n    <script>\n        document.addEventListener('DOMContentLoaded', async () => {\n            const dataScriptElement = document.querySelector('script[type="application/json"]');\n            const data = JSON.parse(dataScriptElement.textContent);\n            const frontHostApp = new ViewerFrontHostApp({data});\n            frontHostApp.init();\n            await frontHostApp.run();\n        });\n    <\/script>\n    <script type="application/json">${JSON.stringify(a)}<\/script>\n</head>\n<body class="${e.getViewClassName()}__body">\n    <div class="${e.getViewClassName()}__root">${n}</div>\n    <div class="alert-root"></div>\n</body>\n</html>`},1929:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(4484),t),o(s(3874),t),o(s(6688),t),o(s(334),t),o(s(4411),t),o(s(537),t),o(s(9727),t),o(s(5683),t),o(s(1693),t),o(s(7677),t),o(s(7117),t),o(s(1231),t),o(s(1558),t),o(s(1938),t),o(s(4296),t),o(s(1288),t),o(s(3002),t),o(s(2547),t),o(s(8266),t),o(s(3855),t),o(s(1451),t),o(s(236),t),o(s(4905),t),o(s(3955),t),o(s(6908),t),o(s(6676),t),o(s(5915),t),o(s(8141),t),o(s(7017),t),o(s(5721),t),o(s(4437),t),o(s(2956),t),o(s(1718),t),o(s(1185),t)},5642:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.login=void 0;t.login=(e,t,s,r,o,i)=>`<!DOCTYPE html>\n<html class="${s.getLoginViewClassName()}" lang="${s.getAttr("lang")}">\n<head>\n\x3c!-- qforms v${e} --\x3e\n\x3c!-- app v${s.getVersion()}  --\x3e\n<meta charset="utf-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<title>${s.getTitle(t)} - ${s.getText().login.login}</title>\n\x3c!-- links --\x3e\n${r}\n\x3c!-- scripts --\x3e\n${o}\n<script>\n    document.addEventListener('DOMContentLoaded', async () => {\n        const data = JSON.parse(document.querySelector('script[type="application/json"]').textContent);\n        const frontHostApp = new LoginFrontHostApp(data);\n        frontHostApp.init();\n        await frontHostApp.run();\n    });\n<\/script>\n<script type="application/json">${JSON.stringify(i)}<\/script>\n</head>\n<body class="${s.getLoginViewClassName()}__body">\n<div class="${s.getLoginViewClassName()}__root"></div>\n</body>\n</html>`},7791:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ru=t.en=void 0;const o=r(s(7526));t.en=o.default;const i=r(s(2964));t.ru=i.default},8978:(e,t)=>{"use strict";function s(){return t.LOG_LEVELS.indexOf(r())}function r(){return"object"==typeof window?window.QFORMS_LOG_LEVEL||"debug":"object"==typeof global?process.env.QFORMS_LOG_LEVEL||("development"===process.env.NODE_ENV?"debug":"log"):"debug"}Object.defineProperty(t,"__esModule",{value:!0}),t.error=t.warn=t.log=t.debug=t.getLogLevelName=t.getLogLevel=t.LOG_LEVELS=void 0,t.LOG_LEVELS=["debug","log","warn","error"],t.getLogLevel=s,t.getLogLevelName=r,t.debug=function(e,...r){s()<=t.LOG_LEVELS.indexOf("debug")&&console.debug(e,...r)},t.log=function(e,...r){s()<=t.LOG_LEVELS.indexOf("log")&&console.log(e,...r)},t.warn=function(e,...r){s()<=t.LOG_LEVELS.indexOf("log")&&console.warn(e,...r)},t.error=function(e,...t){console.error(e,...t)}},7624:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrontHostApp=void 0;const r=s(6920),o=s(1887),i=s(8978);class FrontHostApp{constructor(e){this.options=e,this.alertCtrl=null,this.documentTitle=""}init(){window.addEventListener("error",this.onWindowError.bind(this)),window.addEventListener("unhandledrejection",this.onWindowUnhandledrejection.bind(this)),window.addEventListener("popstate",this.onWindowPopState.bind(this))}async run(){throw new Error("FrontHostApp.run not implemented")}async onWindowUnhandledrejection(e){(0,i.debug)("FrontHostApp.onWindowUnhandledrejection");try{e.preventDefault();const t=e instanceof Error?e:e.reason||e.detail.reason;this.logError(t),await this.alert({title:"Unhandled Rejection",message:t.message})}catch(e){console.error(`onWindowUnhandledrejection error: ${e.message}`)}}async onWindowError(e){(0,i.debug)("FrontHostApp.onWindowError",e);try{e.preventDefault();const t=e.error;this.logError(t)}catch(e){console.error(`onWindowError error: ${e.message}`)}}logError(e){console.error("FrontHostApp.logError",e)}static async doHttpRequest(e){console.warn("FrontHostApp.doHttpRequest","POST",window.location.href,e);const[t,s]=await FrontHostApp.fetchJson("POST",window.location.href,e);return console.warn(`body ${FrontHostApp.composeHandlerName(e)}:`,s),s}static composeHandlerName(e){return"rpc"===e.action?e.form?`${e.page}.${e.form}.${e.name}.${e.action}`:e.page?`${e.page}.${e.name}.${e.action}`:`${e.name}.${e.action}`:`${e.page}.${e.form}.${e.ds}.${e.action}`}static async doHttpRequest2(e,t){console.warn("FrontHostApp.doHttpRequest2",e,window.location.href,t);const[s,r]=await FrontHostApp.fetchJson(e,window.location.href,t);return console.warn(`body ${FrontHostApp.composeHandlerName(t)}:`,r),[s,r]}static async fetchJson(e,t,s){return await FrontHostApp.fetch(e,t,JSON.stringify(s),"application/json")}static async fetch(e,t,s,r){try{FrontHostApp.startWait();const o=await fetch(t,Object.assign({method:e,body:s},r?{headers:{"Content-Type":r}}:{}));if(o.ok){const e=Array.from(o.headers.entries()).reduce(((e,t)=>{const[s,r]=t;return e[s]=r,e}),{});return[e,await o.json()]}throw new Error(`${o.status} ${o.statusText}: ${await o.text()}`)}finally{FrontHostApp.stopWait()}}static startWait(){document.querySelector("html").classList.add("wait")}static stopWait(){document.querySelector("html").classList.remove("wait")}async onWindowPopState(e){(0,i.debug)("FrontHostApp.onWindowPopState",e.state)}async alert(e){(0,i.debug)("FrontHostApp.alert",e),alert(e.message)}async confirm(e){return(0,i.debug)("FrontHostApp.confirm",e),confirm(e.message)}setDocumentTitle(e){"object"==typeof document?document.title=e:this.documentTitle=e}getDocumentTitle(){return"object"==typeof document?document.title:this.documentTitle}isDebugMode(){return"object"==typeof window?"1"===o.Search.getObj().debug:this.getOptions().debug}createLink(e=null){const t="object"==typeof window?window.location.pathname:this.getOptions().url.pathname;return e?[t,[...this.isDebugMode()?["debug=1"]:[],...Object.keys(e).map((t=>`${t}=${encodeURI(e[t])}`))].join("&")].join("?"):t}getOptions(){if(!this.options)throw new Error("no options");return this.options}filterSearch(e){if("object"==typeof window)return o.Search.filter(e);const t={},s=this.getOptions().url.searchParams;for(const r of e)s.hasOwnProperty(r)&&(t[r]=s[r]);return o.Search.objToString(t)}getSearchParams(){return"object"==typeof window?o.Search.getObj():Object.fromEntries(this.getOptions().url.searchParams)}getCookie(e){return"object"==typeof window?r.Helper.getCookie(e):this.getOptions().cookies[e]}getLocation(){return"object"==typeof window?window.location:this.getOptions().url}}t.FrontHostApp=FrontHostApp},6920:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Helper=void 0;const o=r(s(6689)),i=r(s(6405)),a=s(8978);class Helper{static formatDate(e,t){const s=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),i=e.getHours(),a=e.getMinutes(),n=e.getSeconds(),l={YYYY:s,M:r,D:o,h:i,m:a,s:n,MM:r<10?`0${r}`:r,DD:o<10?`0${o}`:o,hh:i<10?`0${i}`:i,mm:a<10?`0${a}`:a,ss:n<10?`0${n}`:n};return t.replace(/\{([\w.]+)\}/g,((e,t)=>l[t]?l[t]:e))}static formatNumber(e){return new Intl.NumberFormat("ru-RU").format(e)}static today(){const e=new Date;return Helper.getStartOfDay(e)}static getStartOfDay(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}static encodeObject(e){const t={};for(const s in e)t[s]=Helper.encodeValue(e[s]);return t}static encodeValue(e){return JSON.stringify(e)}static decodeObject(e){if(!e)throw new Error("Helper.decodeObject: no object");const t={};for(const s in e)t[s]=Helper.decodeValue(e[s]);return t}static decodeValue(e){return JSON.parse(e,Helper.dateTimeReviver)}static dateTimeReviver(e,t){if("string"==typeof t){if(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d{3})?(Z|([+-])(\d{2}):(\d{2}))?$/.exec(t))return new Date(t)}return t}static createReactComponent(e,t,s={},r){let a;const n=o.default.createElement(o.default.StrictMode,{},[o.default.createElement(t,Object.assign(Object.assign({},s),{onCreate:(e,t)=>{a=e}}),r)]);return i.default.render(n,e),a}static createReactComponent2(e,t,s={},r){let a;const n=o.default.createElement(o.default.StrictMode,{},[o.default.createElement(t,Object.assign(Object.assign({},s),{onCreate:(e,t)=>{a=e}}),r)]);return i.default.hydrate(n,e),a}static destroyReactComponent(e){i.default.unmountComponentAtNode(e)}static readFileAsDataURL(e){return new Promise((t=>{const s=new FileReader;s.onload=()=>t(s.result),s.readAsDataURL(e)}))}static templateToJsString(e,t){return e.replace(/\$\{([\w.@]+)\}/g,((e,s)=>t.hasOwnProperty(s)?`Helper.decodeValue('${Helper.encodeValue(t[s])}')`:"undefined"))}static moveArrItem(e,t,s){const r=e.indexOf(t);if(-1===r)throw new Error("cannot find element");const o=r+s;if(o<0)throw new Error("cannot up top element");if(o>e.length-1)throw new Error("cannot down bottom element");e.splice(o,0,e.splice(r,1)[0])}static formatTime(e){let t=e,s="";e<0&&(t=-t,s="-");let r=Math.floor(t/3600),o=Math.floor((t-3600*r)/60),i=Math.floor(t-3600*r-60*o);return r<10&&(r="0"+r),o<10&&(o="0"+o),i<10&&(i="0"+i),0===Math.floor(t/3600)?`${s}${o}:${i}`:`${s}${r}:${o}:${i}`}static formatTime2(e){let t=e,s="";e<0&&(t=-t,s="-");let r=Math.floor(t/3600),o=Math.floor((t-3600*r)/60),i=Math.floor(t-3600*r-60*o);return r<10&&(r="0"+r),o<10&&(o="0"+o),i<10&&(i="0"+i),0===Math.floor(t/3600)?`${s}${o}m:${i}s`:`${s}${r}h:${o}m:${i}s`}static SECOND(){return 1e3}static MINUTE(){return 60*Helper.SECOND()}static HOUR(){return 60*Helper.MINUTE()}static DAY(){return 24*Helper.HOUR()}static WEEK(){return 7*Helper.DAY()}static fallbackCopyTextToClipboard(e){const t=document.activeElement,s=document.createElement("textarea");s.value=e,s.style.top="0",s.style.left="0",s.style.position="fixed",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),document.body.removeChild(s),t.focus()}static async copyTextToClipboard(e){(0,a.debug)("Helper.copyTextToClipboard",e),navigator.clipboard?await navigator.clipboard.writeText(e):Helper.fallbackCopyTextToClipboard(e)}static addMinutes(e,t){e.setMinutes(e.getMinutes()+t)}static removeTimezoneOffset(e){Helper.addMinutes(e,-e.getTimezoneOffset())}static addTimezoneOffset(e){Helper.addMinutes(e,e.getTimezoneOffset())}static cloneDate(e){return new Date(e.getTime())}static fillArray(e){return Array.from(Array(e).keys())}static setCookie(e,t,s){let r="";if(s){r="; expires="+new Date(s).toUTCString()}document.cookie=e+"="+(encodeURIComponent(t)||"")+r+"; path=/"}static getCookie(e){const t=e+"=",s=document.cookie.split(";");for(let e=0;e<s.length;e++){let r=s[e];for(;" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}}static eraseCookie(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}static delay(e=1e3){return new Promise((t=>{setTimeout(t,e)}))}static registerGlobalClass(e){if("object"==typeof window){if(window[e.name])throw new Error(`window.${e.name} already used`);window[e.name]=e}else{if(global[e.name])throw new Error(`global.${e.name} already used`);global[e.name]=e}}static getGlobalClass(e){return"object"==typeof window?window[e]:global[e]}static addClassToDocumentElement(e){"object"==typeof document&&document.documentElement.classList.add(e)}}t.Helper=Helper,Helper.registerGlobalClass(Helper)},6822:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactComponent=void 0;const r=s(6689);class ReactComponent extends r.Component{constructor(e){super(e),e.onCreate&&e.onCreate(this,this.props.name),this.allowRerender=!0}getElement(){return this.el.current}getParent(){return this.props.parent}checkParent(){if(!this.props.parent)throw new Error(`${this.constructor.name}: no parent`)}getClassList(){return[this.getCssBlockName(),...this.props.classList||[],...this.state&&this.state.classList?this.state.classList:[]]}addCssClass(e){-1===this.state.classList.indexOf(e)&&this.state.classList.push(e)}removeCssClass(e){this.state.classList.splice(this.state.classList.indexOf(e),1)}getCssBlockName(){return this.constructor.name}getCssClassNames(){return this.getClassList().join(" ")}rerender(e=!0){return this.canRerender()?new Promise((t=>{const s=Date.now();this.forceUpdate((()=>{e&&console.debug(`${this.constructor.name}.rerender time:`,Date.now()-s),t()}))})):Promise.resolve()}canRerender(){return!!this.allowRerender&&(!this.props.parent||this.props.parent.canRerender())}disableRerender(){console.debug(`${this.constructor.name}.disableRerender`),this.allowRerender=!1}enableRerender(){console.debug(`${this.constructor.name}.enableRerender`),this.allowRerender=!0}componentWillUnmount(){this.props.onUnmount&&this.props.onUnmount(this,this.props.name)}isEnabled(){return!this.isDisabled()}isDisabled(){return this.state&&void 0!==this.state.disabled?this.state.disabled:void 0!==this.props.disabled?this.props.disabled:void 0!==this.props.enabled&&!this.props.enabled}disable(){if(!this.state)throw new Error("no state");this.setState({disabled:!0})}enable(){if(!this.state)throw new Error("no state");this.setState({disabled:void 0})}}t.ReactComponent=ReactComponent,"object"==typeof window&&(window.ReactComponent=ReactComponent)},1887:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Search=void 0;class Search{static getObj(){return window.location.search.split("?")[1]?window.location.search.split("?")[1].split("&").reduce(((e,t)=>{const s=t.split("=");return e[s[0]]=decodeURIComponent(s[1]),e}),{}):{}}static objToString(e){const t=Object.keys(e).map((t=>`${t}=${encodeURIComponent(e[t])}`)).join("&");return t?`?${t}`:""}static filter(e){const t={},s=Search.getObj();for(const r of e)s.hasOwnProperty(r)&&(t[r]=s[r]);return Search.objToString(t)}}t.Search=Search},9490:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArrowIcon=void 0;const r=s(997);t.ArrowIcon=e=>(0,r.jsx)("svg",Object.assign({width:"10px",height:"6px",viewBox:"0 0 10 6"},{children:(0,r.jsx)("path",{d:"M1.429.253a.819.819 0 0 0-1.184 0 .883.883 0 0 0 0 1.22l4.142 4.274A.821.821 0 0 0 5 6a.821.821 0 0 0 .612-.253l4.143-4.273a.883.883 0 0 0 0-1.221.819.819 0 0 0-1.184 0L5 3.937 1.429.253z"})})),"object"==typeof window&&(window.ArrowIcon=t.ArrowIcon)},1910:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.CancelIcon=void 0;const a=s(997),n=i(s(6689));class CancelIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none",opacity:".87"}),(0,a.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"})]}))}}t.CancelIcon=CancelIcon,"object"==typeof window&&(window.CancelIcon=CancelIcon)},24:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloseIcon=void 0;const r=s(997);t.CloseIcon=e=>(0,r.jsxs)("svg",Object.assign({width:"10px",height:"10px",viewBox:"0 0 10 10"},{children:[(0,r.jsx)("line",{x1:"2",y1:"2",x2:"8",y2:"8",stroke:"#aaa",strokeWidth:1,strokeMiterlimit:"10"}),(0,r.jsx)("line",{x1:"8",y1:"2",x2:"2",y2:"8",stroke:"#aaa",strokeWidth:1,strokeMiterlimit:"10"})]})),"object"==typeof window&&(window.CloseIcon=t.CloseIcon)},7649:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloseIcon2=void 0;const r=s(997);t.CloseIcon2=e=>{const t=e.size||24;return(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24"},{children:[(0,r.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,r.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"})]}))},"object"==typeof window&&(window.CloseIcon2=t.CloseIcon2)},4060:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DateIcon=void 0;const a=s(997),n=i(s(6689));class DateIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"18px",viewBox:"0 0 24 24",width:"18px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V10h16v11zm0-13H4V5h16v3z"})]}))}}t.DateIcon=DateIcon,"object"==typeof window&&(window.DateIcon=DateIcon)},1088:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteIcon=void 0;const a=s(997),n=i(s(6689));class DeleteIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"})]}))}}t.DeleteIcon=DeleteIcon,"object"==typeof window&&(window.DeleteIcon=DeleteIcon)},8428:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DoneIcon=void 0;const a=s(997),n=i(s(6689));class DoneIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"})]}))}}t.DoneIcon=DoneIcon,"object"==typeof window&&(window.DoneIcon=DoneIcon)},4152:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DownIcon=void 0;const a=s(997),n=i(s(6689));class DownIcon extends n.Component{render(){const e=this.props.size||24;return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:e,width:e,viewBox:"0 0 24 24"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"})]}))}}t.DownIcon=DownIcon,"object"==typeof window&&(window.DoneIcon=DoneIcon)},206:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.EditIcon=void 0;const a=s(997),n=i(s(6689));class EditIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"})]}))}}t.EditIcon=EditIcon,"object"==typeof window&&(window.EditIcon=EditIcon)},8261:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LeftIcon=void 0;const r=s(997);t.LeftIcon=e=>{const t=e.size||24;return(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:t,width:t,viewBox:"0 0 24 24",fill:"#000000"},{children:[(0,r.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,r.jsx)("path",{d:"M15.61 7.41L14.2 6l-6 6 6 6 1.41-1.41L11.03 12l4.58-4.59z"})]}))},"object"==typeof window&&(window.LeftIcon=t.LeftIcon)},7225:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.LocationIcon=void 0;const a=s(997),n=i(s(6689));class LocationIcon extends n.Component{render(){const e=this.props.size||24;return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zM7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9z"}),(0,a.jsx)("circle",{cx:"12",cy:"9",r:"2.5"})]}))}}t.LocationIcon=LocationIcon,"object"==typeof window&&(window.LocationIcon=LocationIcon)},4752:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.MoreVertIcon=void 0;const a=s(997),n=i(s(6689));class MoreVertIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})]}))}}t.MoreVertIcon=MoreVertIcon,"object"==typeof window&&(window.MoreVertIcon=MoreVertIcon)},4718:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenInNewIcon=void 0;const r=s(997);t.OpenInNewIcon=()=>(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,r.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,r.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"})]})),"object"==typeof window&&(window.OpenInNewIcon=t.OpenInNewIcon)},2100:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordIcon=void 0;const a=s(997),n=i(s(6689));class PasswordIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",enableBackground:"new 0 0 24 24",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("g",{children:(0,a.jsx)("path",{d:"M0,0h24v24H0V0z",fill:"none"})}),(0,a.jsx)("g",{children:(0,a.jsx)("g",{children:(0,a.jsx)("path",{d:"M2,17h20v2H2V17z M3.15,12.95L4,11.47l0.85,1.48l1.3-0.75L5.3,10.72H7v-1.5H5.3l0.85-1.47L4.85,7L4,8.47L3.15,7l-1.3,0.75 L2.7,9.22H1v1.5h1.7L1.85,12.2L3.15,12.95z M9.85,12.2l1.3,0.75L12,11.47l0.85,1.48l1.3-0.75l-0.85-1.48H15v-1.5h-1.7l0.85-1.47 L12.85,7L12,8.47L11.15,7l-1.3,0.75l0.85,1.47H9v1.5h1.7L9.85,12.2z M23,9.22h-1.7l0.85-1.47L20.85,7L20,8.47L19.15,7l-1.3,0.75 l0.85,1.47H17v1.5h1.7l-0.85,1.48l1.3,0.75L20,11.47l0.85,1.48l1.3-0.75l-0.85-1.48H23V9.22z"})})})]}))}}t.PasswordIcon=PasswordIcon,"object"==typeof window&&(window.PasswordIcon=PasswordIcon)},4022:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneIcon=void 0;const a=s(997),n=i(s(6689));class PhoneIcon extends n.Component{render(){const e=this.props.size||24;return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:e,width:e,viewBox:"0 0 24 24"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"})]}))}}t.PhoneIcon=PhoneIcon,"object"==typeof window&&(window.PhoneIcon=PhoneIcon)},9752:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RightIcon=void 0;const r=s(997);t.RightIcon=e=>{const t=e.size||24;return(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:t,width:t,viewBox:"0 0 24 24",fill:"#000000"},{children:[(0,r.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,r.jsx)("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})]}))},"object"==typeof window&&(window.RightIcon=t.RightIcon)},2303:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsIcon=void 0;const a=s(997),n=i(s(6689));class SettingsIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M19.43 12.98c.04-.32.07-.64.07-.98 0-.34-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.09-.16-.26-.25-.44-.25-.06 0-.12.01-.17.03l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.06-.02-.12-.03-.18-.03-.17 0-.34.09-.43.25l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98 0 .33.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.09.16.26.25.44.25.06 0 .12-.01.17-.03l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.06.02.12.03.18.03.17 0 .34-.09.43-.25l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zm-1.98-1.71c.04.31.05.52.05.73 0 .21-.02.43-.05.73l-.14 1.13.89.7 1.08.84-.7 1.21-1.27-.51-1.04-.42-.9.68c-.43.32-.84.56-1.25.73l-1.06.43-.16 1.13-.2 1.35h-1.4l-.19-1.35-.16-1.13-1.06-.43c-.43-.18-.83-.41-1.23-.71l-.91-.7-1.06.43-1.27.51-.7-1.21 1.08-.84.89-.7-.14-1.13c-.03-.31-.05-.54-.05-.74s.02-.43.05-.73l.14-1.13-.89-.7-1.08-.84.7-1.21 1.27.51 1.04.42.9-.68c.43-.32.84-.56 1.25-.73l1.06-.43.16-1.13.2-1.35h1.39l.19 1.35.16 1.13 1.06.43c.43.18.83.41 1.23.71l.91.7 1.06-.43 1.27-.51.7 1.21-1.07.85-.89.7.14 1.13zM12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"})]}))}}t.SettingsIcon=SettingsIcon,"object"==typeof window&&(window.SettingsIcon=SettingsIcon)},6709:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.TimeIcon=void 0;const a=s(997),n=i(s(6689));class TimeIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",enableBackground:"new 0 0 24 24",height:"18px",viewBox:"0 0 24 24",width:"18px",fill:"#000000"},{children:[(0,a.jsx)("g",{children:(0,a.jsx)("rect",{fill:"none",height:"24",width:"24",x:"0"})}),(0,a.jsx)("g",{children:(0,a.jsx)("g",{children:(0,a.jsx)("path",{d:"M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M12,20c-4.41,0-8-3.59-8-8s3.59-8,8-8s8,3.59,8,8 S16.41,20,12,20z M12.5,7H11v6l5.2,3.2l0.8-1.3l-4.5-2.7V7z"})})})]}))}}t.TimeIcon=TimeIcon,"object"==typeof window&&(window.TimeIcon=TimeIcon)},4882:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityIcon=void 0;const a=s(997),n=i(s(6689));class VisibilityIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"})]}))}}t.VisibilityIcon=VisibilityIcon,"object"==typeof window&&(window.VisibilityIcon=VisibilityIcon)},5994:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityOffIcon=void 0;const a=s(997),n=i(s(6689));class VisibilityOffIcon extends n.Component{render(){return(0,a.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000"},{children:[(0,a.jsx)("path",{d:"M0 0h24v24H0V0zm0 0h24v24H0V0zm0 0h24v24H0V0zm0 0h24v24H0V0z",fill:"none"}),(0,a.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"})]}))}}t.VisibilityOffIcon=VisibilityOffIcon,"object"==typeof window&&(window.VisibilityOffIcon=VisibilityOffIcon)},3958:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(24),t),o(s(8261),t),o(s(9752),t),o(s(4718),t),o(s(4752),t),o(s(7649),t),o(s(4882),t),o(s(5994),t),o(s(7225),t),o(s(2303),t),o(s(8428),t),o(s(1910),t),o(s(4022),t),o(s(2100),t),o(s(1088),t),o(s(206),t),o(s(9490),t),o(s(4152),t),o(s(4060),t),o(s(6709),t)},7534:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(7624),t),o(s(6920),t),o(s(6822),t),o(s(1887),t),o(s(3958),t),o(s(1123),t)},4051:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Box=void 0;const r=s(997),o=s(6822),i=s(50);s(641);class Box extends o.ReactComponent{constructor(e){super(e),this.update=()=>{console.debug("Box.update"),this.setState({backgroundColor:"green"})},this.state={backgroundColor:"purple"}}componentDidMount(){console.debug("Box.componentDidMount")}componentWillUnmount(){console.debug("Box.componentWillUnmount")}shouldComponentUpdate(e,t){return console.debug("Box.shouldComponentUpdate",e,t),!0}componentDidUpdate(){console.debug("Box.componentDidUpdate")}render(){return console.debug("Box.render"),(0,r.jsxs)("div",Object.assign({className:"Box"},{children:[(0,r.jsx)(i.Button,{name:"one"}),(0,r.jsx)(i.Button,{name:"two"}),(0,r.jsx)(i.Button,{name:"three"})]}))}}t.Box=Box,"object"==typeof window&&(window.Box=Box)},50:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;const r=s(997),o=s(6689),i=s(6822);class Button extends i.ReactComponent{constructor(e){super(e),this.state={disabled:void 0},this.el=(0,o.createRef)()}isVisible(){return void 0===this.props.visible||this.props.visible}getStyle(){return{display:this.isVisible()?void 0:"none",width:this.props.width}}render(){return(0,r.jsx)("button",Object.assign({className:this.getCssClassNames(),ref:this.el,id:this.props.id,type:this.props.type,name:this.props.name,disabled:this.isDisabled(),onClick:this.props.onClick,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onKeyDown:this.props.onKeyDown,style:this.getStyle()},{children:this.props.title||this.props.children}))}}t.Button=Button,"object"==typeof window&&(window.Button=Button)},3544:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckBox=void 0;const r=s(997),o=s(6822);s(7703);class CheckBox extends o.ReactComponent{constructor(e){if(super(e),this.onChange=e=>{this.props.readOnly||this.setState((t=>(this.props.onChange&&this.props.onChange(!t.checked,e),{checked:!t.checked})))},this.onClick=e=>{this.props.readOnly||(this.props.onChange&&this.props.onChange(!0),this.setState({checked:!0}))},void 0!==this.props.checked&&null!==this.props.checked&&"boolean"!=typeof this.props.checked)throw new Error(`wrong checked prop: ${this.props.checked}`);this.state={checked:"boolean"==typeof this.props.checked?this.props.checked:null}}getValue(){return this.state.checked}shouldComponentUpdate(e,t){return this.state.checked="boolean"==typeof e.checked?e.checked:null,!0}render(){return null===this.state.checked?(0,r.jsx)("div",Object.assign({className:`${this.getCssClassNames()} ${this.isDisabled()?"disabled":""}`,onClick:this.onClick},{children:"?"})):(0,r.jsx)("input",{className:this.getCssClassNames(),type:"checkbox",id:this.props.id,checked:this.state.checked,readOnly:this.props.readOnly,disabled:this.props.disabled,"data-tag":this.props.tag,onChange:this.onChange})}}t.CheckBox=CheckBox,"object"==typeof window&&(window.CheckBox=CheckBox)},584:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckBoxList=void 0;const r=s(997),o=s(6822);class CheckBoxList extends o.ReactComponent{constructor(e){if(super(e),this.onCheckBoxChange=e=>{const t=e.target.checked,s=e.target.dataset.value;this.setState((e=>{const r=[...e.value||[]];if(t){if(r.indexOf(s)>-1)throw console.debug("value:",s,t,r),new Error("CheckBoxList value error");r.push(s)}else{if(-1===r.indexOf(s))throw console.debug("value:",s,t,r),new Error("CheckBoxList value error");r.splice(r.indexOf(s),1)}return{value:r}}),(()=>{this.props.onChange&&this.props.onChange(this.getValue())}))},!this.props.name)throw new Error("no CheckBoxList name");this.state={value:this.props.value||[]}}getItems(){return this.props.items||[]}getValue(){return this.state.value||[]}isValueChecked(e){return this.getValue().indexOf(e)>-1}composeItemId(e){return`${this.props.name}.${e}`}shouldComponentUpdate(e,t){return this.state.value=e.value,!0}render(){return(0,r.jsx)("ul",Object.assign({className:this.getCssClassNames()},{children:this.getItems().map((e=>{if(void 0===e.value)throw new Error("no item value");return(0,r.jsxs)("li",{children:[(0,r.jsx)("input",{type:"checkbox",id:this.composeItemId(e.value),checked:this.isValueChecked(e.value),onChange:this.onCheckBoxChange,"data-value":e.value,readOnly:this.props.readOnly}),(0,r.jsx)("label",Object.assign({htmlFor:this.composeItemId(e.value)},{children:e.title||e.value}))]},e.value)}))}))}}t.CheckBoxList=CheckBoxList,"object"==typeof window&&(window.CheckBoxList=CheckBoxList)},1735:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComboBox=void 0;const r=s(997),o=s(6822);class ComboBox extends o.ReactComponent{constructor(e){if(super(e),this.onChange=async e=>{this.setState({value:e.target.value}),this.props.onChange&&await this.props.onChange(e.target.value)},this.onMouseDown=async e=>{this.props.onMouseDown&&await this.props.onMouseDown(e)},!e.items)throw new Error("no ComboBox items");this.state={value:this.getInitialValue()}}getInitialValue(){let e=null;if(void 0!==this.props.value&&null!==this.props.value){e=this.props.value;this.props.items.find((e=>e.value===this.props.value))||this.props.nullable&&""===e||(console.error("ComboBox: no item for value:",JSON.stringify(this.props.value)),console.debug("items:",this.props.items))}else e=this.props.items.length?this.props.items[0].value:"";if(null===e)throw new Error("null is wrong value for ComboBox");return e}getValue(){return this.state.value}shouldComponentUpdate(e,t){return this.state.value=e.value,!0}render(){return(0,r.jsxs)("select",Object.assign({className:this.getCssClassNames(),onChange:this.onChange,value:this.state.value,disabled:this.props.readOnly,size:this.props.size,style:this.props.style,id:this.props.id,onDoubleClick:this.props.onDoubleClick,onMouseDown:this.onMouseDown},{children:[this.props.nullable&&(0,r.jsx)("option",Object.assign({value:""},{children:this.props.placeholder})),this.props.items&&this.props.items.map((e=>(0,r.jsx)("option",Object.assign({value:e.value},{children:e.title||e.value}),e.value)))]}))}}t.ComboBox=ComboBox,"object"==typeof window&&(window.ComboBox=ComboBox)},6868:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatePicker=void 0;const r=s(997),o=s(6822),i=s(6920),a=s(8261),n=s(9752);s(3526);class DatePicker extends o.ReactComponent{constructor(e){if(super(e),this.onClick=e=>{if(console.debug("DatePicker.onClick",e.target),"TD"===e.target.nodeName&&e.target.classList.contains("selectable"))return this.onDateClick(e.target)},this.onMouseDown=e=>{if(this.props.onMouseDown)return this.props.onMouseDown(e)},this.onNextClick=e=>{this.setState((e=>{const t=new Date(e.selectedMonth[0],e.selectedMonth[1]);return t.setMonth(t.getMonth()+1),{selectedMonth:[t.getFullYear(),t.getMonth()]}}))},this.onPrevClick=e=>{this.setState((e=>{const t=new Date(e.selectedMonth[0],e.selectedMonth[1]);return t.setMonth(t.getMonth()-1),{selectedMonth:[t.getFullYear(),t.getMonth()]}}))},this.props.minDate&&!(this.props.minDate instanceof Array))throw new Error("minDate must be array");this.state={selectedMonth:this.calcSelectedMonth()},this.MONTH=["","","","","","","","","","","",""]}static createDateFromArr(e){return new Date(e[0],e[1],e[2])}isVisible(){return!1!==this.props.visible}calcSelectedMonth(){if(this.props.selectedDate)return[this.props.selectedDate[0],this.props.selectedDate[1]];if(this.props.highlightedDate)return[this.props.highlightedDate[0],this.props.highlightedDate[1]];{const e=[i.Helper.today().getTime()];this.props.minDate&&e.push(DatePicker.createDateFromArr(this.props.minDate).getTime());const t=new Date(Math.min(...e));return[t.getFullYear(),t.getMonth()]}}static getTodayArr(){return DatePicker.dateToArray(new Date)}static dateToArray(e){return[e.getFullYear(),e.getMonth(),e.getDate()]}static getDay(e){let t=e.getDay()-1;return-1===t&&(t=6),0===t&&(t=7),t}createSelectedDate(){if(!this.isDateSelected())throw new Error("date not selected");return new Date(...this.props.selectedDate)}isDateSelected(){return!!this.props.selectedDate}getFirstDateOfTable(){const e=new Date(this.state.selectedMonth[0],this.state.selectedMonth[1],1);return e.setDate(e.getDate()-DatePicker.getDay(e)),e}createMinDate(){if(!this.props.minDate)throw new Error("no min date");return new Date(this.props.minDate[0],this.props.minDate[1],this.props.minDate[2])}isMinDate(){return!!this.props.minDate}isPrevAllowed(){const e=new Date(this.state.selectedMonth[0],this.state.selectedMonth[1]);return e.setMonth(e.getMonth()-1),this.isMonthAllowed(e)}isMonthAllowed(e){if(this.isMinDate()){const t=new Date(this.props.minDate[0],this.props.minDate[1]);return e.getTime()>=t.getTime()}return!0}onDateClick(e){this.props.onDateSelected&&this.props.onDateSelected(JSON.parse(e.dataset.date))}render(){const e=this.getFirstDateOfTable(),t=i.Helper.today(),s=this.isMinDate()?this.createMinDate():null,o=this.isDateSelected()?this.createSelectedDate():null,l=this.props.highlightedDate?new Date(...this.props.highlightedDate):null;return(0,r.jsxs)("table",Object.assign({className:`${this.getCssClassNames()} ${this.isVisible()?"visible":""}`,onClick:this.onClick,onMouseDown:this.onMouseDown},{children:[(0,r.jsx)("caption",Object.assign({className:`${this.getCssBlockName()}__caption`},{children:(0,r.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__caption-content`},{children:[(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__caption-link ${this.isPrevAllowed()?"enabled":""}`,onClick:this.onPrevClick},{children:(0,r.jsx)(a.LeftIcon,{size:18})})),(0,r.jsx)("span",Object.assign({className:`${this.getCssBlockName()}__caption-title`},{children:`${this.MONTH[this.state.selectedMonth[1]]}, ${this.state.selectedMonth[0]}`})),(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__caption-link enabled`,onClick:this.onNextClick},{children:(0,r.jsx)(n.RightIcon,{size:18})}))]}))})),(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",Object.assign({className:`${this.getCssBlockName()}__th`},{children:""})),(0,r.jsx)("th",Object.assign({className:`${this.getCssBlockName()}__th`},{children:""})),(0,r.jsx)("th",Object.assign({className:`${this.getCssBlockName()}__th`},{children:""})),(0,r.jsx)("th",Object.assign({className:`${this.getCssBlockName()}__th`},{children:""})),(0,r.jsx)("th",Object.assign({className:`${this.getCssBlockName()}__th`},{children:""})),(0,r.jsx)("th",Object.assign({className:`${this.getCssBlockName()}__th weekend`},{children:""})),(0,r.jsx)("th",Object.assign({className:`${this.getCssBlockName()}__th weekend`},{children:""}))]})}),(0,r.jsx)("tbody",{children:Array.from(Array(6).keys()).map((i=>(0,r.jsx)("tr",{children:Array.from(Array(7).keys()).map((i=>{const a=[];5!==i&&6!==i||a.push("weekend"),this.isSelectToday()&&e.getTime()===t.getTime()&&a.push("today"),e.getMonth()!==this.state.selectedMonth[1]&&a.push("out"),s?e.getTime()>=s.getTime()&&a.push("selectable"):a.push("selectable"),o&&e.getTime()===o.getTime()&&a.push("selected"),l&&l.getTime()===e.getTime()&&a.push("highlight");const n=e.getDate().toString(),c=JSON.stringify(DatePicker.dateToArray(e)),d=this.props.getDateStyle?this.props.getDateStyle(e):null;return e.setDate(e.getDate()+1),(0,r.jsx)("td",Object.assign({className:`${this.getCssBlockName()}__td  ${a.join(" ")}`,style:d,"data-date":c},{children:n}),n)}))},i)))})]}))}isSelectToday(){return!1!==this.props.selectToday}}t.DatePicker=DatePicker,"object"==typeof window&&(window.DatePicker=DatePicker)},7592:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropdownButton=void 0;const r=s(997),o=s(6920),i=s(6822),a=s(50);s(7369);class DropdownButton extends i.ReactComponent{constructor(e){super(e),this.onButtonClick=e=>{this.setState((e=>({open:!e.open})))},this.onButtonBlur=e=>{this.state.open&&this.setState({open:!1})},this.onKeyDown=e=>{"Escape"===e.key&&this.state.open&&(this.setState({open:!1}),e.stopPropagation())},this.onUlMouseDown=e=>{e.preventDefault()},this.onLiClick=async e=>{const t=e.currentTarget;this.setState({open:!1},(()=>{this.props.onClick&&this.props.onClick(t)}))},this.state={open:!1,disabled:!1}}isEnabled(){return void 0!==this.props.enabled?this.props.enabled:!this.state.disabled}render(){return(0,r.jsxs)("div",Object.assign({className:`${this.getCssClassNames()} ${this.state.open&&"show"}`},{children:[(0,r.jsx)(a.Button,Object.assign({classList:[`${this.getCssBlockName()}__button`],onClick:this.onButtonClick,onBlur:this.onButtonBlur,enabled:this.isEnabled(),onKeyDown:this.onKeyDown},{children:this.props.title||this.props.children})),(0,r.jsx)("ul",Object.assign({className:`${this.getCssBlockName()}__dropdown`,onMouseDown:this.onUlMouseDown},{children:this.props.actions&&this.props.actions.map((e=>(0,r.jsx)("li",Object.assign({className:`${this.getCssBlockName()}__item ${!1===e.enabled?"disabled":""}`,"data-action":e.name,onClick:!1!==e.enabled?this.onLiClick:void 0},{children:e.title}),e.name)))}))]}))}}t.DropdownButton=DropdownButton,o.Helper.registerGlobalClass(DropdownButton)},305:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropdownDatePicker=void 0;const r=s(997),o=s(6822),i=s(6920),a=s(24),n=s(4060),l=s(7649),c=s(6868);s(6461);class DropdownDatePicker extends o.ReactComponent{constructor(e){if(super(e),this.onInputClick=e=>{this.props.readOnly||this.setState((e=>({open:!e.open})))},this.onInputKeyDown=e=>{"Escape"===e.key&&this.state.open&&(this.setState({open:!1}),e.stopPropagation())},this.onCloseDown=async e=>{this.setState({value:null}),this.props.onChange&&this.props.onChange(null)},this.onBlur=e=>{this.state.open&&this.setState({open:!1})},this.onDatePickerMouseDown=e=>{e.preventDefault()},this.onDatePickerDateSelected=e=>{const t=new Date(e[0],e[1],e[2]);this.setState({open:!1,value:t}),this.props.onChange&&this.props.onChange(t)},this.state={open:!1,value:e.value||null},e.value&&!(e.value instanceof Date))throw new Error("need Date type, got "+typeof e.value)}getFormat(){return this.props.format||"{DD}.{MM}.{YYYY} {hh}:{mm}:{ss}"}getStringValue(){const e=this.getValue();if(e){let t=this.getFormat();if(this.isDebugMode()){const s=i.Helper.formatDate(e,"{hh}:{mm}:{ss}");"{DD}.{MM}.{YYYY}"===t&&"00:00:00"!==s&&(t="{DD}.{MM}.{YYYY} {hh}:{mm}:{ss}")}return i.Helper.formatDate(e,t)}return""}getSelectedMonth(){return this.getValue()?[this.getValue().getFullYear(),this.getValue().getMonth()]:null}getSelectedDate(){return this.getValue()?[this.getValue().getFullYear(),this.getValue().getMonth(),this.getValue().getDate()]:null}getValue(){return this.state.value}shouldComponentUpdate(e,t){return this.state.value=e.value,!0}getClassList(){return[...super.getClassList(),...this.props.readOnly?["read-only"]:[]]}renderInput(){return(0,r.jsx)("input",{className:`${this.getCssBlockName()}__input`,type:"text",readOnly:!0,onClick:this.onInputClick,onBlur:this.onBlur,value:this.getStringValue(),placeholder:this.props.placeholder,onKeyDown:this.onInputKeyDown})}renderCloseIcon(){return(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close ${""===this.getStringValue()||this.props.readOnly?"":"visible"}`,onMouseDown:this.onCloseDown},{children:(0,r.jsx)(a.CloseIcon,{})}))}renderDateIcon(){return(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__icon`},{children:(0,r.jsx)(n.DateIcon,{})}))}renderDatePicker(){return(0,r.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__date-picker-container`},{children:[(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__date-picker-close`},{children:(0,r.jsx)(l.CloseIcon2,{})})),(0,r.jsx)(c.DatePicker,{minDate:this.props.minDate,selectedMonth:this.getSelectedMonth(),selectedDate:this.getSelectedDate(),onMouseDown:this.onDatePickerMouseDown,onDateSelected:this.onDatePickerDateSelected,selectToday:this.props.selectToday,highlightedDate:this.props.highlightedDate})]}))}render(){return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[this.renderInput(),this.renderCloseIcon(),this.renderDateIcon(),this.state.open&&this.renderDatePicker()]}))}isDebugMode(){return!0===this.props.debug}}t.DropdownDatePicker=DropdownDatePicker,"object"==typeof window&&(window.DropdownDatePicker=DropdownDatePicker)},887:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Expand=void 0;const r=s(997),o=s(6822),i=s(4152);s(4429);class Expand extends o.ReactComponent{constructor(e){super(e),this.onTitleClick=e=>{console.debug("Expand.onTitleClick"),this.setState((e=>({opened:!e.opened})))},this.state={opened:void 0!==this.props.opened&&this.props.opened}}isOpened(){return this.state.opened}isHighlighted(){return!!this.props.highlighted}render(){return(0,r.jsxs)("div",Object.assign({className:`${this.getCssClassNames()} ${this.isOpened()?"opened":""} ${this.isHighlighted()?"highlighted":""}`},{children:[(0,r.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__header`,onClick:this.onTitleClick},{children:[(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__icon`},{children:(0,r.jsx)(i.DownIcon,{})})),(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__title`},{children:this.props.title}))]})),(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__content`},{children:this.props.children}))]}))}}t.Expand=Expand,"object"==typeof window&&(window.Expand=Expand)},164:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Grid=void 0;const a=s(997),n=i(s(6689)),l=s(6822),c=s(6920),d=s(5904),u=s(4881);s(1001);class Grid extends l.ReactComponent{constructor(e){super(e),this.onCellMouseDown=async e=>{if(console.debug("Grid.onCellMouseDown",this.isLink()),e.preventDefault(),this.isDisabled())return;this.getElement().focus();const t=e.button,[s,r]=JSON.parse(e.currentTarget.dataset.rc),o=this.props.rows[s],i=e.currentTarget.dataset.row;await this.selectCell(i,r),0===t&&this.props.onClick&&this.props.onClick(o,i)},this.onRowMouseDown=async e=>{console.debug("Grid.onRowMouseDown",this.isLink());const t=e.currentTarget.dataset.row;await this.selectRow(t)},this.onCellDoubleClick=async e=>{const t=e.button,[s,r]=JSON.parse(e.currentTarget.dataset.rc),o=this.props.rows[s],i=e.currentTarget.dataset.row;0===t&&this.props.onDoubleClick&&await this.props.onDoubleClick(o,i)},this.onRowDoubleClick=async e=>{const t=parseInt(e.currentTarget.dataset.r),s=this.props.rows[t],r=e.currentTarget.dataset.row;this.props.onDoubleClick&&await this.props.onDoubleClick(s,r)},this.onKeyDown=async e=>{if(!this.isDisabled())switch(e.keyCode){case 37:e.preventDefault(),await this.onLeft();break;case 38:e.preventDefault(),await this.onUp();break;case 39:e.preventDefault(),await this.onRight();break;case 40:e.preventDefault(),await this.onDown();break;case 13:e.preventDefault(),await this.onEnter();break;case 46:e.preventDefault(),await this.onDelete();break;case 67:e.ctrlKey&&(e.preventDefault(),await this.onCopy())}},this.onResizeDoubleClick=async e=>{console.debug("Grid.onResizeDoubleClick",e.target);const t=parseInt(e.target.dataset.i),s=this.props.columns[t];this.state.columnWidth[s.name]!==this.getMaxColumnWidth(s)&&(this.state.columnWidth[s.name]=this.getMaxColumnWidth(s),this.state.resized=Date.now(),await this.rerender())},this.onCellViewCreate=e=>{const t=e.props.column.name;void 0===this.columns[t]&&(this.columns[t]=[]),this.columns[t].push(e)},this.onCellViewUnmount=e=>{const t=e.props.column.name,s=this.columns[t].indexOf(e);if(-1===s)throw new Error("cannot find FieldView in Grid.columns");this.columns[t].splice(s,1)},this.onBodyScroll=async e=>{this.head.current.scrollLeft=e.target.scrollLeft},this.onLinkClick=async e=>{console.debug("Grid.onLinkClick",e.ctrlKey),e.ctrlKey||e.preventDefault()},this.state={key:this.props.selectedKey||null,column:this.props.selectedKey&&this.props.columns&&this.props.columns.length?0:null,columnWidth:{},resized:Date.now()},this.columns={},this.el=n.createRef(),this.head=n.createRef()}getActiveColumn(){return this.state.column}setActiveColumn(e){this.state.column=e}getActiveRowKey(){return this.state.key}setActiveRowKey(e){this.state.key=e}isRowActive(e,t){return this.getActiveRowKey()===t}async onCopy(){console.debug("Grid.onCopy");const e=this.findRow(this.getActiveRowKey())[this.props.columns[this.getActiveColumn()].name];await c.Helper.copyTextToClipboard(e)}findRow(e){return this.props.rows.find((t=>this.getRowKey(t)===e))}async onLeft(){console.debug("Grid.onLeft");const e=this.getActiveColumn();e-1>=0&&(this.setActiveColumn(e-1),await this.rerender())}async onUp(){console.debug("Grid.onUp");const e=this.getActiveRowKey(),t=this.findRow(e),s=this.props.rows.indexOf(t);if(s-1>=0){const e=this.props.rows[s-1],t=this.getRowKey(e);this.setActiveRowKey(t),await this.rerender()}}async onRight(){console.debug("Grid.onRight");const e=this.getActiveColumn();e+1<=this.props.columns.length-1&&(this.setActiveColumn(e+1),await this.rerender())}async onDown(){console.debug("Grid.onDown");const e=this.getActiveRowKey(),t=this.findRow(e),s=this.props.rows.indexOf(t);if(s+1<=this.props.rows.length-1){const e=this.props.rows[s+1],t=this.getRowKey(e);this.setActiveRowKey(t),await this.rerender()}}async onEnter(){console.debug("Grid.onEnter");const e=this.getActiveRowKey(),t=this.findRow(e);this.props.onDoubleClick&&await this.props.onDoubleClick(t,e)}async onDelete(){console.debug("Grid.onDelete");const e=this.getActiveRowKey(),t=this.findRow(e);this.props.onDeleteKeyDown&&await this.props.onDeleteKeyDown(t,e)}async selectCell(e,t){this.getActiveRowKey()===e&&this.getActiveColumn()===t||(this.setActiveRowKey(e),this.setActiveColumn(t),this.props.onSelectionChange?await this.props.onSelectionChange(e):await this.rerender())}async selectRow(e){this.getActiveRowKey()!==e&&(this.setActiveRowKey(e),this.props.onSelectionChange?await this.props.onSelectionChange(e):await this.rerender())}getMaxColumnWidth(e){return Math.max(...this.columns[e.name].map((e=>e.getSpanOffsetWidth())))+10+2}getColumnWidth(e){const t=this.props.columns[e];return void 0!==this.state.columnWidth[t.name]?this.state.columnWidth[t.name]:t.width}renderColumns(){return this.props.columns.map(((e,t)=>(0,a.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__th`,style:{width:this.getColumnWidth(t)}},{children:[(0,a.jsx)("div",Object.assign({className:"ellipsis",style:{textAlign:e.align}},{children:e.title||e.name})),(0,a.jsx)("span",{className:"Grid__resize","data-i":t,onDoubleClick:this.onResizeDoubleClick})]}),e.name)))}renderRows(){return this.props.rows.map(((e,t)=>{const s=this.getRowKey(e);return(0,a.jsx)(d.GridRow,{rowKey:s,grid:this,row:e,i:t,active:this.isRowActive(t,s),activeColumn:this.getActiveColumn(),updated:this.props.updated,resized:this.state.resized},s)}))}getRowKey(e){return this.props.getRowKey?this.props.getRowKey(e):this.props.rows.indexOf(e).toString()}renderCell(e,t){let s;return this.props.renderGridCellView&&(s=this.props.renderGridCellView(e,t,this.onCellViewCreate,this.onCellViewUnmount)),s||(0,a.jsx)(u.GridCell,{grid:this,row:e,column:t,onCreate:this.onCellViewCreate,onUnmount:this.onCellViewUnmount})}shouldComponentUpdate(e,t){return!this.props.updated||!!(e.updated-this.props.updated)}render(){return(0,a.jsxs)("div",Object.assign({className:`${this.getCssClassNames()} ${this.isDisabled()?"disabled":""}`,ref:this.el,tabIndex:0,onKeyDown:this.onKeyDown},{children:[(0,a.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__head`,ref:this.head},{children:(0,a.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__table`},{children:(0,a.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__tr`},{children:[this.props.columns&&this.renderColumns(),!!this.props.extraColumn&&(0,a.jsx)("div",{className:`${this.getCssBlockName()}__th`})]}))}))})),(0,a.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__body`,onScroll:this.onBodyScroll},{children:(0,a.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__table`},{children:this.props.rows&&this.renderRows()}))}))]}))}isLink(){return!!this.props.createLinkCallback}}t.Grid=Grid,"object"==typeof window&&(window.Grid=Grid)},4881:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.GridCell=void 0;const a=s(997),n=i(s(6689)),l=s(6822),c=s(6920);s(2770);class GridCell extends l.ReactComponent{constructor(e){super(e),this.span=n.createRef()}getSpanOffsetWidth(){return this.span.current?this.span.current.offsetWidth:0}renderCellValue(e){const t=this.props.grid.props.decodeValue?c.Helper.decodeValue(e):e;return"boolean"==typeof t?t.toString():t}render(){const e=this.props.row,t=this.props.column;return(0,a.jsx)("div",Object.assign({className:`${this.getCssClassNames()} ellipsis`},{children:(0,a.jsx)("span",Object.assign({ref:this.span},{children:this.renderCellValue(e[t.name])}))}))}}t.GridCell=GridCell,"object"==typeof window&&(window.GridCell=GridCell)},5904:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridRow=void 0;const r=s(997),o=s(6822);class GridRow extends o.ReactComponent{isCellActive(e){return this.props.active&&this.props.activeColumn===e}shouldComponentUpdate(e,t){return!this.props.updated||(!!(e.updated-this.props.updated)||(!!(e.resized-this.props.resized)||(this.props.active!==e.active||!(!this.props.active||this.props.activeColumn===e.activeColumn))))}render(){const e=this.props.grid,t=this.props.row,s=this.props.i,o=this.props.rowKey,i=e.props.createLinkCallback?e.props.createLinkCallback(o):null;return(0,r.jsxs)("a",Object.assign({className:`${e.getCssBlockName()}__tr ${this.props.active?"active":""}`,"data-key":o,href:i,onClick:e.onLinkClick},{children:[e.props.columns.map(((i,a)=>(0,r.jsx)("div",Object.assign({className:`${e.getCssBlockName()}__td ${this.isCellActive(a)?"active":""}`,style:{width:e.getColumnWidth(a)},"data-rc":`[${s},${a}]`,"data-row":o,onMouseDown:e.onCellMouseDown,onDoubleClick:e.onCellDoubleClick},{children:e.renderCell(t,i)}),i.name))),!!e.props.extraColumn&&(0,r.jsx)("div",{className:`${e.getCssBlockName()}__td`,"data-r":s,"data-row":o,onMouseDown:e.onRowMouseDown,onDoubleClick:e.onRowDoubleClick})]}))}}t.GridRow=GridRow,"object"==typeof window&&(window.GridRow=GridRow)},4587:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Image=void 0;const o=s(997),i=r(s(6689)),a=s(6822);s(4820);class Image extends a.ReactComponent{constructor(e){super(e),this.onImgClick=async e=>{if(console.debug("Image.onImgClick"),this.props.onClick)return await this.props.onClick();this.setState((e=>e.classList?{classList:null}:{classList:["Image_full"]}))},this.img=i.default.createRef(),this.state={classList:null}}getNaturalSize(){return[this.img.current.naturalWidth,this.img.current.naturalHeight]}render(){return(0,o.jsx)("img",{className:this.getCssClassNames(),ref:this.img,src:this.props.src,onClick:this.onImgClick})}}t.Image=Image,"object"==typeof window&&(window.Image=Image)},5283:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Menu=void 0;const r=s(997),o=s(6822);s(6312);class Menu extends o.ReactComponent{constructor(e){super(e),this.onMenuClick=async e=>{await this.toggleMenu(e.currentTarget.dataset.menu)},this.onBlur=async e=>{await this.closeMenu(e.currentTarget.dataset.menu)},this.onMouseDown=e=>{e.preventDefault()},this.onMenuItemClick=async e=>{e.persist();const{menu:t,type:s,name:r}=e.target.dataset;await this.closeMenu(t),this.props.onClick&&this.props.onClick(t,s,r)},this.state={}}toggleMenu(e){return new Promise((t=>{this.setState((t=>({[e]:!t[e]})),t)}))}closeMenu(e){return new Promise((t=>this.setState({[e]:!1},t)))}render(){return(0,r.jsx)("div",Object.assign({className:"Menu"},{children:this.props.items&&this.props.items.map((e=>(0,r.jsxs)("div",Object.assign({className:this.state[e.name]?"active":void 0},{children:[(0,r.jsx)("button",Object.assign({"data-menu":e.name,onClick:this.onMenuClick,onBlur:this.onBlur},{children:e.title})),(0,r.jsx)("div",Object.assign({onMouseDown:this.onMouseDown,onClick:this.onMenuItemClick},{children:e.items.map((t=>(0,r.jsx)("a",Object.assign({"data-menu":e.name,"data-type":t.type,"data-name":t.name},{children:t.title}),t.name)))}))]}),e.name)))}))}}t.Menu=Menu,"object"==typeof window&&(window.Menu=Menu)},6546:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0;const r=s(997),o=s(6822);s(3767);class Modal extends o.ReactComponent{render(){return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames()},{children:(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__container`},{children:this.props.children}))}))}}t.Modal=Modal,"object"==typeof window&&(window.Modal=Modal)},4683:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Password=void 0;const a=s(997),n=i(s(6689)),l=s(6822),c=s(24),d=s(4882),u=s(5994);s(1118);class Password extends l.ReactComponent{constructor(e){super(e),this.onChange=e=>{this._setValue(e.target.value)},this.onCloseClick=e=>{this._setValue(""),this.getInputElement().focus()},this.onIconClick=e=>{this.setState((e=>({type:"password"===e.type?"text":"password"}))),this.getInputElement().focus()},this.el=n.createRef(),this.inputEl=n.createRef(),this.state={value:this.props.value||"",type:"password"}}getInputElement(){return this.inputEl.current}getValue(){return this.state.value}_setValue(e){this.state.value=e,this.forceUpdate(),this.props.onChange&&this.props.onChange(e)}shouldComponentUpdate(e,t){return this.state.value=e.value,!0}isCloseVisible(){return""!==this.state.value}render(){return(0,a.jsxs)("div",Object.assign({ref:this.el,className:this.getCssClassNames()},{children:[(0,a.jsx)("input",{ref:this.inputEl,className:`${this.getCssBlockName()}__input`,type:this.state.type,id:this.props.id,name:this.props.name,readOnly:this.props.readOnly,disabled:this.props.disabled,placeholder:this.props.placeholder,autoFocus:this.props.autoFocus,spellCheck:this.props.spellCheck,autoComplete:this.props.autocomplete,value:this.state.value,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onChange:this.onChange}),(0,a.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close ${this.isCloseVisible()?"visible":""}`,onClick:this.onCloseClick},{children:(0,a.jsx)(c.CloseIcon,{})})),(0,a.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__icon`,onClick:this.onIconClick},{children:"password"===this.state.type?(0,a.jsx)(d.VisibilityIcon,{}):(0,a.jsx)(u.VisibilityOffIcon,{})}))]}))}}t.Password=Password,"object"==typeof window&&(window.Password=Password)},749:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneBox=void 0;const o=s(997),i=r(s(6689)),a=s(6822);class PhoneBox extends a.ReactComponent{constructor(e){super(e),this.onKeyPress=e=>{["+","0","1","2","3","4","5","6","7","8","9"].includes(e.key)||e.preventDefault(),"+"===e.key&&e.target.value.length&&Math.abs(e.target.selectionEnd-e.target.selectionStart)!==e.target.value.length&&e.preventDefault()},this.onChange=e=>{const t=e.target.selectionStart,s=e.target.selectionEnd,r=e.target.value.length;if(t!==s||t!==r)return;let o=PhoneBox.clearValue(e.target.value);o=PhoneBox.ifNoCodeAddRussianCode(o),this.state.value=PhoneBox.formatPhoneNumber(o),this.setState({value:this.state.value}),this.props.onChange&&this.props.onChange(o)},this.onBlur=e=>{let t=PhoneBox.clearValue(e.target.value);t=PhoneBox.ifNoCodeAddRussianCode(t),this.props.onBlur&&this.props.onBlur(t)},this.el=i.default.createRef(),this.state={value:PhoneBox.formatPhoneNumber(this.props.value||"")}}getValue(){return PhoneBox.clearValue(this.state.value)}shouldComponentUpdate(e,t){return void 0!==e.value&&(this.state.value=PhoneBox.formatPhoneNumber(e.value)),!0}render(){return(0,o.jsx)("input",{ref:this.el,className:this.getCssClassNames(),type:"text",id:this.props.id,name:this.props.name,readOnly:this.props.readOnly,disabled:this.props.disabled,placeholder:this.props.placeholder,autoFocus:this.props.autoFocus,spellCheck:this.props.spellCheck,autoComplete:this.props.autocomplete,value:this.state.value,onFocus:this.props.onFocus,onChange:this.onChange,onBlur:this.onBlur,onKeyPress:this.onKeyPress})}static clearValue(e){return e.replace(/[^\+0-9]/g,"")}static ifNoCodeAddRussianCode(e){if(""===e);else{if(e.match(/^8/))return e.replace(/^8/,"+7");if(e.match(/^7/))return`+${e}`;if("+"!==e[0])return`+7${e}`}return e}static formatPhoneNumber(e){const t=PhoneBox.clearValue(e),s=/(^\+7)(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/.exec(t);if(s){if(s[5])return`${s[1]} ${s[2]} ${s[3]}-${s[4]}-${s[5]}`;if(s[4])return`${s[1]} ${s[2]} ${s[3]}-${s[4]}`;if(s[3])return`${s[1]} ${s[2]} ${s[3]}`;if(s[2])return`${s[1]} ${s[2]}`;if(s[1])return`${s[1]}`}return t}}t.PhoneBox=PhoneBox,"object"==typeof window&&(window.PhoneBox=PhoneBox)},8517:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Radio=void 0;const r=s(997),o=s(6822);class Radio extends o.ReactComponent{constructor(e){if(super(e),this.onChange=async e=>{this.setState({value:e.target.value}),this.props.onChange&&await this.props.onChange(e.target.value)},!e.name)throw new Error("no name");this.state={value:this.getInitialValue()},console.debug("value:",JSON.stringify(this.getValue()))}getInitialValue(){let e=null;if(void 0!==this.props.value&&null!==this.props.value){e=this.props.value;this.props.items.find((e=>e.value===this.props.value))||(console.error("Radio: no item for value:",JSON.stringify(this.props.value)),console.debug("items:",this.props.items))}return e}getValue(){return this.state.value}renderItem(e,t){return[(0,r.jsx)("input",{type:"radio",name:this.props.name,id:`${this.props.name}${t}`,value:e.value,onChange:this.onChange,checked:e.value===this.getValue(),readOnly:this.isReadOnly(),disabled:this.isReadOnly()}),(0,r.jsx)("label",Object.assign({htmlFor:`${this.props.name}${t}`},{children:e.title||e.value}))]}isReadOnly(){return void 0!==this.props.readOnly&&this.props.readOnly}shouldComponentUpdate(e,t){return this.state.value=e.value,!0}render(){const e=this.props.items||[];return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames()},{children:e.map(((e,t)=>this.renderItem(e,t)))}))}}t.Radio=Radio},1658:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Select=void 0;const o=s(997),i=r(s(6689)),a=s(6822),n=s(24),l=s(9490);s(3078);class Select extends a.ReactComponent{constructor(e){super(e),this.onKeyDown=async e=>{this.isVisible()&&(this.setState({visible:!1}),e.stopPropagation())},this.onInputMouseDown=async e=>{if(console.debug("Select.onInputMouseDown"),!this.props.readOnly)if(this.props.onMouseDown)await this.props.onMouseDown(e);else{if(!this.isVisible()){const[e]=this.el.current.querySelectorAll("li.selected");if(e){const t=e.offsetTop-this.dropdown.current.getBoundingClientRect().height/2+e.getBoundingClientRect().height/2;console.debug("scrollTop:",t),this.dropdown.current.scrollTop=t,console.debug("this.dropdown.current.scrollTop",this.dropdown.current.scrollTop)}}this.setState((e=>({visible:!e.visible})))}},this.onInputBlur=async e=>{console.debug("Select.onInputBlur",e.target),this.setState({visible:!1})},this.onDropdownMouseDown=async e=>{e.preventDefault()},this.onDropdownClick=async e=>{console.debug("Select.onDropdownClick",e.target.offsetTop);const t=JSON.parse(e.target.dataset.value);this.setState({value:t,visible:!1},(async()=>{this.props.onChange&&await this.props.onChange(t.toString())}))},this.onCloseClick=async e=>{this.setState({value:""}),this.props.onChange&&await this.props.onChange(""),this.getElement()},this.el=i.default.createRef(),this.dropdown=i.default.createRef(),this.state={value:this.getInitialValue(),visible:!1}}isVisible(){return this.state.visible}getInitialValue(){let e=null;if(void 0!==this.props.value&&null!==this.props.value){e=this.props.value;this.getItems().find((e=>e.value===this.props.value))||this.isNullable()&&""===e||(console.error("Select: no item for value:",JSON.stringify(this.props.value)),console.debug("items:",this.getItems()))}else e=this.isNullable()?"":this.props.items.length?this.props.items[0].value:"";if(null===e)throw new Error("null is wrong value for Select");return e}getValue(){return this.state.value}isNullable(){return void 0===this.props.nullable||this.props.nullable}getVisibility(){return this.isVisible()?"visible":"hidden"}getDisplay(){return this.isVisible()?"block":"none"}getItems(){return this.props.items||[]}getValueTitle(e){if(""===e)return"";const t=this.getItems().find((t=>t.value===e));if(!t)throw new Error(`cannot find item by value: ${e}`);return t.title||t.value}shouldComponentUpdate(e,t){return this.state.value=e.value,!0}isCloseVisible(){return!this.props.readOnly&&""!==this.state.value}renderInput(){return(0,o.jsx)("input",{className:`${this.getCssBlockName()}__input`,readOnly:!0,disabled:this.props.readOnly,placeholder:this.props.placeholder,onBlur:this.onInputBlur,value:this.getValueTitle(this.getValue()),onMouseDown:this.onInputMouseDown,onKeyDown:this.onKeyDown})}renderClose(){return(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close ${this.isCloseVisible()?"visible":""}`,onClick:this.onCloseClick},{children:(0,o.jsx)(n.CloseIcon,{})}))}renderIcon(){return(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__icon ${this.isVisible()?"up":""}`},{children:(0,o.jsx)(l.ArrowIcon,{})}))}renderDropdown(){return(0,o.jsxs)("ul",Object.assign({ref:this.dropdown,className:`${this.getCssBlockName()}__dropdown`,style:{display:this.getDisplay()},onMouseDown:this.onDropdownMouseDown,onClick:this.onDropdownClick},{children:[this.isNullable()&&(0,o.jsx)("li",Object.assign({className:`${this.getCssBlockName()}__item`,"data-value":'""'},{children:""})),this.getItems().map((e=>(0,o.jsx)("li",Object.assign({className:`${this.getCssBlockName()}__item ellipsis ${this.getValue()===e.value?"selected":""}`,"data-value":JSON.stringify(e.value)},{children:e.title||e.value}),e.value)))]}))}render(){return(0,o.jsxs)("div",Object.assign({ref:this.el,className:this.getCssClassNames()},{children:[this.renderInput(),this.isNullable()&&this.renderClose(),this.renderIcon(),this.renderDropdown()]}))}}t.Select=Select,"object"==typeof window&&(window.Select=Select)},8481:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Slider=void 0;const r=s(997),o=s(6822),i=s(8261),a=s(9752),n=s(7649);s(7333);class Slider extends o.ReactComponent{constructor(e){if(super(e),this.onPrevClick=e=>{this.setState((e=>{let t=e.image-1;return t<0&&(t=this.props.images.length-1),{image:t}}))},this.onNextClick=e=>{this.setState((e=>{let t=e.image+1;return t>this.props.images.length-1&&(t=0),{image:t}}))},this.onImageClick=e=>{console.debug("Slider.onImageClick"),this.state.classList?this.setState({classList:null}):this.setState({classList:["full"]})},this.onCloseClick=e=>{this.setState({classList:null})},!this.props.images)throw new Error("Slider: no images");this.state={image:0,classList:null}}render(){const e=this.props.images||[];return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[(0,r.jsx)("img",{className:"Slider_image",src:e[this.state.image],onClick:this.onImageClick}),e.length>1&&(0,r.jsxs)("div",Object.assign({className:"Slider__label"},{children:[e.length>0?this.state.image+1:0," / ",e.length]})),e.length>1&&(0,r.jsx)("div",Object.assign({className:"Slider__arrow left",onClick:this.onPrevClick},{children:(0,r.jsx)(i.LeftIcon,{})})),e.length>1&&(0,r.jsx)("div",Object.assign({className:"Slider__arrow right",onClick:this.onNextClick},{children:(0,r.jsx)(a.RightIcon,{})})),(0,r.jsx)("div",Object.assign({className:"Slider__close",onClick:this.onCloseClick},{children:(0,r.jsx)(n.CloseIcon2,{})}))]}))}}t.Slider=Slider,"object"==typeof window&&(window.Slider=Slider)},8931:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Statusbar=void 0;const r=s(997),o=s(6822);s(4533);class Statusbar extends o.ReactComponent{constructor(e){super(e),this.state={}}setLastQueryTime(e){this.setState({lastQueryTime:e})}render(){return(0,r.jsx)("div",Object.assign({className:"Statusbar"},{children:(0,r.jsxs)("div",{children:["Last query time:"," ",this.state.lastQueryTime?`${this.state.lastQueryTime} ms`:"-"]})}))}}t.Statusbar=Statusbar,"object"==typeof window&&(window.Statusbar=Statusbar)},802:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tab=void 0;const r=s(997),o=s(6822);s(2201);class Tab extends o.ReactComponent{constructor(e){super(e),this.onLiMouseDown=e=>{if(e.target.classList.contains("close"))return;const t=parseInt(e.currentTarget.dataset.i);this.props.getActive?this.props.onTabMouseDown&&this.props.onTabMouseDown(t):t!==this.getActive()&&this.selectTab(t)},this.onLiClick=e=>{if(e.target.classList.contains("close")){const t=parseInt(e.currentTarget.dataset.i);this.props.onTabClose&&this.props.onTabClose(t)}},this.state={active:0}}getActive(){return this.props.getActive?this.props.getActive():this.state.active}selectTab(e){if(e===this.getActive())return;const t=Date.now();this.setState({active:e},(()=>console.debug("selectTab time:",Date.now()-t)))}renderTitles(){return this.props.tabs.map(((e,t)=>(0,r.jsxs)("li",Object.assign({className:t===this.getActive()?"active":void 0,onMouseDown:this.onLiMouseDown,onClick:this.onLiClick,"data-i":t},{children:[(0,r.jsx)("span",{children:e.title}),this.props.canClose&&(0,r.jsx)("span",Object.assign({className:"close"},{children:""}))]}),e.name)))}renderContents(){return this.props.tabs.map(((e,t)=>(0,r.jsx)("div",Object.assign({className:t===this.getActive()?"active":void 0},{children:e.content}),e.name)))}render(){return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[(0,r.jsx)("ul",{children:this.props.tabs&&this.renderTitles()}),(0,r.jsx)("div",{children:this.props.tabs&&this.renderContents()})]}))}}t.Tab=Tab,"object"==typeof window&&(window.Tab=Tab)},9193:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tab2=void 0;const r=s(997),o=s(6822);s(9606);class Tab2 extends o.ReactComponent{constructor(e){super(e),this.onLiMouseDown=e=>{if(e.target.classList.contains("close"))return;const t=parseInt(e.currentTarget.dataset.i);this.props.getActive?this.props.onTabMouseDown&&this.props.onTabMouseDown(t):t!==this.getActive()&&this.selectTab(t)},this.onLiClick=e=>{if(e.target.classList.contains("close")){const t=parseInt(e.currentTarget.dataset.i);this.props.onTabClose&&this.props.onTabClose(t)}},this.state={active:0}}getActive(){return this.props.getActive?this.props.getActive():this.state.active}selectTab(e){if(e===this.getActive())return;const t=Date.now();this.setState({active:e},(()=>console.debug("selectTab time:",Date.now()-t)))}renderTitles(){return this.props.tabs.map(((e,t)=>(0,r.jsxs)("li",Object.assign({className:`${this.getCssBlockName()}__button ${t===this.getActive()?"active":""}`,onMouseDown:this.onLiMouseDown,onClick:this.onLiClick,"data-i":t},{children:[(0,r.jsx)("span",{children:e.title}),this.props.canClose&&(0,r.jsx)("span",Object.assign({className:"close"},{children:""}))]}),e.name)))}renderContents(){return this.props.tabs.map(((e,t)=>(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__page full ${t===this.getActive()?"active":""}`},{children:e.content}),e.name)))}render(){return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[(0,r.jsx)("ul",Object.assign({className:`${this.getCssBlockName()}__buttons`},{children:this.props.tabs&&this.renderTitles()})),(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__pages`},{children:this.props.tabs&&this.renderContents()}))]}))}}t.Tab2=Tab2,"object"==typeof window&&(window.Tab2=Tab2)},3198:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextArea=void 0;const r=s(997),o=s(6822);class TextArea extends o.ReactComponent{constructor(e){super(e),this.onChange=e=>{this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e.target.value)},this.state={value:this.props.value||""}}getValue(){return this.state.value}shouldComponentUpdate(e,t){return this.state.value=e.value,!0}render(){return(0,r.jsx)("textarea",{className:this.getCssClassNames(),readOnly:this.props.readOnly,disabled:this.props.disabled,placeholder:this.props.placeholder,rows:this.props.rows,cols:this.props.cols,value:this.state.value,onChange:this.onChange,onFocus:this.props.onFocus,onBlur:this.props.onBlur})}}t.TextArea=TextArea,"object"==typeof window&&(window.TextArea=TextArea)},9677:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBox=void 0;const r=s(997),o=s(6689),i=s(6822);class TextBox extends i.ReactComponent{constructor(e){super(e),this.onChange=e=>{this._setValue(e.target.value)},this.el=(0,o.createRef)(),this.state={value:this.props.value||""}}getValue(){return this.state.value}_setValue(e){this.state.value=e,this.forceUpdate(),this.props.onChange&&this.props.onChange(e)}shouldComponentUpdate(e,t){return this.state.value=e.value,!0}render(){return(0,r.jsx)("input",{ref:this.el,className:this.getCssClassNames(),type:this.props.type||"text",id:this.props.id,name:this.props.name,readOnly:this.props.readOnly,disabled:this.isDisabled(),placeholder:this.props.placeholder,autoFocus:this.props.autoFocus,spellCheck:this.props.spellCheck,autoComplete:this.props.autocomplete,required:this.props.required,value:this.state.value,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onChange:this.onChange})}}t.TextBox=TextBox,"object"==typeof window&&(window.TextBox=TextBox)},2086:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBox=void 0;const o=s(997),i=r(s(6689)),a=s(6822);class TimeBox extends a.ReactComponent{constructor(e){if(super(e),this.onKeyPress=e=>{["0","1","2","3","4","5","6","7","8","9"].includes(e.key)||(console.debug("cancel",e.key),e.preventDefault())},this.onChange=e=>{const t=e.target,s=t.selectionStart,r=t.selectionEnd;if(t.value.length>5)return;const o=s===r&&s===t.value.length,i=this.formatValue(t.value);this.setState({value:i},(()=>{if(o||(t.selectionStart=s,t.selectionEnd=r),this.props.onChange){let e;try{e=this.getValue()}catch(t){console.debug(t.message),e=NaN}this.props.onChange(e)}}))},this.onBlur=e=>{if(this.props.onBlur){let e;try{e=this.getValue()}catch(t){console.debug(t.message),e=NaN}this.props.onBlur(e)}},e.value&&"number"!=typeof e.value)throw new Error("need number type, got "+typeof e.value);this.state={value:TimeBox.getStringValue(e.value)},this.el=i.default.createRef()}formatValue(e){let t="",s="";const r=e.replace(":","");switch(r.length){case 0:break;case 1:case 2:t=r;break;case 3:t=r.substr(0,2),s=r.substr(2,1);break;case 4:t=r.substr(0,2),s=r.substr(2,2)}return[t,...s?[s]:[]].join(":")}getValue(){return TimeBox.getIntegerValue(this.state.value)}setValue(e){this.setState({value:TimeBox.getStringValue(e)})}static getStringValue(e){if(null===e)return"";if(void 0!==e){let t=Math.floor(e/60),s=Math.floor(e-60*t);return t<10&&(t="0"+t),s<10&&(s="0"+s),`${t}:${s}`}return""}static getIntegerValue(e){if(""===e)return null;const t=e.split(":");if(!t[0])throw new Error(`no hours: ${e}`);if(!t[1])throw new Error(`no minutes: ${e}`);if(2!==t[0].length)throw new Error(`hours incomplete: ${e}`);if(2!==t[1].length)throw new Error(`minutes incomplete: ${e}`);const s=parseInt(t[0]),r=parseInt(t[1]);if(s>23)throw new Error(`hours out of range: ${r}, ${e}`);if(r>59)throw new Error(`minutes out of range: ${r}, ${e}`);return 60*s+r}static splitTime(e){const t=Math.floor(e/60);return[t,e-60*t]}shouldComponentUpdate(e,t){return this.props.value!==e.value?(this.state.value=TimeBox.getStringValue(e.value),!0):this.props.readOnly!==e.readOnly||(this.props.placeholder!==e.placeholder||this.state.value!==t.value)}render(){return(0,o.jsx)("input",{ref:this.el,className:this.getCssClassNames(),type:"text",id:this.props.id,readOnly:this.props.readOnly,placeholder:this.props.placeholder,value:this.state.value,onChange:this.onChange,onKeyPress:this.onKeyPress,onBlur:this.onBlur})}}t.TimeBox=TimeBox,"object"==typeof window&&(window.TimeBox=TimeBox)},2096:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBox2=void 0;const o=s(997),i=r(s(6689)),a=s(2086),n=s(24),l=s(6709);s(7951);class TimeBox2 extends a.TimeBox{constructor(e){super(e),this.onClear=e=>{this.setState({value:""},(()=>{this.props.onClear&&this.props.onClear()}))},this.inputEl=i.default.createRef()}isCloseVisible(){return!!this.state.value}getInputElement(){return this.inputEl.current}render(){return(0,o.jsxs)("div",Object.assign({ref:this.el,className:this.getCssClassNames()},{children:[(0,o.jsx)("input",{ref:this.inputEl,className:`${this.getCssBlockName()}__input`,type:"text",readOnly:this.props.readOnly,placeholder:this.props.placeholder,value:this.state.value,onChange:this.onChange,onKeyPress:this.onKeyPress,onBlur:this.onBlur}),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close-icon ${this.isCloseVisible()?"visible":""}`,onMouseDown:this.onClear},{children:(0,o.jsx)(n.CloseIcon,{})})),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__time-icon`},{children:(0,o.jsx)(l.TimeIcon,{})}))]}))}}t.TimeBox2=TimeBox2},3485:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tooltip=void 0;const r=s(997),o=s(6822);s(6029);class Tooltip extends o.ReactComponent{render(){return(0,r.jsxs)("div",Object.assign({className:`Tooltip ${this.props.type} ${this.props.hidden?"hidden":""}`},{children:["alert"!==this.props.type&&(0,r.jsx)("div",{children:"tooltip"}),(0,r.jsx)("span",Object.assign({className:this.props.position},{children:this.props.tip||"tip"}))]}))}}t.Tooltip=Tooltip,"object"==typeof window&&(window.Tooltip=Tooltip)},1123:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(4051),t),o(s(3544),t),o(s(1735),t),o(s(50),t),o(s(802),t),o(s(7592),t),o(s(9677),t),o(s(164),t),o(s(5904),t),o(s(4881),t),o(s(6546),t),o(s(4683),t),o(s(5283),t),o(s(8931),t),o(s(3485),t),o(s(305),t),o(s(6868),t),o(s(1658),t),o(s(3198),t),o(s(9193),t),o(s(2086),t),o(s(749),t),o(s(2096),t),o(s(4587),t),o(s(584),t),o(s(8481),t),o(s(887),t),o(s(8517),t)},2851:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(7534),t),o(s(9249),t)},2599:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AlertController=void 0;const r=s(1623),o=s(9335);class AlertController extends r.Controller{constructor(e){if(super(),this.onOkButtonClick=async e=>{this.close()},this.onCloseClick=async e=>{this.close()},this.onKeyDown=async e=>{"Escape"===e.key&&this.close()},this.options=e,!e.message)throw new Error("no message");if(!e.onClose)throw new Error("no onClose")}getViewClass(){return o.AlertView}close(){this.options.onClose()}}t.AlertController=AlertController},9335:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AlertView=void 0;const o=s(997),i=r(s(6689)),a=s(2805),n=s(7534);s(9708);class AlertView extends a.View{constructor(e){super(e),this.el=i.default.createRef()}getHeaderStyle(){return this.getCtrl().options.titleStyle}render(){return(0,o.jsx)("div",Object.assign({className:this.getCssClassNames(),ref:this.el,tabIndex:0,onKeyDown:this.getCtrl().onKeyDown},{children:(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__container`},{children:(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__content flex-column`},{children:[(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__header`},{children:[(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__title`,style:this.getHeaderStyle()},{children:this.getCtrl().options.title||"Alert"})),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close`,onClick:this.getCtrl().onCloseClick},{children:(0,o.jsx)(n.CloseIcon2,{})}))]})),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__main flex-max`},{children:this.getCtrl().options.message})),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__footer`},{children:(0,o.jsx)(n.Button,{classList:[`${this.getCssBlockName()}__ok-button`],title:"OK",onClick:this.getCtrl().onOkButtonClick})}))]}))}))}))}componentDidMount(){this.getElement().focus()}}t.AlertView=AlertView},7066:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmController=void 0;const r=s(1623),o=s(7462);class ConfirmController extends r.Controller{constructor(e){if(super(),this.onYesClick=e=>{this.close(!0)},this.onCloseClick=e=>{this.close(!1)},this.onKeyDown=async e=>{"Escape"===e.key&&this.close(!1)},this.options=e,!e.message)throw new Error("no message");if(!e.onClose)throw new Error("no onClose")}getViewClass(){return o.ConfirmView}close(e){this.options.onClose(e)}}t.ConfirmController=ConfirmController},7462:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmView=void 0;const o=s(997),i=r(s(6689)),a=s(2805),n=s(7534);s(1695);class ConfirmView extends a.View{constructor(e){super(e),this.el=i.default.createRef()}render(){if(!this.getCtrl().options.yesButton)throw new Error("no yesButton option");if(!this.getCtrl().options.noButton)throw new Error("no noButton option");return(0,o.jsx)("div",Object.assign({className:this.getCssClassNames(),ref:this.el,tabIndex:0,onKeyDown:this.getCtrl().onKeyDown},{children:(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__container`},{children:(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__content flex-column`},{children:[(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__header`},{children:[(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__title`,style:this.getCtrl().options.titleStyle},{children:this.getCtrl().options.title||"Confirm"})),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close`,onClick:this.getCtrl().onCloseClick},{children:(0,o.jsx)(n.CloseIcon2,{})}))]})),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__main flex-max`},{children:this.getCtrl().options.message})),(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__footer`},{children:[(0,o.jsx)(n.Button,{classList:[`${this.getCssBlockName()}__no-button`],title:this.getCtrl().options.noButton,onClick:this.getCtrl().onCloseClick}),(0,o.jsx)(n.Button,{classList:[`${this.getCssBlockName()}__yes-button`],title:this.getCtrl().options.yesButton,onClick:this.getCtrl().onYesClick})]}))]}))}))}))}componentDidMount(){this.getElement().focus()}}t.ConfirmView=ConfirmView},1623:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;const o=r(s(6689)),i=s(5982);class Controller extends i.EventEmitter{constructor(){super(...arguments),this.view=null,this.onViewCreate=e=>{this.view=e}}async rerender(){if(this.view)return await this.view.rerender();console.error(`${this.constructor.name}.rerender no view`)}getView(){if(!this.view)throw new Error("no view");return this.view}getViewClass(){throw new Error(`${this.constructor.name}.getViewClass not implemented`)}createElement(){return o.default.createElement(this.getViewClass(),{ctrl:this,onCreate:this.onViewCreate})}}t.Controller=Controller},1459:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginController=void 0;const r=s(1623),o=s(3809),i=s(7534);class LoginController extends r.Controller{constructor(e){super(),console.debug(`${this.constructor.name}.constructor`),this.frontHostApp=e}static create(e){const t=e.getData();if(!t.name)throw new Error("no app name");return new(i.Helper.getGlobalClass(`${t.name}LoginController`)||LoginController)(e)}getViewClass(){return o.LoginView}getText(){return this.frontHostApp.getText()}getFrontHostApp(){return this.frontHostApp}getViewClassCssBlockName(){return this.getViewClass().name}}t.LoginController=LoginController},3809:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LoginView=void 0;const o=s(997),i=r(s(6689)),a=s(2805),n=s(7534);s(8287);class LoginView extends a.View{constructor(e){super(e),this.onLoginFormSubmit=e=>{document.querySelector(".LoginView__button").disabled=!0},this.onChange=e=>{this.errMsgRef.current.innerHTML=""},this.errMsgRef=i.default.createRef()}renderLogo(){return null}renderTitle(){return this.getCtrl().getFrontHostApp().getData().title}render(){return(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__container`},{children:(0,o.jsxs)("form",Object.assign({className:`${this.getCssBlockName()}__form`,method:"post",onSubmit:this.onLoginFormSubmit},{children:[(0,o.jsx)("input",{type:"hidden",name:"tzOffset",value:JSON.stringify((new Date).getTimezoneOffset())}),(0,o.jsx)("input",{type:"hidden",name:"action",value:"login"}),(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__logo-title`},{children:[(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__logo`},{children:this.renderLogo()})),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__title`},{children:this.renderTitle()}))]})),(0,o.jsx)(n.TextBox,{classList:[`${this.getCssBlockName()}__field`],name:"username",placeholder:this.getCtrl().getText().login.username,required:!0,autoFocus:!0,spellCheck:!1,value:this.getCtrl().getFrontHostApp().getData().username||"",onChange:this.onChange}),(0,o.jsx)(n.Password,{classList:[`${this.getCssBlockName()}__field2`],name:"password",placeholder:this.getCtrl().getText().login.password,value:this.getCtrl().getFrontHostApp().getData().password||"",onChange:this.onChange}),(0,o.jsx)("p",Object.assign({className:`${this.getCssBlockName()}__err-msg`,ref:this.errMsgRef},{children:this.getCtrl().getFrontHostApp().getData().errMsg})),(0,o.jsx)("button",Object.assign({className:`${this.getCssBlockName()}__button`,type:"submit"},{children:this.getCtrl().getText().login.signIn}))]}))}))}}t.LoginView=LoginView},9780:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDialogController=void 0;const r=s(8345),o=s(5462);class ImageDialogController extends r.ModalController{constructor(e){if(super(e),this.onCloseClick=async e=>{await this.close()},this.onKeyDown=async e=>{"Escape"===e.key&&await this.close()},this.onImageClick=async e=>{console.debug("ImageDialogController.onImageClick"),await this.close()},!e.src)throw new Error("no src")}getViewClass(){return console.debug("ImageDialogController.getViewClass"),o.ImageDialogView}getSrc(){return this.options.src}}t.ImageDialogController=ImageDialogController},5462:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDialogView=void 0;const o=s(997),i=r(s(6689)),a=s(2805),n=s(7534);s(947);class ImageDialogView extends a.View{constructor(e){super(e),this.el=i.default.createRef()}render(){console.debug("ImageDialogView.render");const{ctrl:e}=this.props;return(0,o.jsxs)("div",Object.assign({className:this.getCssClassNames(),ref:this.el,tabIndex:0,onKeyDown:this.getCtrl().onKeyDown},{children:[(0,o.jsx)("img",{className:`${this.getCssBlockName()}__image`,src:e.getSrc(),onClick:e.onImageClick}),(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close`,onClick:e.onCloseClick},{children:(0,o.jsx)(n.CloseIcon2,{})}))]}))}componentDidMount(){this.getElement().focus()}}t.ImageDialogView=ImageDialogView},8345:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModalController=void 0;const r=s(1623);class ModalController extends r.Controller{constructor(e={}){if(super(),!e.app)throw new Error("no app");if(!e.id)throw new Error("no id");this.options=e}getId(){return this.options.id}getApp(){return this.options.app}async close(){await this.getApp().closeModal(this),this.options.onClose&&this.options.onClose()}}t.ModalController=ModalController},2686:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationController=void 0;const r=s(7111),o=s(5377),i=s(2783),a=s(3563),n=s(7534),l=s(9409);class ApplicationController extends r.ModelController{constructor(e,t){super(e),this.frontHostApp=t,this.lastId=0,this.activePage=null,this.modals=[],this.statusbar=null,this.homePageName=null,this.webSocketClient=null,this.onRequest=async e=>{console.debug("onRequest",e),this.statusbar&&this.statusbar.setLastQueryTime(e.time),this.getModel().getData().versions.app&&this.getModel().getData().versions.app!==e.remoteAppVersion&&this.createVersionNotificationIfNotExists()},this.onStatusbarCreate=e=>{this.statusbar=e},this.onLogout=async()=>{console.debug("ApplicationController.onLogout");await this.getModel().request("POST",{action:"logout"});location.href=this.getRootPath()},this.onMenuItemClick=async(e,t,s)=>{if(console.debug("ApplicationController.onMenuItemClick",e,t,s),"page"===t)await this.openPage({name:s,modal:!1}),history.pushState({pageName:s},"",this.getHostApp().createLink({page:s}));else if("action"===t)try{if(!await this.onActionClick(s))throw new Error(`no handler for action '${s}'`)}catch(e){console.error(e),await this.alert({message:e.message})}else{if("custom"!==t||"logout"!==s)throw new Error(`unknown menu type/name: ${t}/${s}`);await this.onLogout()}},"object"==typeof window&&console.debug(`${this.constructor.name}.constructor`,e)}static create(e,t){const{ctrlClass:s}=e.getData();if(s){const r=n.Helper.getGlobalClass(s);if(!r)throw new Error(`no class ${s}`);return new r(e,t)}return new ApplicationController(e,t)}init(){super.init(),this.getModel().on("request",this.onRequest);const e=this.getModel().getData().pages[0];this.activePage=e?this.createPage(e,{modal:!1,params:this.getGlobalParams()}):null;const t=this.getActivePageName();this.homePageName=t||this.frontHostApp.getDocumentTitle()}deinit(){this.getModel().off("request",this.onRequest),super.deinit()}getViewClass(){return super.getViewClass()||i.ApplicationView}createView(e){this.view=n.Helper.createReactComponent2(e,this.getViewClass(),{ctrl:this,key:this.getModel().getName()}),this.statusbar&&this.statusbar.setLastQueryTime(this.getModel().getAttr("time"))}createVersionNotificationIfNotExists(){if(!document.querySelector(".version-notification")){const e=document.createElement("div");e.innerHTML=this.getModel().getText().application.versionNotification,e.className="version-notification",document.querySelector(`.${this.getView().getCssBlockName()}__body`).append(e)}}getGlobalParams(){return{}}createPage(e,t){if(void 0===t.modal)throw new Error("no options.modal");const s=new o.Page(e,this.getModel(),t);s.init();const r=l.PageController.create(s,this,`c${this.getNextId()}`);return r.init(),r}async openPage(e){if(console.debug("ApplicationController.openPage",e),!e.name)throw new Error("no name");const t=this.findPageControllerByPageNameAndKey(e.name,null);if(t)return this.onPageSelect(t),t;const{page:s}=await this.getModel().request("POST",{action:"page",page:e.name,newMode:!!e.newMode,params:e.params||{}});if(void 0===e.modal&&(e.modal=!0),!e.onClose){const t=document.activeElement;e.onClose=()=>{t&&t.focus()}}const r=this.createPage(s,e);return r.isModal()?this.addModal(r):this.addPage(r),await this.rerender(),r}addModal(e){this.modals.push(e)}removeModal(e){const t=this.modals.indexOf(e);if(-1===t)throw new Error(`cannot find modal: ${e.getId()}`);this.modals.splice(t,1)}getNextId(){return this.lastId++,this.lastId}getNewId(){return`c${this.getNextId()}`}addPage(e){this.activePage&&this.closePage(this.activePage),this.activePage=e,this.frontHostApp.setDocumentTitle(this.getTitle())}findPageControllerByPageNameAndKey(e,t){return this.activePage&&this.activePage.getModel().getName()===e&&this.activePage.getModel().getKey()===t?this.activePage:null}onPageSelect(e){console.debug("ApplicationController.onPageSelect",e.getModel().getName())}async closePage(e){if(console.debug("ApplicationController.closePage",e.getModel().getFullName()),this.modals.indexOf(e)>-1)this.modals.splice(this.modals.indexOf(e),1);else{if(this.activePage!==e)throw new Error("page not found");this.activePage=null,document.title=""}await this.rerender(),e.deinit(),e.getModel().deinit()}async onActionClick(e){console.debug("ApplicationController.onActionClick",e)}getMenuItemsProp(){return[...this.getModel().getData().menu?Object.keys(this.getModel().getData().menu).map((e=>({name:e,title:e,items:this.getModel().getData().menu[e].map((e=>({type:e.type,name:e.page||e.action,title:e.caption})))}))):[],...this.getModel().getUser()?[{name:"user",title:`${this.getModel().getDomain()}/${this.getModel().getUser().login}`,items:[{type:"custom",name:"logout",title:"Logout"}]}]:[]]}getActivePageName(){return this.activePage?this.activePage.getModel().getName():null}async onWindowPopState(e){console.debug("ApplicationController.onWindowPopState",e.state),await this.openPage({name:e.state?e.state.pageName:this.homePageName,modal:!1})}getTitle(){return this.activePage?`${this.activePage.getTitle()} - ${this.getModel().getCaption()}`:this.getModel().getCaption()}invalidate(){this.activePage&&this.activePage.invalidate(),this.modals.filter((e=>e instanceof l.PageController)).forEach((e=>e.invalidate()))}async alert(e){e.title||(e.title=this.getModel().getText().application.alert);const t=document.activeElement;try{return await this.frontHostApp.alert(e)}finally{t&&t.focus()}}async confirm(e){e.title||(e.title=this.getModel().getText().application.confirm),e.yesButton||(e.yesButton=this.getModel().getText().confirm.yes),e.noButton||(e.noButton=this.getModel().getText().confirm.no);const t=document.activeElement;try{return await this.frontHostApp.confirm(e)}finally{t&&t.focus()}}getRootPath(){return"/"}async openModal(e){this.addModal(e),await this.rerender()}async closeModal(e){this.removeModal(e),await this.rerender()}getHostApp(){return this.frontHostApp}async connect(){const e=this.getModel().getData();this.webSocketClient=new a.WebSocketClient({applicationController:this,protocol:"https:"===window.location.protocol?"wss":"ws",route:e.route,uuid:e.uuid,userId:e.user?e.user.id:null}),await this.webSocketClient.connect()}async rpc(e,t={}){return await this.getModel().rpc(e,t)}getDomain(){return this.getModel().getDomain()}getBaseUrl(){return`/${this.getDomain()}`}}t.ApplicationController=ApplicationController,n.Helper.registerGlobalClass(ApplicationController)},2783:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationView=void 0;const o=s(997),i=r(s(6689)),a=s(4190),n=s(9409),l=s(7534),c=s(8978);s(1211);class ApplicationView extends a.ModelView{renderActivePage(){const{ctrl:e}=this.props;return e.activePage?this.renderView(e.activePage):null}renderView(e,t={}){return i.default.createElement(e.getViewClass(),Object.assign({parent:this,ctrl:e,onCreate:e.onViewCreate},t))}renderModals(){return this.getCtrl().modals.map((e=>e instanceof n.PageController?(0,o.jsx)(l.Modal,{children:this.renderView(e)},e.getId()):this.renderView(e,{key:e.getId()})))}renderHeader(){return(0,o.jsx)("header",Object.assign({className:`${this.getCssBlockName()}__header`},{children:(0,o.jsx)(l.Menu,{items:this.getCtrl().getMenuItemsProp(),onClick:this.getCtrl().onMenuItemClick})}))}renderMain(){return(0,o.jsx)("main",Object.assign({className:`${this.getCssBlockName()}__main`},{children:this.renderActivePage()}))}renderFooter(){return(0,o.jsx)("footer",Object.assign({className:`${this.getCssBlockName()}__footer`},{children:(0,o.jsx)(l.Statusbar,{onCreate:this.getCtrl().onStatusbarCreate})}))}render(){return(0,c.debug)(`${this.constructor.name}.render`,this.getCtrl().getModel().getFullName()),(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__container`,style:this.getStyle()},{children:[this.renderHeader(),this.renderMain(),this.renderFooter(),this.renderModals()]}))}}t.ApplicationView=ApplicationView},9534:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FieldController=void 0;const r=s(7111),o=s(6920);class FieldController extends r.ModelController{static create(e,t){const{ctrlClass:s}=e.getData();if(s){const r=o.Helper.getGlobalClass(s);if(!r)throw new Error(`no global class ${s}`);return new r(e,t)}const r=`${t.getModel().getClassName()}${e.getClassName()}Controller`,i=o.Helper.getGlobalClass(r);if(!i)throw new Error(`no global class ${r}`);return new i(e,t)}valueToString(e){switch(typeof e){case"string":return e;case"object":return null===e?"":e instanceof Date?e.toISOString():JSON.stringify(e,null,4);case"number":case"boolean":return e.toString();case"undefined":return"";default:throw new Error(`${this.getModel().getFullName()}: unknown value type: ${typeof e}, value: ${e}`)}}stringToValue(e){const t=this.getModel().getType();if(""===e.trim())return null;if("object"===t||"boolean"===t)return JSON.parse(e);if("date"===t){const t=new Date(e);if("Invalid Date"===t.toString())throw new Error(`${this.getApp().getModel().getText().error.invalidDate}: ${e}`);return t}if("number"===t){const t=Number(e);if(isNaN(t))throw new Error(this.getApp().getModel().getText().error.notNumber);return t}return e}getViewStyle(e){}async openPage(e){return await this.getParent().openPage(e)}getForm(){return this.getParent()}getPage(){return this.getParent().getParent()}getApp(){return this.getParent().getParent().getParent()}isVisible(){return"true"===this.getModel().getAttr("visible")}isAutoFocus(){return"true"===this.getModel().getAttr("autoFocus")}getAutocomplete(){return this.getModel().getAttr("autocomplete")||null}getFormat(){return this.getModel().getAttr("format")}}t.FieldController=FieldController},1624:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FieldView=void 0;const r=s(4190);class FieldView extends r.ModelView{getStyle(e){return this.getCtrl().getViewStyle(e)}}t.FieldView=FieldView},4547:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormCheckBoxFieldController=void 0;const r=s(5417),o=s(7899),i=s(6920);class RowFormCheckBoxFieldController extends r.RowFormFieldController{getViewClass(){return super.getViewClass()||o.RowFormCheckBoxFieldView}getValueForWidget(){return this.getValue()}setValueFromWidget(e){this.setValue(e)}}t.RowFormCheckBoxFieldController=RowFormCheckBoxFieldController,i.Helper.registerGlobalClass(RowFormCheckBoxFieldController)},7899:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormCheckBoxFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(4202);class RowFormCheckBoxFieldView extends o.RowFormFieldView{constructor(){super(...arguments),this.onCheckBoxChange=(e,t)=>{this.getCtrl().onChange(e)}}render(){const e=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames()},{children:(0,r.jsx)(i.CheckBox,{onCreate:this.onWidgetCreate,checked:e.getValueForWidget(),readOnly:!e.isEditable(),disabled:!e.isEditable(),onChange:this.onCheckBoxChange})}))}}t.RowFormCheckBoxFieldView=RowFormCheckBoxFieldView},5501:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormCheckBoxListFieldController=void 0;const r=s(5417),o=s(7789),i=s(6920);class RowFormCheckBoxListFieldController extends r.RowFormFieldController{constructor(){super(...arguments),this.onListInsert=async e=>{console.debug("RowFormCheckBoxListFieldController.onListInsert"),await this.rerender()},this.onListUpdate=async e=>{await this.rerender()},this.onListDelete=async e=>{await this.rerender()}}init(){super.init();const e=this.getModel().getDataSource();e.on("insert",this.onListInsert),e.on("update",this.onListUpdate),e.on("delete",this.onListDelete)}deinit(){const e=this.getModel().getDataSource();e.off("insert",this.onListInsert),e.off("update",this.onListUpdate),e.off("delete",this.onListDelete),super.deinit()}getViewClass(){return super.getViewClass()||o.RowFormCheckBoxListFieldView}getRows(){return this.getModel().getDataSource().getRows()}getValueForWidget(){return this.getValue()}setValueFromWidget(e){this.setValue(e)}getItemFromRow(e){return{value:this.valueToString(this.getModel().getValueValue(e)),title:this.getModel().getDisplayValue(e)}}}t.RowFormCheckBoxListFieldController=RowFormCheckBoxListFieldController,i.Helper.registerGlobalClass(RowFormCheckBoxListFieldController)},7789:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormCheckBoxListFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(6215);class RowFormCheckBoxListFieldView extends o.RowFormFieldView{getItems(){const e=this.getCtrl();try{return e.getRows().map((t=>e.getItemFromRow(t)))}catch(t){throw t.message=`${e.getModel().getFullName()}: ${t.message}`,t}}renderCheckBoxList(){const e=this.getCtrl();return(0,r.jsx)(i.CheckBoxList,{name:e.getModel().getFullName(),classList:[`${this.getCssBlockName()}__checkboxlist`],onCreate:this.onWidgetCreate,value:e.getValueForWidget(),readOnly:!e.isEditable(),onChange:e.onChange,items:this.getItems()})}render(){return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames()},{children:this.renderCheckBoxList()}))}}t.RowFormCheckBoxListFieldView=RowFormCheckBoxListFieldView},9952:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormComboBoxFieldController=void 0;const r=s(5417),o=s(9106),i=s(6920),a=s(2855);class RowFormComboBoxFieldController extends r.RowFormFieldController{constructor(){super(...arguments),this.onEditButtonClick=async e=>{console.debug("RowFormComboBoxFieldController.onEditButtonClick");const t=this.getModel().getAttr("itemEditPage"),s=this.getValue();t&&s&&await this.openPage({name:t,params:{key:s}})},this.onCreateButtonClick=async e=>{console.debug("RowFormComboBoxFieldController.onCreateButtonClick");const t=this.getModel().getAttr("newRowMode"),s=this.getModel().getAttr("itemCreateForm");if(!s)throw new Error("no itemCreateForm");let r;if("editPage"===t)r=this.getModel().getAttr("itemEditPage");else{if("createPage"!==t)throw new Error(`wrong newRowMode value: ${t}`);r=this.getModel().getAttr("itemCreatePage")}const o=(await this.openPage({name:r,newMode:!0})).getModel().getForm(s),a=async e=>{o.off("insert",a);const[t]=e.inserts,[s]=i.Helper.decodeValue(t);await this.onChange(s.toString())};o.on("insert",a)},this.onListInsert=async e=>{console.debug("RowFormComboBoxFieldController.onListInsert"),await this.rerender()},this.onListUpdate=async e=>{await this.rerender()},this.onListDelete=async e=>{await this.rerender()},this.onItemSelect=async e=>{if(0===e.button){e.preventDefault();const t=this.getValue(),s=t?(0,a.keyTupleToKey)([t]):void 0;await this.openPage({name:this.getModel().getAttr("itemSelectPage"),selectMode:!0,selectedKey:s,onSelect:async e=>{if(e){const[t]=(0,a.keyToKeyTuple)(e);this.getValue()!==t&&await this.getView().onChange(t.toString())}else null!==this.getValue()&&await this.getView().onChange("")}})}}}init(){super.init();const e=this.getModel().getComboBoxDataSource();e.on("insert",this.onListInsert),e.on("update",this.onListUpdate),e.on("delete",this.onListDelete)}deinit(){const e=this.getModel().getComboBoxDataSource();e.off("insert",this.onListInsert),e.off("update",this.onListUpdate),e.off("delete",this.onListDelete),super.deinit()}getViewClass(){return super.getViewClass()||o.RowFormComboBoxFieldView}getItems(){try{return this.getRows().map((e=>({value:this.valueToString(this.getModel().getValueValue(e)),title:this.getModel().getDisplayValue(e)})))}catch(e){throw e.message=`${this.getModel().getFullName()}: ${e.message}`,e}}getRows(){return this.getModel().getComboBoxDataSource().getRows()}getPlaceholder(){return this.getModel().getAttr("placeholder")?this.getModel().getAttr("placeholder"):this.getApp().getHostApp().isDebugMode()?"[null]":null}}t.RowFormComboBoxFieldController=RowFormComboBoxFieldController,i.Helper.registerGlobalClass(RowFormComboBoxFieldController)},9106:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormComboBoxFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(2433);class RowFormComboBoxFieldView extends o.RowFormFieldView{constructor(){super(...arguments),this.onChange=async e=>{this.rerender(),await this.getCtrl().onChange(e)}}isCreateButtonVisible(){return"edit"===this.getCtrl().getForm().getMode()&&("disabled"!==this.getCtrl().getModel().getAttr("newRowMode")&&("editPage"===this.getCtrl().getModel().getAttr("newRowMode")?!!this.getCtrl().getModel().getAttr("itemEditPage")&&!!this.getCtrl().getModel().getAttr("itemCreateForm"):"createPage"===this.getCtrl().getModel().getAttr("newRowMode")?!!this.getCtrl().getModel().getAttr("itemCreatePage")&&!!this.getCtrl().getModel().getAttr("itemCreateForm"):void 0))}renderSelect(){const e=this.getCtrl();return(0,r.jsx)(i.Select,{classList:[`${this.getCssBlockName()}__select`],onCreate:this.onWidgetCreate,value:e.getValueForWidget(),readOnly:!e.isEditable(),onChange:this.onChange,items:e.getItems(),placeholder:e.getPlaceholder(),onMouseDown:e.getModel().getAttr("itemSelectPage")?e.onItemSelect:null})}renderEditButton(){const e=this.getCtrl();return(0,r.jsx)(i.Button,Object.assign({classList:[`${this.getCssBlockName()}__edit-button`],onClick:e.onEditButtonClick,enabled:!!e.getValue()},{children:"..."}))}renderCreateButton(){const e=this.getCtrl();return(0,r.jsx)(i.Button,Object.assign({classList:[`${this.getCssBlockName()}__create-button`],onClick:e.onCreateButtonClick},{children:"+"}))}render(){return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[this.renderSelect(),this.getCtrl().getModel().getAttr("itemEditPage")&&!!this.getCtrl().getValue()&&this.renderEditButton(),this.isCreateButtonVisible()&&this.renderCreateButton()]}))}}t.RowFormComboBoxFieldView=RowFormComboBoxFieldView},5598:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormDateFieldController=void 0;const r=s(5417),o=s(4407),i=s(6920);class RowFormDateFieldController extends r.RowFormFieldController{getViewClass(){return super.getViewClass()||o.RowFormDateFieldView}getValueForWidget(){return this.getValue()}setValueFromWidget(e){this.setValue(e)}}t.RowFormDateFieldController=RowFormDateFieldController,i.Helper.registerGlobalClass(RowFormDateFieldController)},4407:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormDateFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(6564);class RowFormDateFieldView extends o.RowFormFieldView{render(){const e=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames()},{children:(0,r.jsx)(i.DropdownDatePicker,{classList:[`${this.getCssBlockName()}__date-picker`],onCreate:this.onWidgetCreate,value:e.getValueForWidget(),readOnly:!e.isEditable(),onChange:e.onChange,placeholder:e.getPlaceholder(),format:e.getFormat(),oldDates:this.props.oldDates,minDate:this.props.minDate,debug:e.getApp().getHostApp().isDebugMode()})}))}}t.RowFormDateFieldView=RowFormDateFieldView},6925:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormDateTimeFieldController=void 0;const r=s(5417),o=s(1008),i=s(7534),a=s(6920);class RowFormDateTimeFieldController extends r.RowFormFieldController{constructor(e,t){super(e,t),this.widget2=null,this.defaultValue=0,this.onView2Create=e=>{this.widget2=e},this.onChange2=(e,t=!0)=>{if(this.resetErrors(),this.resetErrors2(),this.rerender(),this.isValidateOnChange2()){try{this.setValueFromView2(e)}catch(e){console.debug(`${this.getModel().getFullName()}: cannot parse time: ${e.message}`),this.state.parseError2=e.message}if(this.state.parseError2||(this.validate2(),this.isValid()&&this.copyValueToModel()),this.refreshChangedState(),t){try{this.emit("change",{value:e})}catch(e){console.error("unhandled change event error:",this.getModel().getFullName(),e)}this.getParent().onFieldChange({source:this})}}},this.onBlur2=(e,t=!0)=>{if(console.debug("RowFormDateTimeFieldController.onBlur2",e),this.isEditable()){this.resetErrors2(),this.rerender();try{this.setValueFromView2(e)}catch(e){console.debug(`${this.getModel().getFullName()}: cannot parse time: ${e.message}`),this.state.parseError2=e.message}if(this.state.parseError2||(this.validate2(),this.isValid()&&this.copyValueToModel()),this.refreshChangedState(),t){try{this.emit("change",{value:e})}catch(e){console.error("unhandled change event error:",this.getModel().getFullName(),e)}this.getParent().onFieldChange({source:this})}}},this.state.parseError2=null,this.state.error2=null}getViewClass(){return super.getViewClass()||o.RowFormDateTimeFieldView}getValueForWidget(){return this.getValue()}getValueForTime(){const e=this.getValue();if(e){const t=60*e.getHours()+e.getMinutes();if(t!==this.defaultValue)return t}return null}setValueFromWidget(e){if(null===e)this.state.parseError2=null,this.resetErrors2(),this.widget2&&this.widget2.setValue(null);else{const[t,s]=i.TimeBox.splitTime(this.defaultValue);e.setHours(t,s)}this.setValue(e)}getPlaceholder2(){return i.TimeBox.getStringValue(this.defaultValue)}getDefaultValue(){return this.defaultValue}setDefaultValue2(e){if("string"==typeof e)this.defaultValue=i.TimeBox.getIntegerValue(e);else{if(e>=1440)throw new Error(`wrong default value: ${e}`);this.defaultValue=e}this.widget2&&null===this.widget2.getValue()&&this.state.value&&this.setValue2(null)}setValueFromView2(e){if(isNaN(e))throw new Error(this.getTimeErrorText());this.setValue2(e)}getTimeErrorText(){return this.getModel().getApp().getText().field.timeNotValid}setValue2(e){const t=null!==e?e:this.defaultValue,[s,r]=i.TimeBox.splitTime(t);this.state.value.setHours(s,r)}validate2(){this.state.error2=this.getError2()}getError2(){if(this.widget2)try{this.widget2.getValue()}catch(e){return`can't parse time: ${e.message}`}return null}isParseError2(){return null!==this.state.parseError2}resetErrors2(){this.setError2(null),this.state.parseError2=null}setError2(e){this.state.error2=e}getErrorMessage2(){return this.state.parseError2?this.state.parseError2:this.state.error2}isValid2(){return null===this.state.parseError2&&null===this.state.error2}refill(){this.widget2&&(super.refill(),this.widget2.setValue(this.getValueForTime()),this.resetErrors2(),this.refreshChangedState())}isParseError(){return super.isParseError()||this.isParseError2()}isValid(){return super.isValid()&&this.isValid2()}getErrorMessage(){return null===super.getErrorMessage()&&null===this.getErrorMessage2()?null:[...super.getErrorMessage()?[super.getErrorMessage()]:[],...this.getErrorMessage2()?[this.getErrorMessage2()]:[]].join(", ")}isValidateOnChange2(){return!0}isValidateOnBlur2(){return!1}}t.RowFormDateTimeFieldController=RowFormDateTimeFieldController,a.Helper.registerGlobalClass(RowFormDateTimeFieldController)},1008:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormDateTimeFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(2453);class RowFormDateTimeFieldView extends o.RowFormFieldView{constructor(){super(...arguments),this.onClear2=async()=>{this.getCtrl().onChange2(null)}}isCloseVisible(){if(this.props.readOnly)return!1;const{ctrl:e}=this.props;return e.widget2?""!==e.widget2.state.value:void 0!==this.props.value}renderDatePart(){const e=this.getCtrl();return(0,r.jsx)(i.DropdownDatePicker,{classList:[`${this.getCssBlockName()}__dropdown-date-picker`],onCreate:this.onWidgetCreate,value:e.getValueForWidget(),readOnly:!e.isEditable(),onChange:e.onChange,placeholder:e.getPlaceholder(),format:e.getFormat(),oldDates:this.props.oldDates,highlightedDate:e.getHighlightedDate?e.getHighlightedDate():null,selectToday:e.getSelectToday?e.getSelectToday():null,minDate:e.getMinDate?e.getMinDate():null,debug:e.getApp().getHostApp().isDebugMode()})}renderTimePart(){const e=this.getCtrl();return(0,r.jsx)(i.TimeBox2,{classList:[`${this.getCssBlockName()}__time-box`],onCreate:e.onView2Create,readOnly:!e.isEditable(),value:e.getValueForTime(),onChange:e.onChange2,onBlur:e.isValidateOnBlur2()?e.onBlur2:null,placeholder:e.getPlaceholder2(),onClear:this.onClear2})}getMode(){return this.getCtrl().state.value?"datetime":"date"}render(){return(0,r.jsxs)("div",Object.assign({className:`${this.getCssClassNames()} ${this.getMode()}`,style:this.getStyle(this.getCtrl().getRow())},{children:[this.renderDatePart(),this.renderTimePart()]}))}}t.RowFormDateTimeFieldView=RowFormDateTimeFieldView},5417:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormFieldController=void 0;const o=r(s(6689)),i=s(9534);class RowFormFieldController extends i.FieldController{constructor(e,t){super(e,t),this.state={value:null,parseError:null,error:null,changed:!1},this.onChange=async(e,t=!0)=>{console.debug("RowFormFieldController.onChange",JSON.stringify("string"==typeof e?e.substring(0,100):e)),this.resetErrors(),this.rerender();try{this.setValueFromWidget(e)}catch(e){console.error(`${this.getModel().getFullName()}: cannot parse view value: ${e.message}`),this.state.parseError=e.message}if(!this.state.parseError&&this.isValidateOnChange()&&(this.validate(),this.isValid()&&this.copyValueToModel()),this.refreshChangedState(),t){try{this.emit("change",{value:e})}catch(e){console.error("unhandled change event error:",this.getModel().getFullName(),e)}this.getParent().onFieldChange({source:this})}},this.onBlur=(e,t=!0)=>{if(console.debug("RowFormFieldController.onBlur",this.getModel().getFullName(),JSON.stringify(e)),this.isEditable()&&(this.rerender(),this.isValidateOnBlur())){try{this.setValueFromWidget(e)}catch(e){console.error(`${this.getModel().getFullName()}: cannot parse view value: ${e.message}`),this.state.parseError=e.message}if(!this.state.parseError&&this.isValidateOnBlur()&&(this.validate(),this.isValid()&&this.copyValueToModel()),this.refreshChangedState(),t){try{this.emit("change",{value:e})}catch(e){console.error("unhandled change event error:",this.getModel().getFullName(),e)}this.getParent().onFieldChange({source:this})}}},this.onChangePure=async(e,t=!0)=>{if(console.debug("RowFormFieldController.onChangePure",JSON.stringify(e)),this.setValue(e),this.resetErrors(),this.rerender(),this.isValidateOnChange()&&(this.validate(),this.isValid()&&this.copyValueToModel()),this.refreshChangedState(),t){try{this.emit("change",{value:e})}catch(e){console.error("unhandled change event error:",this.getModel().getFullName(),e)}this.getParent().onFieldChange({source:this})}}}init(){const e=this.getRow(),t=this.getModel().getValue(e);this.setValue(t)}refill(){if(!this.view)return;const e=this.getModel().getValue(this.getRow());this.setValue(e),this.resetErrors(),this.refreshChangedState()}getRow(){return this.getModel().getForm().getRow()}getForm(){return this.getParent()}copyValueToModel(){this.getModel().setValue(this.getRow(),this.getValue())}putValue(e){this.onChange(e,!1)}getValueForWidget(){const e=this.getValue();return this.valueToString(e)}setValueFromWidget(e){if("string"!=typeof e)throw new Error(`${this.getModel().getFullName()}: widgetValue must be string, but got ${typeof e}`);const t=this.stringToValue(e);this.setValue(t)}setValue(e){this.state.value=e}getValue(){return this.state.value}isChanged(){return this.state.changed}isValid(){return null===this.state.parseError&&null===this.state.error}validate(){this.isVisible()&&(this.state.error=this.getError())}refreshChangedState(){this.state.changed=this.calcChangedState(this.getRow())}getPlaceholder(){if(this.getModel().getAttr("placeholder"))return this.getModel().getAttr("placeholder");if(this.getApp().getHostApp().isDebugMode()){const e=this.getValue();if(void 0===e)return"undefined";if(null===e)return"null";if(""===e)return"empty string"}return null}getError(){if(this.view&&this.view.getWidget())try{this.view.getWidget().getValue()}catch(e){return`can't parse value: ${e.message}`}const e=this.getValue();return this.getModel().isNotNull()&&null==e?this.getNullErrorText():null}getNullErrorText(){return this.getModel().getApp().getText().form.required}isEditable(){return"edit"===this.getParent().getMode()&&!this.getModel().isReadOnly()}isParseError(){return null!==this.state.parseError}calcChangedState(e){if(!e)throw new Error("FieldController: no row");if(this.isParseError())return console.debug(`FIELD CHANGED ${this.getModel().getFullName()}: parse error: ${this.getErrorMessage()}`),!0;if(!this.isValid())return console.debug(`FIELD CHANGED ${this.getModel().getFullName()}: not valid: ${this.getErrorMessage()}`),!0;if(this.getModel().hasColumn()){const t=this.getModel().valueToRaw(this.getValue()),s=this.getModel().getRawValue(e);if(t!==s)return console.debug(`FIELD CHANGED ${this.getModel().getFullName()}`,JSON.stringify(s),JSON.stringify(t)),!0;if(this.getModel().isChanged(e)){let t=e[this.getModel().getAttr("column")],s=this.getModel().getDefaultDataSource().getRowWithChanges(e)[this.getModel().getAttr("column")];return t&&(t=t.substr(0,100)),s&&(s=s.substr(0,100)),console.debug(`MODEL CHANGED ${this.getModel().getFullName()}:`,t,s),!0}}return!1}setError(e){this.state.error=e}resetErrors(){this.setError(null),this.state.parseError=null}getErrorMessage(){return this.state.parseError?this.state.parseError:this.state.error}renderView(){return o.default.createElement(this.getViewClass(),{onCreate:this.onViewCreate,ctrl:this})}isValidateOnChange(){return this.getModel().validateOnChange()}isValidateOnBlur(){return this.getModel().validateOnBlur()}}t.RowFormFieldController=RowFormFieldController},1249:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormFieldView=void 0;const r=s(1624);class RowFormFieldView extends r.FieldView{constructor(e){super(e),this.onWidgetCreate=e=>{this.widget=e},this.widget=null}getWidget(){return this.widget}getClassList(){const e=this.getCtrl();return[...super.getClassList(),...e.isEditable()?["editable"]:[],...e.isChanged()?["changed"]:[],...null!==e.getErrorMessage()?["error"]:[]]}}t.RowFormFieldView=RowFormFieldView},5796:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormFileFieldController=void 0;const r=s(5417),o=s(7412),i=s(6920);class RowFormFileFieldController extends r.RowFormFieldController{getViewClass(){return super.getViewClass()||o.RowFormFileFieldView}}t.RowFormFileFieldController=RowFormFileFieldController,i.Helper.registerGlobalClass(RowFormFileFieldController)},7412:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormFileFieldView=void 0;const o=s(997),i=r(s(6689)),a=s(1249),n=s(7534),l=s(9780);s(4909);class RowFormFileFieldView extends a.RowFormFieldView{constructor(){super(...arguments),this.image=i.default.createRef(),this.div=i.default.createRef(),this.input=i.default.createRef(),this.onClearClick=e=>{this.getCtrl().onChange("")},this.onChange=async e=>{const t=e.target.files[0];if(t){const e=await n.Helper.readFileAsDataURL(t);this.getCtrl().onChange(e)}},this.onImageClick=async e=>{console.debug("RowFormFileFieldView.onImageClick");const t=this.getCtrl(),s=t.getApp(),r=t.getValueForWidget(),o=new l.ImageDialogController({app:s,id:s.getNewId(),src:r,onClose:()=>{console.debug("onClose"),this.getCtrl().getPage().getView().getElement().focus()}});await s.openModal(o)},this.onImageIconClick=async e=>{console.debug("RowFormFileFieldView.onImageIconClick"),this.getInput().click()}}getImage(){return this.image.current}getDiv(){return this.div.current}getInput(){return this.input.current}updateSize(){if(this.getImage()){const e=this.getImage().getNaturalSize();this.getDiv().innerText=`${e[0]}${e[1]}`}}render(){const e=this.getCtrl(),t=e.getRow(),s=e.getValueForWidget();return(0,o.jsxs)("div",Object.assign({className:this.getCssClassNames(),style:this.getStyle(t)},{children:[s?(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__image-block`},{children:[(0,o.jsx)(n.Image,{classList:[`${this.getCssBlockName()}__image`],ref:this.image,src:s,onClick:this.onImageClick}),(0,o.jsx)("span",{className:`${this.getCssBlockName()}__size`,ref:this.div}),(0,o.jsx)("span",Object.assign({className:`${this.getCssBlockName()}__length`},{children:n.Helper.formatNumber(s.length)}))]})):(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__image-icon`,onClick:this.onImageIconClick},{children:(0,o.jsx)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:96,height:96,viewBox:"0 0 48 48"},{children:(0,o.jsx)("path",{d:"M38.65 15.3V11h-4.3V8h4.3V3.65h3V8H46v3h-4.35v4.3ZM4.7 44q-1.2 0-2.1-.9-.9-.9-.9-2.1V15.35q0-1.15.9-2.075.9-.925 2.1-.925h7.35L15.7 8h14v3H17.1l-3.65 4.35H4.7V41h34V20h3v21q0 1.2-.925 2.1-.925.9-2.075.9Zm17-7.3q3.6 0 6.05-2.45 2.45-2.45 2.45-6.1 0-3.6-2.45-6.025Q25.3 19.7 21.7 19.7q-3.65 0-6.075 2.425Q13.2 24.55 13.2 28.15q0 3.65 2.425 6.1Q18.05 36.7 21.7 36.7Zm0-3q-2.4 0-3.95-1.575-1.55-1.575-1.55-3.975 0-2.35 1.55-3.9 1.55-1.55 3.95-1.55 2.35 0 3.925 1.55 1.575 1.55 1.575 3.9 0 2.4-1.575 3.975Q24.05 33.7 21.7 33.7Zm0-5.5Z"})}))})),(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__toolbar`},{children:[(0,o.jsx)("input",{ref:this.input,type:"file",onChange:this.onChange,disabled:!e.isEditable(),style:{display:s?void 0:"none"}}),!!s&&(0,o.jsx)(n.Button,Object.assign({onClick:this.onClearClick,enabled:e.isEditable()},{children:this.getCtrl().getApp().getModel().getText().field.clear}))]}))]}))}componentDidMount(){setTimeout((()=>this.updateSize()),0)}componentDidUpdate(e,t,s){setTimeout((()=>this.updateSize()),0)}}t.RowFormFileFieldView=RowFormFileFieldView},9234:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormLinkFieldController=void 0;const r=s(5417),o=s(8666),i=s(6920);class RowFormLinkFieldController extends r.RowFormFieldController{constructor(){super(...arguments),this.onClick=e=>{console.debug("RowFormLinkFieldController.onClick",e);const t=this.getModel().getAttr("page");t&&(e.preventDefault(),this.openPage({name:t,params:{key:this.getValue()}})),this.emit({source:this})}}getViewClass(){return super.getViewClass()||o.RowFormLinkFieldView}getDisplayValue(){const e=this.getModel().getAttr("displayColumn");if(e){const t=this.getModel().getDefaultDataSource(),s=t.getValue(t.getSingleRow(),e);return JSON.parse(s)}return null}}t.RowFormLinkFieldController=RowFormLinkFieldController,i.Helper.registerGlobalClass(RowFormLinkFieldController)},8666:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormLinkFieldView=void 0;const r=s(997),o=s(2855),i=s(1249);s(5781);class RowFormLinkFieldView extends i.RowFormFieldView{render(){const e=this.getCtrl();let t=e.getValueForWidget(),s=e.getValueForWidget();const i=e.getDisplayValue();i&&(s=i);const a=e.getModel().getAttr("page");if(a){const s=e.getValueForWidget();t=e.getPage().createOpenInNewLink(a,(0,o.keyTupleToKey)([s]))}return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames()},{children:(0,r.jsx)("a",Object.assign({href:t,onClick:e.onClick,target:"_blank"},{children:s}))}))}}t.RowFormLinkFieldView=RowFormLinkFieldView},7470:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormPasswordFieldController=void 0;const r=s(5417),o=s(262),i=s(6920);class RowFormPasswordFieldController extends r.RowFormFieldController{getViewClass(){return super.getViewClass()||o.RowFormPasswordFieldView}}t.RowFormPasswordFieldController=RowFormPasswordFieldController,i.Helper.registerGlobalClass(RowFormPasswordFieldController)},262:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormPasswordFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(1850);class RowFormPasswordFieldView extends o.RowFormFieldView{constructor(e){super(e),this.onCloseClick=async e=>{const t=this.getCtrl();this.getWidget().state.value="",this.getWidget().setState({value:""}),t.onChange(""),this.getWidget().getElement().focus()},this.onFocus=async e=>{this.addCssClass("focus"),await this.rerender()},this.onBlur=async e=>{this.removeCssClass("focus"),await this.rerender()},this.onIconClick=e=>{this.setState((e=>({type:"password"===e.type?"text":"password"})))},this.state={classList:[],type:"password"}}isCloseVisible(){return!!this.getCtrl().isEditable()&&(this.getWidget()?""!==this.getWidget().state.value:void 0!==this.props.value)}render(){const e=this.getCtrl();return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[(0,r.jsx)(i.TextBox,{classList:[`${this.getCssBlockName()}__input`],type:this.state.type,value:e.getValueForWidget(),readOnly:!e.isEditable(),disabled:!e.isEditable(),autoFocus:e.isAutoFocus(),placeholder:e.getPlaceholder()||null,autocomplete:e.getAutocomplete(),onCreate:this.onWidgetCreate,onChange:e.onChange,onFocus:this.onFocus,onBlur:this.onBlur}),(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close ${this.isCloseVisible()?"visible":""}`,onClick:this.onCloseClick},{children:(0,r.jsx)(i.CloseIcon,{})})),(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__icon`,onClick:this.onIconClick},{children:"password"===this.state.type?(0,r.jsx)(i.VisibilityIcon,{}):(0,r.jsx)(i.VisibilityOffIcon,{})}))]}))}}t.RowFormPasswordFieldView=RowFormPasswordFieldView},2293:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormPhoneFieldController=void 0;const r=s(5417),o=s(9699),i=s(6920);class RowFormPhoneFieldController extends r.RowFormFieldController{getViewClass(){return super.getViewClass()||o.RowFormPhoneFieldView}getPhoneFormatErrorText(){return this.getModel().getApp().getText().form.phoneNumberFormatError}getError(){const e=super.getError();if(e)return e;const t=this.getValue();return t&&"+7"===t.substr(0,2)&&t.length<12?this.getPhoneFormatErrorText():null}}t.RowFormPhoneFieldController=RowFormPhoneFieldController,i.Helper.registerGlobalClass(RowFormPhoneFieldController)},9699:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormPhoneFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(2963);class RowFormPhoneFieldView extends o.RowFormFieldView{constructor(e){super(e),this.onClear=async e=>{this.getCtrl().onChange(""),setTimeout((()=>{this.getWidget().getElement().focus()}),0)},this.onFocus=async e=>{this.addCssClass("focus"),await this.rerender()},this.onBlur=async e=>{this.removeCssClass("focus"),this.getCtrl().onBlur(e)},this.state={classList:[]}}isCloseVisible(){const e=this.getCtrl();return!!e.isEditable()&&""!==e.getValueForWidget()}renderPhoneBox(){const e=this.getCtrl();return(0,r.jsx)(i.PhoneBox,{classList:[`${this.getCssBlockName()}__input`],value:e.getValueForWidget(),readOnly:!e.isEditable(),disabled:!e.isEditable(),autoFocus:e.isAutoFocus(),placeholder:e.getPlaceholder()||null,autocomplete:e.getAutocomplete(),onCreate:this.onWidgetCreate,onChange:e.onChange,onFocus:this.onFocus,onBlur:this.onBlur})}renderClearButton(){return(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close ${this.isCloseVisible()?"visible":""}`,onMouseDown:this.onClear},{children:(0,r.jsx)(i.CloseIcon,{})}))}renderPhoneIcon(){return(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__icon`},{children:(0,r.jsx)(i.PhoneIcon,{})}))}render(){return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[this.renderPhoneBox(),this.renderClearButton(),this.renderPhoneIcon()]}))}}t.RowFormPhoneFieldView=RowFormPhoneFieldView},8054:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormRadioFieldController=void 0;const r=s(5417),o=s(8399),i=s(6920);class RowFormRadioFieldController extends r.RowFormFieldController{getViewClass(){return super.getViewClass()||o.RowFormRadioFieldView}getItems(){try{return this.getRows().map((e=>({value:this.getModel().getValueValue(e),title:this.getModel().getDisplayValue(e)})))}catch(e){throw e.message=`${this.getModel().getFullName()}: ${e.message}`,e}}getRows(){return this.getModel().getDataSource().getRows()}}t.RowFormRadioFieldController=RowFormRadioFieldController,i.Helper.registerGlobalClass(RowFormRadioFieldController)},8399:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormRadioFieldView=void 0;const r=s(997),o=s(1249);s(6558);class RowFormRadioFieldView extends o.RowFormFieldView{constructor(){super(...arguments),this.onClick=async e=>{console.debug("RowFormRadioFieldView.onClick",e.currentTarget.dataset.value);let t=JSON.parse(e.currentTarget.dataset.value);this.getCtrl().getValue()!==t&&await this.getCtrl().onChangePure(t)}}render(){const e=this.getCtrl().getValue();return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames()},{children:this.getCtrl().getItems().map((t=>(0,r.jsx)("input",{className:`${this.getCssBlockName()}__toggle ${e===t.value?"selected":""}`,type:"button",value:t.title||t.value,disabled:!this.getCtrl().isEditable(),"data-value":JSON.stringify(t.value),onClick:this.onClick},t.value)))}))}}t.RowFormRadioFieldView=RowFormRadioFieldView},765:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormTextAreaFieldController=void 0;const r=s(5417),o=s(2221),i=s(6920);class RowFormTextAreaFieldController extends r.RowFormFieldController{getViewClass(){return super.getViewClass()||o.RowFormTextAreaFieldView}}t.RowFormTextAreaFieldController=RowFormTextAreaFieldController,i.Helper.registerGlobalClass(RowFormTextAreaFieldController)},2221:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormTextAreaFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(2806);class RowFormTextAreaFieldView extends o.RowFormFieldView{constructor(e){super(e),this.onFocus=async e=>{this.addCssClass("focus"),await this.rerender()},this.onBlur=async e=>{this.removeCssClass("focus"),await this.rerender()},this.state={classList:[]}}render(){const e=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames()},{children:(0,r.jsx)(i.TextArea,{classList:[`${this.getCssBlockName()}__textarea`],onCreate:this.onWidgetCreate,value:e.getValueForWidget(),readOnly:!e.isEditable(),disabled:!e.isEditable(),onChange:e.onChange,placeholder:e.getPlaceholder(),rows:e.getModel().getRows(),cols:e.getModel().getCols(),onFocus:this.onFocus,onBlur:this.onBlur})}))}}t.RowFormTextAreaFieldView=RowFormTextAreaFieldView},2833:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormTextBoxFieldController=void 0;const r=s(5417),o=s(9900),i=s(6920);class RowFormTextBoxFieldController extends r.RowFormFieldController{getViewClass(){return super.getViewClass()||o.RowFormTextBoxFieldView}}t.RowFormTextBoxFieldController=RowFormTextBoxFieldController,i.Helper.registerGlobalClass(RowFormTextBoxFieldController)},9900:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormTextBoxFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(7231);class RowFormTextBoxFieldView extends o.RowFormFieldView{constructor(e){super(e),this.onClear=async e=>{this.getCtrl().onChange(""),setTimeout((()=>{this.getWidget().getElement().focus()}),0)},this.onFocus=async e=>{this.addCssClass("focus"),await this.rerender()},this.onBlur=async e=>{const t=e.target.value;this.removeCssClass("focus"),this.getCtrl().onBlur(t)},this.state={classList:[]}}isCloseVisible(){const e=this.getCtrl();return!!e.isEditable()&&""!==e.getValueForWidget()}renderTextBox(){const e=this.getCtrl();return(0,r.jsx)(i.TextBox,{classList:[`${this.getCssBlockName()}__input`],value:e.getValueForWidget(),readOnly:!e.isEditable(),enabled:e.isEditable(),autoFocus:e.isAutoFocus(),placeholder:e.getPlaceholder()||null,autocomplete:e.getAutocomplete(),onCreate:this.onWidgetCreate,onChange:e.onChange,onFocus:this.onFocus,onBlur:this.onBlur})}renderCloseIcon(){return(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close ${this.isCloseVisible()?"visible":""}`,onMouseDown:this.onClear},{children:(0,r.jsx)(i.CloseIcon,{})}))}render(){return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[this.renderTextBox(),this.renderCloseIcon()]}))}}t.RowFormTextBoxFieldView=RowFormTextBoxFieldView},6035:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormTimeFieldController=void 0;const r=s(5417),o=s(4857),i=s(7534),a=s(6920);class RowFormTimeFieldController extends r.RowFormFieldController{constructor(){super(...arguments),this.defaultValue=null}getViewClass(){return super.getViewClass()||o.RowFormTimeFieldView}getValueForWidget(){return this.getValue()}setValueFromWidget(e){if(isNaN(e))throw new Error("wrong time");this.setValue(e)}getDefaultValue(){return this.defaultValue}setDefaultValue2(e){if("string"==typeof e)this.defaultValue=i.TimeBox.getIntegerValue(e);else{if(e>=1440)throw new Error(`wrong default value: ${e}`);this.defaultValue=e}}getPlaceholder(){return null!==this.defaultValue?i.TimeBox.getStringValue(this.defaultValue):super.getPlaceholder()}}t.RowFormTimeFieldController=RowFormTimeFieldController,a.Helper.registerGlobalClass(RowFormTimeFieldController)},4857:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormTimeFieldView=void 0;const r=s(997),o=s(1249),i=s(7534);s(9784);class RowFormTimeFieldView extends o.RowFormFieldView{constructor(){super(...arguments),this.onCloseClick=async e=>{console.debug("RowFormTimeFieldView.onCloseClick")}}isCloseVisible(){return!this.props.readOnly&&(this.getWidget()?""!==this.getWidget().state.value:void 0!==this.props.value)}render(){const e=this.getCtrl();return(0,r.jsxs)("div",Object.assign({className:this.getCssClassNames()},{children:[(0,r.jsx)(i.TimeBox,{onCreate:this.onWidgetCreate,value:e.getValueForWidget(),readOnly:!e.isEditable(),onChange:e.onChange,onBlur:e.onBlur,placeholder:e.getPlaceholder()}),(0,r.jsx)("div",Object.assign({className:"close "+(this.isCloseVisible()?"visible":""),onClick:this.onCloseClick},{children:(0,r.jsx)(i.CloseIcon,{})}))]}))}}t.RowFormTimeFieldView=RowFormTimeFieldView},4691:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormCheckBoxFieldController=void 0;const r=s(9883),o=s(2266),i=s(6920);class TableFormCheckBoxFieldController extends r.TableFormFieldController{getViewClass(){return super.getViewClass()||o.TableFormCheckBoxFieldView}getValueForWidget(e){return this.getModel().getValue(e)}getAlign(){return"center"}}t.TableFormCheckBoxFieldController=TableFormCheckBoxFieldController,i.Helper.registerGlobalClass(TableFormCheckBoxFieldController)},2266:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormCheckBoxFieldView=void 0;const r=s(997),o=s(3312),i=s(7534);s(6159);class TableFormCheckBoxFieldView extends o.TableFormFieldView{render(){const e=this.props.row,t=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:this.getCssClassNames(),style:Object.assign(Object.assign({},this.getStyle(e)),{textAlign:t.getAlign()})},{children:(0,r.jsx)(i.CheckBox,{ref:this.span,checked:t.getValueForWidget(e),readOnly:!0,disabled:!0})}))}}t.TableFormCheckBoxFieldView=TableFormCheckBoxFieldView},4898:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormComboBoxFieldController=void 0;const r=s(9883),o=s(8755),i=s(6920);class TableFormComboBoxFieldController extends r.TableFormFieldController{constructor(){super(...arguments),this.onListUpdate=async e=>{this.getForm().invalidate(),await this.getForm().rerender()}}init(){super.init();const e=this.getModel().getComboBoxDataSource();e.on("insert",this.onListUpdate),e.on("update",this.onListUpdate),e.on("delete",this.onListUpdate)}deinit(){const e=this.getModel().getComboBoxDataSource();e.off("insert",this.onListUpdate),e.off("update",this.onListUpdate),e.off("delete",this.onListUpdate),super.deinit()}getViewClass(){return super.getViewClass()||o.TableFormComboBoxFieldView}getValueForWidget(e){const t=this.getModel().getValue(e),s=this.getModel().valueToRaw(t);if(void 0===s||"null"===s)return"";const r=this.getModel().findRowByRawValue(s);return r?this.valueToString(this.getModel().getDisplayValue(r)):`[no row for id: ${s}]`}}t.TableFormComboBoxFieldController=TableFormComboBoxFieldController,i.Helper.registerGlobalClass(TableFormComboBoxFieldController)},8755:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormComboBoxFieldView=void 0;const r=s(997),o=s(3312);class TableFormComboBoxFieldView extends o.TableFormFieldView{render(){const e=this.props.row,t=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:`${this.getCssClassNames()} ellipsis`,style:this.getStyle(e)},{children:(0,r.jsx)("span",Object.assign({ref:this.span},{children:t.getValueForWidget(e)}))}))}}t.TableFormComboBoxFieldView=TableFormComboBoxFieldView},8710:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormDateFieldController=void 0;const r=s(9883),o=s(3910),i=s(7534);class TableFormDateFieldController extends r.TableFormFieldController{getViewClass(){return super.getViewClass()||o.TableFormDateFieldView}getValueForWidget(e){const t=this.getModel().getValue(e);return t?i.Helper.formatDate(t,this.getFormat()||"{DD}.{MM}.{YYYY} {hh}:{mm}:{ss}"):""}}t.TableFormDateFieldController=TableFormDateFieldController,i.Helper.registerGlobalClass(TableFormDateFieldController)},3910:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormDateFieldView=void 0;const r=s(997),o=s(3312);s(949);class TableFormDateFieldView extends o.TableFormFieldView{render(){const e=this.props.row,t=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:`${this.getCssClassNames()} ellipsis`,style:this.getStyle(e)},{children:(0,r.jsx)("span",Object.assign({ref:this.span},{children:t.getValueForWidget(e)}))}))}}t.TableFormDateFieldView=TableFormDateFieldView},4105:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormDateTimeFieldController=void 0;const r=s(9883),o=s(5596),i=s(7534);class TableFormDateTimeFieldController extends r.TableFormFieldController{getViewClass(){return super.getViewClass()||o.TableFormDateTimeFieldView}getValueForWidget(e){const t=this.getModel().getValue(e);return t?i.Helper.formatDate(t,this.getFormat()||"{DD}.{MM}.{YYYY} {hh}:{mm}:{ss}"):""}}t.TableFormDateTimeFieldController=TableFormDateTimeFieldController,i.Helper.registerGlobalClass(TableFormDateTimeFieldController)},5596:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormDateTimeFieldView=void 0;const r=s(997),o=s(3312);class TableFormDateTimeFieldView extends o.TableFormFieldView{render(){const e=this.props.row,t=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:`${this.getCssClassNames()} ellipsis`,style:this.getStyle(e)},{children:(0,r.jsx)("span",Object.assign({ref:this.span},{children:t.getValueForWidget(e)}))}))}}t.TableFormDateTimeFieldView=TableFormDateTimeFieldView},9883:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormFieldController=void 0;const r=s(9534);class TableFormFieldController extends r.FieldController{getValueForWidget(e){return this.valueToString(this.getModel().getValue(e))}getForm(){return this.getParent()}getAlign(){return null}}t.TableFormFieldController=TableFormFieldController},3312:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormFieldView=void 0;const o=r(s(6689)),i=s(1624);class TableFormFieldView extends i.FieldView{constructor(e){super(e),this.span=o.default.createRef()}getSpanOffsetWidth(){return this.span.current?this.span.current.offsetWidth:0}}t.TableFormFieldView=TableFormFieldView},7881:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormLinkFieldController=void 0;const r=s(9883),o=s(3705),i=s(6920);class TableFormLinkFieldController extends r.TableFormFieldController{constructor(){super(...arguments),this.onClick=e=>{console.debug("TableFormLinkFieldController.onClick",e),e.preventDefault(),this.emit("click",{source:this})}}getViewClass(){return super.getViewClass()||o.TableFormLinkFieldView}}t.TableFormLinkFieldController=TableFormLinkFieldController,i.Helper.registerGlobalClass(TableFormLinkFieldController)},3705:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormLinkFieldView=void 0;const r=s(997),o=s(3312);s(2287);class TableFormLinkFieldView extends o.TableFormFieldView{render(){const e=this.props.row,t=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:`${this.getCssClassNames()} ellipsis`,style:this.getStyle(e)},{children:(0,r.jsx)("a",Object.assign({href:"#",onClick:t.onClick},{children:t.getValueForWidget(e)}))}))}}t.TableFormLinkFieldView=TableFormLinkFieldView},9992:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormPhoneFieldController=void 0;const r=s(9883),o=s(4415),i=s(6920);class TableFormPhoneFieldController extends r.TableFormFieldController{getViewClass(){return super.getViewClass()||o.TableFormPhoneFieldView}}t.TableFormPhoneFieldController=TableFormPhoneFieldController,i.Helper.registerGlobalClass(TableFormPhoneFieldController)},4415:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormPhoneFieldView=void 0;const r=s(997),o=s(3312),i=s(7534);class TableFormPhoneFieldView extends o.TableFormFieldView{render(){const e=this.props.row;return(0,r.jsx)("div",Object.assign({className:`${this.getCssClassNames()} ellipsis`,style:this.getStyle(e)},{children:(0,r.jsx)("span",Object.assign({ref:this.span},{children:i.PhoneBox.formatPhoneNumber(this.getCtrl().getValueForWidget(e))}))}))}}t.TableFormPhoneFieldView=TableFormPhoneFieldView},8617:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormTextBoxFieldController=void 0;const r=s(9883),o=s(6471),i=s(7534);class TableFormTextBoxFieldController extends r.TableFormFieldController{getViewClass(){return super.getViewClass()||o.TableFormTextBoxFieldView}}t.TableFormTextBoxFieldController=TableFormTextBoxFieldController,i.Helper.registerGlobalClass(TableFormTextBoxFieldController)},6471:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormTextBoxFieldView=void 0;const r=s(997),o=s(3312);s(4091);class TableFormTextBoxFieldView extends o.TableFormFieldView{render(){const e=this.props.row,t=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:`${this.getCssClassNames()} ellipsis`,style:this.getStyle(e)},{children:(0,r.jsx)("span",Object.assign({ref:this.span},{children:t.getValueForWidget(e)}))}))}}t.TableFormTextBoxFieldView=TableFormTextBoxFieldView},1423:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormController=void 0;const r=s(7111),o=s(7534),i=s(9534);class FormController extends r.ModelController{static create(e,t){const{ctrlClass:s}=e.getData();if(s){const r=o.Helper.getGlobalClass(s);if(!r)throw new Error(`no class ${s}`);return new r(e,t)}return new(o.Helper.getGlobalClass(`${e.getClassName()}Controller`))(e,t)}constructor(e,t){super(e,t),this.fields={},"object"==typeof window&&console.debug(`${this.constructor.name}.constructor`,e)}init(){for(const e of this.getModel().fields){(this.fields[e.getName()]=i.FieldController.create(e,this)).init()}}deinit(){for(const e in this.fields)this.fields[e].deinit();super.deinit()}isValid(){return!0}async openPage(e){return await this.getPage().openPage(e)}getPage(){return this.getParent()}isChanged(){return!1}async onFieldChange(e){await this.getPage().onFormChange(e)}getUpdated(){return this.state.updated}invalidate(){this.state.updated=Date.now()}async onActionClick(e,t){console.debug("FormController.onActionClick",e,t)}getField(e){return this.fields[e]}getApp(){return this.getParent().getParent()}getSelectedRowKey(){return null}isAutoFocus(){for(const e in this.fields)if(this.fields[e].isAutoFocus())return!0;return!1}isVisible(){return"true"===this.getModel().getAttr("visible")}getActiveRow(){throw new Error("FormController.getActiveRow not implemented")}getRow(){throw new Error("FormController.getRow not implemented")}}t.FormController=FormController},7087:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormView=void 0;const r=s(4190);class FormView extends r.ModelView{constructor(e){super(e),this.onActionsClick=async e=>{const t=this.getCtrl(),s=e.dataset.action;try{if(!await t.onActionClick(s,t.getActiveRow()))throw new Error(`no handler for action '${s}'`)}catch(e){console.error(e),await this.getCtrl().getApp().alert({message:e.message})}},this.checkParent()}shouldComponentUpdate(e,t){return console.debug("FormView.shouldComponentUpdate",this.getCtrl().getModel().getFullName(),e.updated-this.props.updated),!!(e.updated-this.props.updated)}}t.FormView=FormView},5278:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormController=void 0;const r=s(1423),o=s(4157),i=s(6920);class RowFormController extends r.FormController{constructor(){super(...arguments),this.fields={},this.state={updated:Date.now(),mode:"edit",hasNew:!1,changed:!1,valid:!0},this.onModelRefresh=async e=>{console.debug("RowFormController.onModelRefresh",this.getModel().getFullName()),this.view&&(this.refill(),this.invalidate(),this.rerender())},this.onModelInsert=async e=>{console.debug("RowFormController.onModelInsert",this.getModel().getFullName()),this.refill(),this.invalidate(),this.calcState(),this.getParent().onFormInsert(e)},this.onModelUpdate=async e=>{console.debug("RowFormController.onModelUpdate",this.getModel().getFullName(),e),this.refill(),this.invalidate(),this.calcState(),this.getParent().onFormUpdate(e)},this.onSaveClick=async()=>{if(console.debug("RowFormController.onSaveClick"),this.validate(),this.calcState(),this.isValid())try{this.getApp().getView().disableRerender(),await this.getModel().update(),this.state.mode="view",console.debug("form model updated",this.getModel().getFullName())}finally{this.getApp().getView().enableRerender(),await this.getApp().getView().rerender()}else console.error(`cannot update invalid row form: ${this.getModel().getFullName()}`),await this.rerender()},this.onDiscardClick=()=>{console.debug("RowFormController.onDiscardClick",this.getModel().getFullName());const e=[];for(const t in this.fields){const s=this.fields[t];!s.isChanged()&&s.isValid()||e.push(t)}this.getModel().discard(e),e.forEach((e=>{this.fields[e].refill()})),this.calcState(),this.getModel().hasDefaultPersistentDataSource()&&(this.state.mode="view"),this.rerender(),this.getParent().onFormDiscard(this)},this.onRefreshClick=async()=>{await this.getModel().refresh()},this.onEditClick=e=>{console.debug("RowFormController.onEditClick"),this.state.mode="edit",this.rerender()},this.onCancelClick=e=>{console.debug("RowFormController.onCancelClick"),this.state.mode="view",this.rerender()}}init(){super.init(),this.getModel().on("refresh",this.onModelRefresh),this.getModel().on("insert",this.onModelInsert),this.getModel().on("update",this.onModelUpdate),this.getModel().getDefaultDataSource().isPersistent()&&(this.state.mode="view"),this.calcState(),this.state.hasNew&&(this.state.mode="edit")}deinit(){this.getModel().off("refresh",this.onModelRefresh),this.getModel().off("insert",this.onModelInsert),this.getModel().off("update",this.onModelUpdate),super.deinit()}calcState(){this.state.hasNew=this.getModel().hasNew(),this.state.changed=this.isChanged(),this.state.valid=this.isValid()}refill(){console.debug("RowFormController.refill",this.getModel().getFullName());for(const e in this.fields)this.fields[e].refill()}isValid(){for(const e in this.fields){if(!this.fields[e].isValid())return!1}return!0}validate(){for(const e in this.fields)this.fields[e].validate();this.invalidate()}clearFieldsError(){for(const e in this.fields)this.fields[e].setError(null)}isChanged(){if(this.getModel().isChanged())return!0;for(const e in this.fields){if(this.fields[e].isChanged())return!0}return!1}async onFieldChange(e){this.calcState(),this.invalidate(),await super.onFieldChange(e)}getViewClass(){return super.getViewClass()||o.RowFormView}getActiveRow(){return this.getModel().getRow(!0)}getRow(){return this.getModel().getRow(!0)}getMode(){return this.state.mode}isActionEnabled(e){return this.isViewMode()}isEditMode(){return"edit"===this.getMode()}isViewMode(){return"view"===this.getMode()}getField(e){return this.fields[e]}}t.RowFormController=RowFormController,i.Helper.registerGlobalClass(RowFormController)},4157:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowFormView=void 0;const r=s(997),o=s(7087),i=s(7534),a=s(8978);s(9820);class RowFormView extends o.FormView{renderToolbar(){const{ctrl:e}=this.props,t=e.getModel().getApp().getText();return(0,r.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__toolbar flex grid-gap-5`},{children:[e.getModel().hasDefaultPersistentDataSource()&&(0,r.jsx)(i.Button,Object.assign({classList:["toolbar-button"],onClick:e.onEditClick,visible:"view"===e.getMode()},{children:(0,r.jsx)("div",{children:t.form.edit})}),"edit"),e.getModel().hasDefaultPersistentDataSource()&&(0,r.jsx)(i.Button,Object.assign({classList:["toolbar-button"],enabled:(e.state.changed||e.state.hasNew)&&e.state.valid,onClick:e.onSaveClick,visible:"edit"===e.getMode()},{children:(0,r.jsx)("div",{children:t.form.save})}),"save"),e.getModel().hasDefaultPersistentDataSource()&&e.getModel().getKey()&&(0,r.jsx)(i.Button,Object.assign({classList:["toolbar-button"],visible:"edit"===e.getMode()&&!e.state.changed&&e.state.valid,onClick:e.onCancelClick},{children:(0,r.jsx)("div",{children:t.form.cancel})}),"cancel"),e.getModel().hasDefaultPersistentDataSource()&&e.getModel().getKey()&&(0,r.jsx)(i.Button,Object.assign({classList:["toolbar-button"],enabled:e.state.changed||!e.isValid(),onClick:e.onDiscardClick,visible:"edit"===e.getMode()&&(e.state.changed||!e.state.valid)},{children:(0,r.jsx)("div",{children:t.form.discard})}),"discard"),e.getModel().hasDefaultPersistentDataSource()&&"true"===e.getModel().getAttr("refreshButton")&&(0,r.jsx)(i.Button,Object.assign({classList:["toolbar-button"],enabled:!e.state.changed&&!e.state.hasNew,onClick:e.onRefreshClick,visible:"view"===e.getMode()},{children:(0,r.jsx)("div",{children:t.form.refresh})}),"refresh"),this.isActionsVisible()&&e.getModel().hasActions()&&(0,r.jsx)(i.DropdownButton,Object.assign({classList:["toolbar-dropdown-button"],actions:this.getActionsForDropdownButton(),onClick:this.onActionsClick,enabled:this.isActionsEnabled()},{children:(0,r.jsx)(i.MoreVertIcon,{})}))]}))}isActionsEnabled(){return!0}isActionsVisible(){return!this.getCtrl().getModel().hasDefaultPersistentDataSource()||!!this.getCtrl().getModel().getKey()}renderLabel(e){const t=e.getModel(),s=t.getName();return(0,r.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__label`},{children:[t.getCaption(),":",t.isNotNull()&&(0,r.jsx)("span",Object.assign({style:{color:"red"}},{children:"*"}))]}),`label.${s}`)}renderField(e){const t=e.getModel().getName();return(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__field`},{children:this.renderFieldView(e)}),`field.${t}`)}renderFieldView(e){return RowFormView.renderFieldView(e)}static renderFieldView(e){return e.renderView()}renderError(e){const t=e.getModel().getName();return(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__error`},{children:(0,r.jsx)(i.Tooltip,{position:"left",type:"alert",hidden:null===e.getErrorMessage(),tip:e.getErrorMessage()})}),`tooltip.${t}`)}renderGroup(e){return[this.renderLabel(e),this.renderField(e),this.renderError(e)]}renderGroups(){const e=this.getCtrl();return(0,r.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__groups`},{children:Object.keys(e.fields).filter((t=>e.getField(t).isVisible())).map((t=>this.renderGroup(e.getField(t))))}))}render(){return(0,a.debug)("RowFormView.render",this.getCtrl().getModel().getFullName()),(0,r.jsxs)("div",Object.assign({className:`${this.getCssClassNames()} flex-column grid-gap-5`,style:this.getStyle()},{children:[(this.getCtrl().getModel().hasDefaultPersistentDataSource()||this.getCtrl().getModel().hasActions())&&this.renderToolbar(),this.renderGroups()]}))}}t.RowFormView=RowFormView},8518:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormController=void 0;const r=s(1423),o=s(315),i=s(3677),a=s(7534);class TableFormController extends r.FormController{constructor(){super(...arguments),this.fields={},this.state={updated:Date.now()},this.grid=null,this.onGridCreate=e=>{this.grid=e},this.onNewClick=async e=>{console.debug("TableFormController.onNewClick"),await this.new()},this.onRefreshClick=async e=>{console.debug("TableFormController.onRefreshClick",this.getModel().getFullName()),await this.getModel().refresh()},this.onDeleteClick=async e=>{console.debug("TableFormController.onDeleteClick",this.getModel().getFullName(),this.grid.getActiveRowKey());await this.getApp().confirm({message:this.getModel().getApp().getText().form.areYouSure})&&await this.getModel().getDefaultDataSource().delete(this.grid.getActiveRowKey())},this.onGridCellDblClick=async(e,t)=>{if("form"===this.getModel().getAttr("editMethod"))this.getPage().getModel().isSelectMode()?await this.getPage().selectRow(t):await this.edit(t)},this.onGridLinkClick=async e=>{console.debug("TableFormController.onGridLinkClick",e),await this.edit(e)},this.onGridDeleteKeyDown=async(e,t)=>{if(console.debug("TableFormController.onGridDeleteKeyDown",e,t),"disabled"!==this.getModel().getAttr("deleteRowMode")){await this.getApp().confirm({message:this.getModel().getApp().getText().form.areYouSure})&&await this.getModel().getDefaultDataSource().delete(t)}},this.onModelRefresh=async e=>{console.debug("TableFormController.onModelRefresh",this.getModel().getFullName(),e),this.view&&(this.invalidate(),await this.rerender())},this.onModelInsert=async e=>{if(console.debug("TableFormController.onModelInsert",this.getModel().getFullName(),e),this.view){if(this.grid&&e.source)for(const t of e.inserts)this.grid.setActiveRowKey(t);this.invalidate(),await this.rerender()}},this.onModelUpdate=async e=>{if(console.debug("TableFormController.onModelUpdate",this.getModel().getFullName(),e,this.view),this.view){if(this.grid)for(const t in e.updates)if(this.grid.getActiveRowKey()===t){const s=e.updates[t];t!==s&&this.grid.setActiveRowKey(s)}this.invalidate(),await this.rerender()}},this.onModelDelete=async e=>{if(console.debug("TableFormController.onModelDelete",this.getModel().getFullName(),e),this.view){if(this.grid)for(const t of e.deletes)this.grid.getActiveRowKey()===t&&this.grid.setActiveRowKey(null);this.invalidate(),await this.rerender()}},this.onGridSelectionChange=async e=>{this.invalidate(),await this.getPage().rerender()},this.isRowSelected=()=>!!this.grid&&!!this.grid.getActiveRowKey(),this.onFrameChanged=async e=>{console.debug("TableFormController.onFrameChanged",e);let t=parseInt(e);console.debug("frame:",t);const s=this.getModel().getDefaultDataSource().getFramesCount();t<1&&(t=1),t>s&&(t=s),this.getModel().getDefaultDataSource().setFrame(t),this.getModel().getDefaultDataSource().refresh(),await this.rerender()},this.onNextClick=async()=>{console.debug("TableFormController.onNextClick");const e=this.getModel().getDefaultDataSource().getFrame()+1;this.getModel().getDefaultDataSource().setFrame(e),this.getModel().getDefaultDataSource().refresh(),await this.rerender()},this.onPreviousClick=async()=>{console.debug("TableFormController.onPreviousClick");const e=this.getModel().getDefaultDataSource().getFrame()-1;this.getModel().getDefaultDataSource().setFrame(e),this.getModel().getDefaultDataSource().refresh(),this.rerender()}}getViewClass(){return super.getViewClass()||o.TableFormView}init(){super.init(),this.getModel().on("refresh",this.onModelRefresh),this.getModel().on("update",this.onModelUpdate),this.getModel().on("delete",this.onModelDelete),this.getModel().on("insert",this.onModelInsert)}deinit(){this.getModel().off("refresh",this.onModelRefresh),this.getModel().off("update",this.onModelUpdate),this.getModel().off("delete",this.onModelDelete),this.getModel().off("insert",this.onModelInsert),super.deinit()}async new(){if("oneclick"===this.getModel().getAttr("newRowMode")){const e={};this.getModel().fillDefaultValues(e),await this.getModel().getDefaultDataSource().insert(e)}else if("editform"===this.getModel().getAttr("newRowMode")){if(!this.getModel().getAttr("itemEditPage"))throw new Error(`[${this.getModel().getFullName()}] itemEditPage is empty`);await this.openPage({name:this.getModel().getAttr("itemEditPage"),newMode:!0,modal:!0})}else if("createform"===this.getModel().getAttr("newRowMode")){if(!this.getModel().getAttr("itemCreatePage"))throw new Error(`[${this.getModel().getFullName()}] itemCreatePage is empty`);await this.openPage({name:this.getModel().getAttr("itemCreatePage"),newMode:!0,modal:!0})}else if("oneclick editform"===this.getModel().getAttr("newRowMode")){if(!this.getModel().getAttr("itemEditPage"))throw new Error(`[${this.getModel().getFullName()}] itemEditPage is empty`);const e={};this.getModel().fillDefaultValues(e);const t=await this.getModel().getDefaultDataSource().insert(e),s=this.getModel().getDefaultDataSource().getAttr("database"),r=this.getModel().getDefaultDataSource().getAttr("table"),[o]=t[s][r].insert;await this.openPage({name:this.getModel().getAttr("itemEditPage"),modal:!0,params:Object.assign({},i.DataSource.keyToParams(o))})}else if("oneclick createform"===this.getModel().getAttr("newRowMode")){if(!this.getModel().getAttr("itemCreatePage"))throw new Error(`[${this.getModel().getFullName()}] itemCreatePage is empty`);const e={};this.getModel().fillDefaultValues(e);const t=await this.getModel().getDefaultDataSource().insert(e),s=this.getModel().getDefaultDataSource().getAttr("database"),r=this.getModel().getDefaultDataSource().getAttr("table"),[o]=t[s][r].insert;await this.openPage({name:this.getModel().getAttr("itemCreatePage"),modal:!0,params:Object.assign({},i.DataSource.keyToParams(o))})}}async edit(e){if(!this.getModel().getAttr("itemEditPage"))throw new Error(`${this.getModel().getFullName()}: itemEditPage is empty`);try{await this.openPage({name:this.getModel().getAttr("itemEditPage"),modal:!0,params:Object.assign({},i.DataSource.keyToParams(e))})}catch(e){throw e.message=`${this.getModel().getFullName()} edit: ${e.message}`,e}}getActiveRow(){const e=this.grid.getActiveRowKey();if(!e)throw new Error(`${this.getModel().getFullName()}: no active row key`);return this.getModel().getDefaultDataSource().getRow(e)}canPrev(){return this.getModel().getDefaultDataSource().getFrame()>1}canNext(){const e=this.getModel().getDefaultDataSource();return e.getFrame()<e.getFramesCount()}getSelectedRowKey(){return this.grid?this.grid.getActiveRowKey():null}isActionEnabled(e){return this.isRowSelected()}getField(e){return this.fields[e]}}t.TableFormController=TableFormController,a.Helper.registerGlobalClass(TableFormController)},315:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormView=void 0;const o=s(997),i=r(s(6689)),a=s(7087),n=s(3677),l=s(7534),c=s(6920),d=s(8978);s(4502);class TableFormView extends a.FormView{constructor(){super(...arguments),this.renderGridCellView=(e,t,s,r)=>{const o=this.getCtrl().getField(t.name);if(!o)throw new Error(`no field: ${t.name}`);return i.default.createElement(o.getViewClass(),{row:e,column:t,onCreate:s,onUnmount:r,ctrl:o})},this.createLinkCallback=e=>this.getCtrl().getApp().getHostApp().createLink(Object.assign({page:this.getCtrl().getModel().getAttr("itemEditPage")},n.DataSource.keyToParams(e)))}renderToolbar(){const e=this.getCtrl(),t=e.getModel(),s=t.getDefaultDataSource();return(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__toolbar flex grid-gap-5`},{children:["disabled"!==t.getData().newRowMode&&(0,o.jsx)(l.Button,Object.assign({classList:["toolbar-button","default"],onClick:e.onNewClick,enabled:!e.getParent().getModel().hasNew()},{children:(0,o.jsx)("div",{children:t.getApp().getText().form.new})}),"new"),"true"===t.getData().refreshButton&&s.isPersistent()&&(0,o.jsx)(l.Button,Object.assign({classList:["toolbar-button"],onClick:e.onRefreshClick,enabled:!e.getParent().getModel().hasNew()},{children:(0,o.jsx)("div",{children:t.getApp().getText().form.refresh})}),"refresh"),"disabled"!==t.getData().deleteRowMode&&(0,o.jsx)(l.Button,Object.assign({classList:["toolbar-button"],onClick:e.onDeleteClick,enabled:e.isRowSelected()},{children:(0,o.jsx)("div",{children:t.getApp().getText().form.delete})}),"delete"),e.getModel().hasActions()&&(0,o.jsx)(l.DropdownButton,Object.assign({classList:["toolbar-dropdown-button"],actions:this.getActionsForDropdownButton(),onClick:this.onActionsClick},{children:(0,o.jsx)(l.MoreVertIcon,{})}))]}))}renderPaging(){const e=this.getCtrl(),t=this.getCtrl().getModel().getDefaultDataSource();return(0,o.jsxs)("div",Object.assign({className:"paging"},{children:[(0,o.jsx)("div",Object.assign({className:"paging__countBlock"},{children:(0,o.jsxs)("span",Object.assign({className:"count"},{children:[t.getRowsLength()," ",t.getLimit()&&`of ${c.Helper.formatNumber(t.getCount())}`]}))})),t.getLimit()&&(0,o.jsxs)("div",Object.assign({className:"paging__gotoBlock"},{children:[(0,o.jsx)(l.Button,Object.assign({enabled:e.canPrev(),onClick:e.onPreviousClick},{children:(0,o.jsx)(l.LeftIcon,{size:18})})),(0,o.jsx)(l.TextBox,{value:e.getModel().getDefaultDataSource().getFrame().toString(),onChange:e.onFrameChanged}),(0,o.jsxs)("div",Object.assign({className:"paging__framesCount"},{children:[" ","/ ",c.Helper.formatNumber(t.getFramesCount())," "]})),(0,o.jsx)(l.Button,Object.assign({enabled:e.canNext(),onClick:e.onNextClick},{children:(0,o.jsx)(l.RightIcon,{size:18})}))]}))]}))}getGridColumns(){const e=this.getCtrl();return Object.keys(e.fields).filter((t=>e.getField(t).isVisible())).map((t=>{const s=e.getField(t);return{name:s.getModel().getName(),title:s.getModel().getCaption(),width:s.getModel().getWidth(),align:s.getAlign()}}))}getRows(){return this.getCtrl().getModel().getDefaultDataSource().getRows()}getGridExtraColumn(){return!0}getGridClass(){return l.Grid}renderGrid(){const e=this.getCtrl();return i.default.createElement(this.getGridClass(),{classList:["flex-max"],onCreate:e.onGridCreate,name:e.getModel().getFullName(),columns:this.getGridColumns(),rows:this.getRows(),getRowKey:t=>e.getModel().getDefaultDataSource().getRowKey(t),onDoubleClick:e.onGridCellDblClick,onDeleteKeyDown:e.onGridDeleteKeyDown,onSelectionChange:e.onGridSelectionChange,onLinkClick:e.onGridLinkClick,renderGridCellView:this.renderGridCellView,updated:e.getUpdated(),extraColumn:this.getGridExtraColumn(),selectedKey:e.getPage().getModel().getOptions().selectedKey,createLinkCallback:this.createLinkCallback})}render(){(0,d.debug)("TableFormView.render",this.getCtrl().getModel().getFullName());const e=this.getCtrl();return(0,o.jsxs)("div",Object.assign({className:`${this.getCssClassNames()} full flex-column grid-gap-5`,style:this.getStyle()},{children:[this.renderToolbar(),this.renderGrid(),e.getModel().hasDefaultPersistentDataSource()&&this.renderPaging()]}))}}t.TableFormView=TableFormView},7111:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelController=void 0;const r=s(1623),o=s(4190),i=s(7534);class ModelController extends r.Controller{constructor(e,t){super(),this.model=e,this.parent=t,this.deinited=!1}init(){}deinit(){if(this.deinited)throw new Error(`${this.getModel().getFullName()}: controller already deinited`);this.deinited=!0}getModel(){return this.model}getParent(){if(!this.parent)throw new Error(`${this.getModel().getFullName()}: no controller parent`);return this.parent}getTitle(){return this.getModel().getCaption()}getViewClass(){const e=this.getModel();if(!e.isAttr("viewClass"))throw new Error(`${this.constructor.name} not supports view`);const t=e.getAttr("viewClass");if(t){const e=i.Helper.getGlobalClass(t);if(!e)throw new Error(`no class ${t}`);if(!(e.prototype instanceof o.ModelView))throw new Error(`view class ${t} is not inherited from ModelView`);return e}return null}isActionEnabled(e){return!1}}t.ModelController=ModelController},4190:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelView=void 0;const r=s(997),o=s(2805),i=s(5106);class ModelView extends o.View{constructor(){super(...arguments),this.renderActionIcon=void 0}getActionsForDropdownButton(){return this.getCtrl().getModel().getCol("actions").map((e=>{const t=i.Model.getName(e);return{name:t,title:this.renderActionIcon?[(0,r.jsx)("div",{children:this.renderActionIcon(t)},"icon"),(0,r.jsx)("div",{children:i.Model.getAttr(e,"caption")},"title")]:i.Model.getAttr(e,"caption"),enabled:this.getCtrl().isActionEnabled(t)}}))}getCssBlockName(){const e=this.getCtrl().getModel();return e.isAttr("cssBlock")&&e.getAttr("cssBlock")?e.getAttr("cssBlock"):super.getCssBlockName()}getStyle(e){}}t.ModelView=ModelView},9409:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageController=void 0;const r=s(7111),o=s(6920),i=s(1423),a=s(3677),n=s(5278),l=s(8324);class PageController extends r.ModelController{constructor(e,t,s){if(super(e,t),this.forms=[],this.onSaveAndCloseClick=async()=>{if(console.debug("PageController.onSaveAndCloseClick"),this.validate(),this.isValid()){try{this.getApp().getView().disableRerender(),await this.getModel().update(),console.debug("page model updated",this.getModel().getFullName())}finally{this.getApp().getView().enableRerender()}await this.getApp().closePage(this),this.getModel().getOptions().onClose&&this.getModel().getOptions().onClose()}else await this.rerender()},this.onClosePageClick=async e=>{console.debug("PageController.onClosePageClick",this.getModel().getFullName()),await this.close()},this.onOpenPageClick=async e=>{const t=this.getModel().getName(),s=this.getModel().getKey(),r=this.createOpenInNewLink(t,s);window.open(r,"_blank")},this.onKeyDown=async e=>{"Escape"===e.key&&this.isModal()&&await this.close()},this.onSelectClick=async e=>{console.debug("PageController.onSelectClick"),await this.selectRow(this.getSelectedRowKey())},this.onResetClick=async e=>{console.debug("PageController.onResetClick"),await this.selectRow(null)},"object"==typeof window&&console.debug(`${this.constructor.name}.constructor`,e,s),!s)throw new Error("no id");this.id=s}static create(e,t,s,r=null){const{ctrlClass:i}=e.getData();if(i){const a=o.Helper.getGlobalClass(i);if(!a)throw new Error(`no class ${i}`);return new a(e,t,s,r)}return new PageController(e,t,s,r)}init(){for(const e of this.getModel().forms){const t=i.FormController.create(e,this);t.init(),this.forms.push(t)}}deinit(){console.debug("PageController.deinit: "+this.getModel().getFullName());for(const e of this.forms)e.deinit();super.deinit()}createOpenInNewLink(e,t){return this.getApp().getHostApp().createLink(Object.assign({page:e},a.DataSource.keyToParams(t)))}async close(){const e=this.isChanged();if(this.getModel().hasRowFormWithDefaultSqlDataSource()&&e){if(!await this.getApp().confirm({message:this.getModel().getApp().getText().form.areYouSure}))return}await this.getApp().closePage(this),this.getModel().getOptions().onClose&&this.getModel().getOptions().onClose()}validate(){for(const e of this.forms)e instanceof n.RowFormController&&e.validate()}isValid(){for(const e of this.forms)if(!e.isValid())return!1;return!0}async onFormChange(e){this.rerender()}onFormDiscard(e){console.debug("PageController.onFormDiscard",this.getModel().getFullName()),this.rerender()}onFormUpdate(e){console.debug("PageController.onFormUpdate:",this.getModel().getFullName(),e),this.rerender()}onFormInsert(e){console.debug("PageController.onFormInsert:",this.getModel().getFullName());for(const e of this.forms)e.invalidate();this.rerender()}async openPage(e){e.params||(e.params={});const t=this.getModel().getParams();for(const s in t)e.params[s]||(e.params[s]=t[s]);return await this.getApp().openPage(e)}isChanged(){for(const e of this.forms)if(e.isChanged())return!0;return!1}getApp(){return this.getParent()}getViewClass(){return super.getViewClass()||l.PageView}findForm(e){return this.forms.find((t=>t.getModel().getName()===e))}getForm(e){const t=this.findForm(e);if(!t)throw new Error(`${this.getModel().getFullName()}: no form controller ${e}`);return t}async onActionClick(e){console.debug("PageController.onActionClick",e)}getTitle(){const e=this.getModel(),t=e.getKey();let s=null;if(t){const e=JSON.parse(t);s=1===e.length&&"number"==typeof e[0]?`#${e[0]}`:`${t}`}return[e.getCaption(),...this.getApp().getHostApp().isDebugMode()?[`(${this.getId()})`]:[],...s?[s]:[]].join(" ")}getSelectedRowKey(){for(const e of this.forms){const t=e.getSelectedRowKey();if(t)return t}return null}async selectRow(e){console.debug("PageController.selectRow",e),await this.close(),await this.getModel().getOptions().onSelect(e)}invalidate(){this.forms.forEach((e=>e.invalidate()))}getId(){return this.id}isModal(){return this.getModel().isModal()}isAutoFocus(){for(const e of this.forms)if(e.isAutoFocus())return!0;return!1}}t.PageController=PageController},8324:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageView=void 0;const o=s(997),i=r(s(6689)),a=s(4190),n=s(7534),l=s(8978);s(6850);class PageView extends a.ModelView{constructor(e){super(e),this.onActionsClick=async e=>{const t=this.getCtrl(),s=e.dataset.action;try{if(!await t.onActionClick(s))throw new Error(`no handler for action '${s}'`)}catch(e){console.error(e),await this.getCtrl().getApp().alert({message:e.message})}},this.checkParent(),this.el=i.default.createRef()}isToolbar(){return this.getCtrl().getModel().hasActions()}getFormTabs(e){return e.map((e=>({name:e.getModel().getName(),title:e.getTitle(),content:this.renderForm(e)})))}getRowForms(){return this.getCtrl().forms.filter((e=>"RowForm"===e.getModel().getClassName())).filter((e=>e.isVisible()))}getTableForms(){return this.getCtrl().forms.filter((e=>"TableForm"===e.getModel().getClassName())).filter((e=>e.isVisible()))}renderForm(e,t={}){return i.default.createElement(e.getViewClass(),Object.assign({parent:this,key:e.getModel().getName(),ctrl:e,onCreate:e.onViewCreate,updated:e.getUpdated()},t))}renderRowForms(){return this.getRowForms().map((e=>this.renderForm(e)))}renderTitle(){const e=this.getCtrl(),t=e.getModel();return(0,o.jsxs)("h1",Object.assign({className:`${this.getCssBlockName()}__title`},{children:[e.getTitle(),t.hasRowFormWithDefaultSqlDataSource()&&(e.isChanged()||t.hasNew())&&[" ",(0,o.jsx)("span",Object.assign({className:`${this.getCssBlockName()}__star`},{children:"*"}),"star")]]}))}renderSelectButton(){const e=this.getCtrl(),t=e.getModel();return(0,o.jsx)(n.Button,Object.assign({classList:["toolbar-button","default"],onClick:e.onSelectClick,enabled:!!e.getSelectedRowKey()},{children:(0,o.jsx)("div",{children:t.getApp().getText().page.select})}))}renderSaveAndCloseButton(){const e=this.getCtrl(),t=e.getModel();return(0,o.jsx)(n.Button,Object.assign({classList:["toolbar-button","default"],onClick:e.onSaveAndCloseClick,enabled:e.isValid()&&(t.hasNew()||e.isChanged())},{children:(0,o.jsx)("div",{children:t.getApp().getText().page.saveAndClose})}))}renderCloseButton(){const e=this.getCtrl(),t=e.getModel();return(0,o.jsx)(n.Button,Object.assign({classList:["toolbar-button"],onClick:e.onClosePageClick},{children:(0,o.jsx)("div",{children:t.getApp().getText().page.close})}))}renderActionsDropdownButton(){return(0,o.jsx)(n.DropdownButton,Object.assign({classList:["toolbar-dropdown-button"],actions:this.getActionsForDropdownButton(),onClick:this.onActionsClick},{children:(0,o.jsx)(n.MoreVertIcon,{})}))}renderToolbar(){const e=this.getCtrl().getModel();return(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__toolbar`},{children:e.hasActions()&&this.renderActionsDropdownButton()}))}renderTableForms(){const e=this.getTableForms();return 1===e.length?this.renderForm(e[0]):(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__table-forms flex-max frame`},{children:(0,o.jsx)("div",Object.assign({className:"frame__container"},{children:(0,o.jsx)(n.Tab2,{tabs:this.getFormTabs(e),classList:["Tab-blue","full"]})}))}))}renderOpenPageHeaderButton(){const e=this.getCtrl();return(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__open`,onClick:e.onOpenPageClick},{children:(0,o.jsx)(n.OpenInNewIcon,{})}),"open")}renderClosePageHeaderButton(){const e=this.getCtrl();return(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__close`,onClick:e.onClosePageClick},{children:(0,o.jsx)(n.CloseIcon2,{})}),"close")}renderHeader(){const e=this.getCtrl().getModel();return(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__header`},{children:[this.renderTitle(),e.isModal()&&[...e.getKey()?[this.renderOpenPageHeaderButton()]:[],this.renderClosePageHeaderButton()]]}))}renderMain(){return(0,o.jsx)("div",Object.assign({className:`${this.getCssBlockName()}__main flex-max frame`},{children:(0,o.jsxs)("div",Object.assign({className:"frame__container flex-column grid-gap-10"},{children:[this.isToolbar()&&this.renderToolbar(),this.getCtrl().getModel().isFormInTab()?this.renderForms2():this.renderForms()]}))}))}renderForms(){const e=this.getCtrl().getModel();return[...e.hasRowForm()?[this.renderRowForms()]:[],...e.hasTableForm()?[this.renderTableForms()]:[]]}renderForms2(){return(0,o.jsx)(n.Tab2,{tabs:this.getFormTabs(this.getCtrl().forms.filter((e=>e.isVisible()))),classList:["Tab-blue","full"]})}renderFooter(){const e=this.getCtrl().getModel();return(0,o.jsxs)("div",Object.assign({className:`${this.getCssBlockName()}__footer`},{children:[this.renderCloseButton(),e.isModal()&&e.hasRowFormWithDefaultSqlDataSource()&&this.renderSaveAndCloseButton(),e.isSelectMode()&&this.renderSelectButton()]}))}render(){return(0,l.debug)("PageView.render",this.getCtrl().getModel().getFullName()),(0,o.jsxs)("div",Object.assign({className:`${this.getCssClassNames()} ${this.getCtrl().isModal()?"":"full"} flex-column`,style:this.getStyle(),ref:this.el,tabIndex:0,onKeyDown:this.getCtrl().onKeyDown},{children:[this.renderHeader(),this.renderMain(),this.getCtrl().isModal()&&this.renderFooter()]}))}getStyle(){if(this.getCtrl().isModal())return{width:1e3,height:750}}componentDidMount(){this.getCtrl().isAutoFocus()&&!this.getCtrl().getModel().getKey()||this.focus()}focus(){this.getElement()?this.getElement().focus():console.error(`${this.getCtrl().getModel().getFullName()}: el is null (ref={this.el})`)}}t.PageView=PageView},2805:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;const r=s(7534);class View extends r.ReactComponent{constructor(e){if(super(e),!e.ctrl)throw new Error(`${this.constructor.name}: no ctrl`)}getCtrl(){return this.props.ctrl}}t.View=View},3375:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(2783),t),o(s(8324),t),o(s(5278),t),o(s(4157),t),o(s(8617),t),o(s(9409),t),o(s(5598),t),o(s(9952),t),o(s(2833),t),o(s(8518),t),o(s(8710),t),o(s(765),t),o(s(7470),t),o(s(2266),t),o(s(8755),t),o(s(5596),t),o(s(1459),t),o(s(4105),t),o(s(6925),t),o(s(4898),t),o(s(4691),t),o(s(8054),t),o(s(4547),t),o(s(5796),t),o(s(2293),t),o(s(9992),t),o(s(7789),t),o(s(5501),t),o(s(2686),t),o(s(315),t),o(s(1249),t),o(s(6471),t),o(s(3910),t),o(s(5417),t),o(s(3809),t),o(s(9234),t),o(s(4407),t),o(s(2221),t),o(s(9900),t),o(s(1008),t),o(s(9106),t),o(s(9699),t),o(s(7881),t),o(s(6035),t)},5982:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;t.EventEmitter=class EventEmitter{constructor(){this.list={}}on(e,t){this.list[e]||(this.list[e]=[]),this.list[e].push(t)}off(e,t){const s=this.list[e].indexOf(t);if(-1===s)throw new Error(`cannot find cb for ${e}`);this.list[e].splice(s,1)}async emit(e,t){if(this.list[e]&&this.list[e].length){const s=await Promise.allSettled(this.list[e].map((e=>e(t))));for(const e of s)if("rejected"===e.status)throw e.reason}}}},9274:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginFrontHostApp=void 0;const r=s(1459),o=s(7534);class LoginFrontHostApp extends o.FrontHostApp{constructor(e){console.debug("LoginFrontHostApp.constructor",e),super(),this.data=e}async run(){console.debug("LoginFrontHostApp.run");const e=r.LoginController.create(this),t=document.querySelector(`.${e.getViewClassCssBlockName()}__root`);if(!t)throw new Error("no root element");o.Helper.createReactComponent(t,e.getViewClass(),{ctrl:e})}getText(){return this.data.text}getData(){return this.data}}t.LoginFrontHostApp=LoginFrontHostApp,o.Helper.registerGlobalClass(LoginFrontHostApp)},7274:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Application=void 0;const r=s(5106),o=s(8954),i=s(7534),a=s(6920);class Application extends r.Model{constructor(e){super(e),this.databases=[],this.dataSources=[]}init(){if(!this.getData().theme)throw new Error("no theme attr");this.createDatabases(),this.createDataSources()}createDatabases(){for(const e of this.getData().databases){const t=new o.Database(e,this);t.init(),this.addDatabase(t)}}deinit(){this.deinitDataSources(),super.deinit()}addDatabase(e){this.databases.push(e)}async logout(){await this.request("POST",{action:"logout"});this.emit("logout",{source:this})}async request(e,t){const s=Date.now(),[r,o]=await i.FrontHostApp.doHttpRequest2(e,t);if(!r["qforms-platform-version"])throw new Error("no qforms-platform-version header");return this.emit("request",{time:Date.now()-s,remotePlatformVersion:r["qforms-platform-version"],remoteAppVersion:r["qforms-app-version"]||null}),o}findDatabase(e){return this.databases.find((t=>t.getName()===e))}getDatabase(e){const t=this.findDatabase(e);if(!t)throw new Error(`no database: ${e}`);return t}getText(){return this.getData().text}getUser(){return this.getData().user}getDomain(){return this.getAttr("domain")}getVirtualPath(){return this.getData().virtualPath}async rpc(e,t){if(console.debug("Application.rpc",this.getFullName(),e,t),!e)throw new Error("no name");const s=await this.request("POST",{action:"rpc",name:e,params:t,uuid:this.getAttr("uuid")});if(s.errorMessage)throw new Error(s.errorMessage);return s}emitResult(e,t){console.debug("Application.emitResult",e,t);const s=[];for(const r in e)s.push(...this.getDatabase(r).emitResult(e[r],t));return Promise.allSettled(s)}getNodeEnv(){return this.getData().nodeEnv}isDevelopment(){return"development"===this.getNodeEnv()}getRoute(){return this.getAttr("route")}}t.Application=Application,a.Helper.registerGlobalClass(Application)},7340:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Column=void 0;const r=s(5106),o=s(6920);class Column extends r.Model{constructor(e,t){if(super(e,t),!this.getAttr("type"))throw new Error(`column ${this.getFullName()}: no type`);if(!["string","number","boolean","object","date"].includes(this.getAttr("type")))throw new Error(`${this.getFullName()}: wrong column type: ${this.getAttr("type")}`)}init(){}getType(){return this.getAttr("type")}}t.Column=Column,o.Helper.registerGlobalClass(Column)},3677:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSource=void 0;const r=s(5106),o=s(1002),i=s(5377),a=s(7274),n=s(7534),l=s(2855),c=s(5518),d=s(8978);class DataSource extends r.Model{constructor(e,t){super(e,t),this.rows=null,this.rowsByKey=null,this.news=[],this.changes=new Map,this.frame=1,this.count=null,this.lastFrame=1,this.onTableInsert=async e=>{if(this.deinited)throw new Error(`${this.getFullName()}: this data source deinited for onTableUpdate`);if(e.source!==this){if(console.debug("DataSource.onTableInsert",this.getFullName(),e),!e.inserts.length)throw new Error(`${this.getFullName()}: no inserts`);for(const t of e.inserts){if(this.getRow(t))throw console.debug("rows:",this.rows),console.debug("rowsByKey:",this.rowsByKey),new Error(`${this.getFullName()}: row already in this data source: ${t}`);const s=e.source.getRow(t),r={};DataSource.copyNewValues(r,s),this.addRow(r)}this.getParent()instanceof o.Form&&this.getForm().onDataSourceInsert(e),this.emit("insert",e)}},this.onTableUpdate=async e=>{if(this.deinited)throw new Error(`${this.getFullName()}: this data source deinited for onTableUpdate`);if(e.source!==this){if(console.debug("DataSource.onTableUpdate",this.getFullName(),e),!Object.keys(e.updates).length)throw new Error(`${this.getFullName()}: no updates`);for(const t in e.updates)if(this.getRow(t)){const s=e.updates[t],r=e.source.getRow(s);this.updateRow(t,r)}this.getParent()instanceof o.Form&&this.getForm().onDataSourceUpdate(e),this.emit("update",e)}},this.onTableDelete=async e=>{if(this.deinited)throw new Error(`${this.getFullName()}: this data source deinited for onTableDelete`);if(e.source!==this){if(console.debug("DataSource.onTableDelete",this.getFullName(),e),!e.deletes.length)throw new Error(`${this.getFullName()}: no deletes`);for(const t of e.deletes)this.getRow(t)&&this.removeRow(t);this.getParent()instanceof o.Form&&this.getForm().onDataSourceDelete(e),this.emit("delete",e)}},this.onTableRefresh=async e=>{throw new Error("DataSource.onTableRefresh: not implemented")},void 0!==e.count&&(this.count=e.count)}init(){if(this.setRows(this.getData().rows),this.getAttr("table")){const e=this.getTable();e.on("insert",this.onTableInsert),e.on("update",this.onTableUpdate),e.on("delete",this.onTableDelete),e.on("refresh",this.onTableRefresh)}}deinit(){if(this.getAttr("table")){const e=this.getTable();e.off("insert",this.onTableInsert),e.off("update",this.onTableUpdate),e.off("delete",this.onTableDelete),e.off("refresh",this.onTableRefresh)}super.deinit()}setRows(e){this.rows=e,this.fillRowsByKey()}addRow(e){this.rows.push(e);const t=this.getRowKey(e);this.rowsByKey[t]=e}addRows(e){for(let t=0;t<e.length;t++)this.rows.push(e[t]);this.fillRowsByKey()}getRowsLength(){return this.rows.length}fillRowsByKey(){this.rowsByKey={};for(let e=0;e<this.rows.length;e++){const t=this.rows[e],s=this.getRowKey(t);this.rowsByKey[s]=t}}discardRowColumn(e,t){this.changes.has(e)&&void 0!==this.changes.get(e)[t]&&delete this.changes.get(e)[t]}changeRowColumn(e,t,s){this.changes.has(e)||this.changes.set(e,{}),this.changes.get(e)[t]=s}setValue(e,t,s){if(void 0===s)throw new Error(`${this.getFullName()}: undefined is wrong value for data source`);if("object"==typeof s&&null!==s)throw new Error(`setValue: ${this.getFullName()}.${t}: object must be in JSON format`);e[t]!==s?(this.changeRowColumn(e,t,s),void 0===e[t]&&null===s&&this.discardRowColumn(e,t)):this.discardRowColumn(e,t),this.changes.has(e)&&!Object.keys(this.changes.get(e)).length&&this.changes.delete(e)}isChanged(){return!!this.changes.size}hasNew(){return!!this.news.length}isRowColumnChanged(e,t){return e[t]!==this.getValue(e,t)}getValue(e,t){let s;if(s=this.changes.has(e)&&void 0!==this.changes.get(e)[t]?this.changes.get(e)[t]:e[t],void 0!==s&&"string"!=typeof s)throw new Error(`getValue: ${this.getFullName()}.${t}: object must be in JSON format, value: ${s}`);return s}getKeyValues(e){return this.getData().keyColumns.reduce(((t,s)=>(t[s]=JSON.parse(e[s]),t)),{})}getRowKey(e){const t=[];for(const s of this.getData().keyColumns){if(void 0===e[s])return null;if(null===e[s])throw new Error("wrong value null for data source value");try{const r=JSON.parse(e[s]);t.push(r)}catch(t){throw console.debug("getRowKey: cannot parse: ",e[s]),t}}return(0,l.keyTupleToKey)(t)}removeRow(e){const t=this.getRow(e);if(!t)throw new Error(`${this.getFullName()}: no row with key ${e} to remove`);const s=this.rows.indexOf(t);if(-1===s)throw new Error(`${this.getFullName()}: no row with i ${s} to remove`);this.rows.splice(s,1),delete this.rowsByKey[e]}newRow(e){if(console.debug("DataSource.newRow",this.getFullName(),e),this.rows.length>0)throw new Error("rows can be added to empty data sources only in new mode");this.news.push(e)}getSingleRow(e=!1){if(this.news[0])return this.news[0];const t=this.rows[0];if(!t)throw new Error("no single row");return e?this.getRowWithChanges(t):t}getForm(){return this.getParent()instanceof o.Form?this.getParent():null}getPage(){return this.getParent()instanceof o.Form?this.getParent().getParent():this.getParent()instanceof i.Page?this.getParent():null}getApp(){if((0,d.debug)("DataSource.getApp",this.getFullName()),this.getParent()instanceof a.Application)return this.getParent();if(this.getParent()instanceof i.Page)return this.getParent().getParent();if(this.getParent()instanceof o.Form)return this.getParent().getParent().getParent();if(this.getParent()instanceof c.Field)return this.getParent().getParent().getParent().getParent();throw new Error(`unknown parent: ${this.getParent().constructor.name}(${this.getParent().getFullName()})`)}getRow(e){return this.rowsByKey[e]||null}getRows(){if(!this.rows)throw new Error("no rows");return this.rows}getRowByIndex(e){return this.rows[e]}discard(){if(console.debug("DataSource.discard",this.getFullName()),!this.isChanged())throw new Error(`no changes in data source ${this.getFullName()}`);this.changes.clear()}static keyToParams(e,t="key"){if("string"!=typeof e)throw new Error("key not string");const s={},r=JSON.parse(e);if(1===r.length)s[t]=r[0];else{if(!(r.length>1))throw new Error(`invalid key: ${e}`);for(let e=0;e<r.length;e++)s[`${t}${e+1}`]=r[e]}return s}getChangesByKey(){const e={};for(const t of this.changes.keys())e[this.getRowKey(t)]=this.changes.get(t);return e}getRowWithChanges(e){return this.changes.has(e)?Object.assign(Object.assign({},e),this.changes.get(e)):e}hasNewRows(){return this.news.length>0}static copyNewValues(e,t){for(const s in t)e[s]=t[s]}updateRow(e,t){if(console.debug("DataSource.updateRow",this.getFullName(),e,t),!e)throw new Error("no key");const s=this.getRow(e);if(!s)throw new Error(`${this.getFullName()}: no row with key ${e}`);const r=this.getRowKey(t);DataSource.copyNewValues(s,t),e!==r&&(delete this.rowsByKey[e],this.rowsByKey[r]=s)}getTable(){if(!this.getAttr("table"))throw new Error(`${this.getFullName()}: table attr empty`);return this.getDatabase().getTable(this.getAttr("table"))}getDatabase(){if(!this.getAttr("database"))throw new Error(`${this.getFullName()}: database attr empty`);return this.getApp().getDatabase(this.getAttr("database"))}getType(e){return this.getTable().getColumn(e).getType()}async insert(e){if(console.debug("DataSource.insert",this.news),!this.news.length)throw new Error("no new rows to insert");const t=[];for(const e of this.news){const s=this.getRowWithChanges(e);DataSource.copyNewValues(e,s);const r=this.getRowKey(e);if(!r)throw new Error("invalid insert row, no key");t.push(r)}this.changes.clear();for(const e of this.news)this.addRow(e);this.news=[],console.debug("rows:",this.getRows()),console.debug("inserts:",t),this.getParent()instanceof o.Form&&this.getForm().onDataSourceInsert({source:this,inserts:t}),this.emit("insert",{source:this,inserts:t});const s=this.getAttr("database"),r=this.getAttr("table");if(s&&r){const e={[s]:{[r]:{insert:t}}};return await this.getApp().emitResult(e,this),e}return null}async delete(e){if(console.debug("DataSource.delete",e),!e)throw new Error("no key");this.removeRow(e);const t=[e];this.getParent()instanceof o.Form&&this.getForm().onDataSourceDelete({source:this,deletes:t}),this.emit("delete",{source:this,deletes:t});const s=this.getAttr("database"),r=this.getAttr("table");if(s&&r){const e={[s]:{[r]:{delete:t}}};return await this.getApp().emitResult(e,this),e}return null}async update(){if(console.debug("DataSource.update",this.getFullName()),this.news.length)return await this.insert(),null;if(!this.changes.size)throw new Error(`no changes: ${this.getFullName()}`);const e=this.getChangesByKey(),t={};for(const s in e){const e=this.getRow(s),r=this.getRowWithChanges(e),o=this.getRowKey(r);this.updateRow(s,r),t[s]=o}this.changes.clear(),this.getParent()instanceof o.Form&&this.getForm().onDataSourceUpdate({source:this,updates:t}),this.emit("update",{source:this,updates:t});const s=this.getAttr("database"),r=this.getAttr("table");if(s&&r){const e={[s]:{[r]:{update:t}}};return await this.getApp().emitResult(e,this),e}return null}isSurrogate(){return this.isAttr("database")}moveRow(e,t){console.debug("DataSource.moveRow"),n.Helper.moveArrItem(this.rows,e,t);const s={source:this};this.getParent()instanceof o.Form&&this.getForm().onDataSourceRefresh(s),this.emit("refresh",s)}getLimit(){return this.getAttr("limit")?parseInt(this.getAttr("limit")):null}getCount(){if(null===this.count)throw new Error(`${this.getFullName()}: no count info`);return this.count}getFrame(){return this.frame}getLastFrame(){return this.lastFrame}setFrame(e){this.frame=e}getFramesCount(){if(null===this.count)throw new Error(`${this.getFullName()}: no count info`);return 0===this.count?1:this.getLimit()?Math.ceil(this.count/this.getLimit()):1}hasMore(){return this.lastFrame<this.getFramesCount()}isPersistent(){return!1}async refresh(){throw new Error("DataSource.refresh not implemented")}}t.DataSource=DataSource,n.Helper.registerGlobalClass(DataSource)},2693:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoSqlDataSource=void 0;const r=s(8341),o=s(6920);class NoSqlDataSource extends r.PersistentDataSource{}t.NoSqlDataSource=NoSqlDataSource,o.Helper.registerGlobalClass(NoSqlDataSource)},8341:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PersistentDataSource=void 0;const r=s(3677),o=s(1002);class PersistentDataSource extends r.DataSource{constructor(){super(...arguments),this.onTableUpdate=async e=>{if(console.debug("PersistentDataSource.onTableUpdate",this.getFullName(),e),this.deinited)throw new Error(`${this.getFullName()}: this data source deinited for onTableUpdate`);if(e.source!==this){if(!Object.keys(e.updates).length)throw new Error(`${this.getFullName()}: no updates`);await this.refill(),this.getParent()instanceof o.Form&&this.getForm().onDataSourceUpdate(e),this.emit("update",e)}},this.onTableInsert=async e=>{if(console.debug("PersistentDataSource.onTableInsert",this.getFullName(),e),this.deinited)throw new Error(`${this.getFullName()}: this data source deinited for onTableInsert`);e.source!==this&&(await this.refill(),this.getParent()instanceof o.Form&&this.getForm().onDataSourceInsert(e),this.emit("insert",e))},this.onTableDelete=async e=>{if(console.debug("PersistentDataSource.onTableDelete",this.getFullName(),e),this.deinited)throw new Error(`${this.getFullName()}: this data source deinited for onTableDelete`);e.source!==this&&(await this.refill(),this.getParent()instanceof o.Form&&this.getForm().onDataSourceDelete(e),this.emit("delete",e))},this.onTableRefresh=async e=>{if(console.debug("PersistentDataSource.onTableRefresh",this.getFullName(),e),this.deinited)throw new Error(`${this.getFullName()}: this data source deinited for onTableDelete`);if(e.source)throw new Error("refresh is foreign result so source must be null");await this.refill(),this.getParent()instanceof o.Form&&this.getForm().onDataSourceRefresh(e),this.emit("refresh",e)}}async insert(e){console.debug("PersistentDataSource.insert",e);const t=this.getAttr("database"),s=this.getAttr("table");if(""===s)throw new Error("no data source table to insert");const r=await this.getApp().request("POST",{action:"insert",uuid:this.getApp().getAttr("uuid"),page:this.getForm().getPage().getName(),form:this.getForm().getName(),row:this.getRowWithChanges(e)}),[i]=Object.keys(r[t][s].insertEx);if(!i)throw new Error("no inserted row key");const a=r[t][s].insertEx[i];for(const t in a)e[t]=a[t];this.news.splice(this.news.indexOf(e),1),this.changes.clear(),this.addRow(e);const n={source:this,inserts:r[t][s].insert};return this.getParent()instanceof o.Form&&this.getForm().onDataSourceInsert(n),this.emit("insert",n),await this.getApp().emitResult(r,this),r}async update(){console.debug("PersistentDataSource.update",this.getFullName());const e=this.getAttr("database"),t=this.getAttr("table");if(""===t)throw new Error("no data source table to update");if(this.news[0])return await this.insert(this.news[0]);if(!this.changes.size)throw new Error(`no changes: ${this.getFullName()}`);const s=await this.getApp().request("POST",{action:"update",uuid:this.getApp().getAttr("uuid"),page:this.getForm().getPage().getName(),form:this.getForm().getName(),changes:this.getChangesByKey()}),[r]=Object.keys(s[e][t].updateEx);if(!r)throw new Error("no updated row");const i=s[e][t].updateEx[r];this.changes.clear(),this.updateRow(r,i);const a={source:this,updates:s[e][t].update};return this.getParent()instanceof o.Form&&this.getForm().onDataSourceUpdate(a),this.emit("update",a),await this.getApp().emitResult(s,this),s}async delete(e){if(console.debug("PersistentDataSource.delete:",this.getFullName(),e),!e)throw new Error("no key");const t=this.getAttr("database"),s=this.getAttr("table");if(!s)throw new Error(`no table in data source: ${this.getFullName()}`);const r=await this.getApp().request("POST",{action:"_delete",uuid:this.getApp().getAttr("uuid"),page:this.getForm().getPage().getName(),form:this.getForm().getName(),params:{key:e}});await this.refill();const i={source:this,deletes:r[t][s].delete};return this.getParent()instanceof o.Form&&this.getForm().onDataSourceDelete(i),this.emit("delete",i),await this.getApp().emitResult(r,this),r}getPageParams(){const e=this.getPage();return e?e.getParams():{}}async refresh(){console.debug("PersistentDataSource.refresh",this.getFullName()),await this.refill(),this.getParent()instanceof o.Form&&this.getForm().onDataSourceRefresh({source:this})}async refill(){if(console.debug("PersistentDataSource.refill",this.getFullName()),this.isChanged())throw new Error(`cannot refill changed data source: ${this.getFullName()}`);const e=await this.select(this.getLimit()?{frame:this.frame}:{});this.count=e.count,this.setRows(e.rows),this.lastFrame=1}async fill(e){if(this.isChanged())throw new Error(`cannot fill changed data source: ${this.getFullName()}`);const t=await this.select(this.getLimit()?{frame:e}:{});this.count=t.count,this.addRows(t.rows)}async more(){if(!this.hasMore())throw new Error(`${this.getFullName()}: no more rows`);this.lastFrame++,await this.fill(this.lastFrame)}async select(e={}){console.debug("PersistentDataSource.select",this.getFullName(),e);const t=this.getPage(),s=this.getForm(),r=await this.getApp().request("POST",{action:"select",page:t?t.getName():null,form:s?s.getName():null,ds:this.getName(),params:Object.assign(Object.assign({},this.getPageParams()),e)});if(!(r.rows instanceof Array))throw new Error("rows must be array");return r}isPersistent(){return!0}}t.PersistentDataSource=PersistentDataSource},2751:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SqlDataSource=void 0;const r=s(8341),o=s(6920);class SqlDataSource extends r.PersistentDataSource{}t.SqlDataSource=SqlDataSource,o.Helper.registerGlobalClass(SqlDataSource)},8954:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Database=void 0;const r=s(5106),o=s(1166),i=s(6920);class Database extends r.Model{constructor(){super(...arguments),this.tables=[]}init(){for(const e of this.getData().tables){const t=new o.Table(e,this);t.init(),this.addTable(t)}}addTable(e){this.tables.push(e)}findTable(e){return this.tables.find((t=>t.getName()===e))}getTable(e){const t=this.findTable(e);if(!t)throw new Error(`${this.getFullName()}: no table with name: ${e}`);return t}emitResult(e,t=null){console.debug("Database.emitResult");const s=[];for(const r in e)s.push(...this.getTable(r).emitResult(e[r],t));return s}}t.Database=Database,i.Helper.registerGlobalClass(Database)},4926:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckBoxField=void 0;const r=s(5518),o=s(6920);class CheckBoxField extends r.Field{}t.CheckBoxField=CheckBoxField,o.Helper.registerGlobalClass(CheckBoxField)},3861:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckBoxListField=void 0;const r=s(5518),o=s(7534);class CheckBoxListField extends r.Field{getDisplayValue(e){let t=null;if(e[this.getData().displayColumn])try{t=o.Helper.decodeValue(e[this.getData().displayColumn])}catch(t){throw console.debug("cannot parse:",e[this.getData().displayColumn]),t}else t=this.getData().displayColumn,t=t.replace(/\{([\w\.]+)\}/g,((t,s)=>e.hasOwnProperty(s)?e[s]||"":t));return t}getValueValue(e){if(!e[this.getData().valueColumn])throw new Error("no valueColumn in CheckBoxList data source");return o.Helper.decodeValue(e[this.getData().valueColumn])}getDataSource(){const e=this.getData().dataSourceName;if(!e)throw new Error(`${this.getFullName()}: no dataSourceName`);if(this.getForm().findDataSource(e))return this.getForm().getDataSource(e);if(this.getPage().findDataSource(e))return this.getPage().getDataSource(e);if(this.getApp().findDataSource(e))return this.getApp().getDataSource(e);throw new Error(`${this.getFullName()}: no data source: ${e}`)}findRowByRawValue(e){return this.getDataSource().getRows().find((t=>t[this.getData().valueColumn]===e))}}t.CheckBoxListField=CheckBoxListField,o.Helper.registerGlobalClass(CheckBoxListField)},9362:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComboBoxField=void 0;const r=s(5518),o=s(7534);class ComboBoxField extends r.Field{getDisplayValue(e){let t=null;if(e[this.getData().displayColumn])try{t=o.Helper.decodeValue(e[this.getData().displayColumn])}catch(t){throw console.debug("cannot parse:",e[this.getData().displayColumn]),t}else t=this.getData().displayColumn,t=t.replace(/\{([\w\.]+)\}/g,((t,s)=>e.hasOwnProperty(s)?e[s]||"":t));return t}getValueValue(e){if(!e[this.getData().valueColumn])throw new Error("no valueColumn in ComboBox data source");return o.Helper.decodeValue(e[this.getData().valueColumn])}getComboBoxDataSource(){const e=this.getData().dataSourceName;if(!e)throw new Error(`${this.getFullName()}: no dataSourceName`);if(this.getForm().findDataSource(e))return this.getForm().getDataSource(e);if(this.getPage().findDataSource(e))return this.getPage().getDataSource(e);if(this.getApp().findDataSource(e))return this.getApp().getDataSource(e);throw new Error(`${this.getFullName()}: no data source: ${e}`)}findRowByRawValue(e){return this.getComboBoxDataSource().getRows().find((t=>t[this.getData().valueColumn]===e))}}t.ComboBoxField=ComboBoxField,o.Helper.registerGlobalClass(ComboBoxField)},1839:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DateField=void 0;const r=s(5518),o=s(7534);class DateField extends r.Field{getFormat(){return this.getAttr("format")}rawToValue(e){const t=o.Helper.decodeValue(e);return t&&"false"===this.getAttr("timezone")&&o.Helper.addTimezoneOffset(t),t}valueToRaw(e){let t;if(e&&"false"===this.getAttr("timezone")){const s=o.Helper.cloneDate(e);o.Helper.removeTimezoneOffset(s),t=o.Helper.encodeValue(s)}else t=o.Helper.encodeValue(e);return t}}t.DateField=DateField,o.Helper.registerGlobalClass(DateField)},962:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DateTimeField=void 0;const r=s(5518),o=s(7534);class DateTimeField extends r.Field{getFormat(){return this.getAttr("format")}rawToValue(e){const t=o.Helper.decodeValue(e);return t&&"false"===this.getAttr("timezone")&&o.Helper.addTimezoneOffset(t),t}valueToRaw(e){let t;if(e&&"false"===this.getAttr("timezone")){const s=o.Helper.cloneDate(e);o.Helper.removeTimezoneOffset(s),t=o.Helper.encodeValue(s)}else t=o.Helper.encodeValue(e);return t}}t.DateTimeField=DateTimeField,o.Helper.registerGlobalClass(DateTimeField)},5518:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Field=void 0;const Model_1=__webpack_require__(5106),common_1=__webpack_require__(7534),RowForm_1=__webpack_require__(4169);class Field extends Model_1.Model{init(){}replaceThis(e){return e.replace(/\{([@\w\.]+)\}/g,((e,t)=>{if(-1===t.indexOf("."))return e;let s=t.split(".");return"this"===s[0]&&(s[0]=this.getPage().getName()),`{${s.join(".")}}`}))}fillDefaultValue(row){const column=this.getAttr("column");if(!column)return;const defaultValue=this.replaceThis(this.getAttr("defaultValue")),js=common_1.Helper.templateToJsString(defaultValue,this.getPage().getParams());if("string"!=typeof js)throw new Error(`${this.getFullName()}: defaultValue must be templated to js string`);try{const value=eval(js);void 0!==value&&(row[column]=this.valueToRaw(value))}catch(e){throw new Error(`[${this.getFullName()}] fillDefaultValue: ${e.toString()}`)}}valueToPageParams(e){if(this.isParam()){const t=this.getValue(e),s=this.valueToRaw(t),r=void 0!==s?common_1.Helper.decodeValue(s):void 0;this.getPage().setParam(this.getFullName(),r)}}isChanged(e){if(!this.getAttr("column"))throw new Error(`${this.getFullName()}: field has no column`);return this.getDefaultDataSource().isRowColumnChanged(e,this.getAttr("column"))}hasColumn(){return!!this.getAttr("column")}getValue(row){if(!row&&this.getParent()instanceof RowForm_1.RowForm&&(row=this.getForm().getRow()),!row)throw new Error(`${this.getFullName()}: need row`);let rawValue;if(this.getAttr("column"))rawValue=this.getRawValue(row);else{if(!this.getAttr("value"))throw new Error(`${this.getFullName()}: no column and no value in field`);{const js=this.getAttr("value");try{rawValue=eval(js)}catch(e){throw console.error(e),new Error(`${this.getFullName()}: value eval error: ${e.message}`)}}}if(void 0!==rawValue){if(null===rawValue)throw new Error(`[${this.getFullName()}]: null is wrong raw value`);try{return this.rawToValue(rawValue)}catch(e){throw console.debug("raw value decode error:",this.getFullName(),rawValue),e}}}setValue(e,t){if(!this.getAttr("column"))throw new Error(`field has no column: ${this.getFullName()}`);const s=this.valueToRaw(t);this.getForm().getDefaultDataSource().setValue(e,this.getAttr("column"),s),this.valueToPageParams(e)}rawToValue(e){return common_1.Helper.decodeValue(e)}valueToRaw(e){return common_1.Helper.encodeValue(e)}getRawValue(e){if(!this.hasColumn())throw new Error(`${this.getFullName()}: no column`);return this.getForm().getDefaultDataSource().getValue(e,this.getAttr("column"))}getDefaultDataSource(){return this.getForm().getDefaultDataSource()}getType(){if(this.getAttr("type"))return this.getAttr("type");if(this.getAttr("column")){const e=this.getDefaultDataSource();if(e.isSurrogate())return e.getType(this.getAttr("column"));throw new Error("field type empty")}throw new Error("field type and column empty")}getForm(){return this.getParent()}getPage(){return this.getForm().getPage()}getApp(){return this.getForm().getApp()}isReadOnly(){return"true"===this.getData().readOnly}isNotNull(){return"true"===this.getData().notNull}isNullable(){return"false"===this.getData().notNull}getWidth(){const e=parseInt(this.getData().width);return isNaN(e)?null:0===e?100:e}getFullName(){return`${this.getPage().getName()}.${this.getForm().getName()}.${this.getName()}`}isParam(){return"true"===this.getData().param}validateOnChange(){return void 0===this.getData().validateOnChange||"true"===this.getData().validateOnChange}validateOnBlur(){return void 0!==this.getData().validateOnBlur&&"true"===this.getData().validateOnBlur}getCaption(){const e=this.getAttr("caption");if(""===e){const e=this.getAttr("column");if(e&&this.getForm().hasDefaultPersistentDataSource()){const t=this.getForm().getDataSource("default");if(t.getAttr("table")){return t.getTable().getColumn(e).getCaption()}}}return e}}exports.Field=Field},5220:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileField=void 0;const r=s(5518),o=s(7534);class FileField extends r.Field{}t.FileField=FileField,o.Helper.registerGlobalClass(FileField)},1709:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkField=void 0;const r=s(5518),o=s(7534);class LinkField extends r.Field{}t.LinkField=LinkField,o.Helper.registerGlobalClass(LinkField)},7606:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordField=void 0;const r=s(5518),o=s(7534);class PasswordField extends r.Field{}t.PasswordField=PasswordField,o.Helper.registerGlobalClass(PasswordField)},1410:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneField=void 0;const r=s(5518),o=s(7534);class PhoneField extends r.Field{}t.PhoneField=PhoneField,o.Helper.registerGlobalClass(PhoneField)},8446:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RadioField=void 0;const r=s(5518),o=s(7534);class RadioField extends r.Field{getDisplayValue(e){const t=this.getAttr("displayColumn");let s=null;if(e[t])try{s=o.Helper.decodeValue(e[t])}catch(s){throw console.debug("cannot parse:",e[t]),s}else s=t,s=s.replace(/\{([\w\.]+)\}/g,((t,s)=>e.hasOwnProperty(s)?e[s]||"":t));return s}getValueValue(e){const t=this.getAttr("valueColumn");if(!e[t])throw new Error("no valueColumn in ComboBox data source");return o.Helper.decodeValue(e[t])}getDataSource(){const e=this.getAttr("dataSourceName");if(!e)throw new Error(`${this.getFullName()}: no dataSourceName`);if(this.getForm().findDataSource(e))return this.getForm().getDataSource(e);if(this.getPage().findDataSource(e))return this.getPage().getDataSource(e);if(this.getApp().findDataSource(e))return this.getApp().getDataSource(e);throw new Error(`${this.getFullName()}: no data source: ${e}`)}findRowByRawValue(e){const t=this.getAttr("valueColumn");return this.getDataSource().getRows().find((s=>s[t]===e))}}t.RadioField=RadioField,o.Helper.registerGlobalClass(RadioField)},4769:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextAreaField=void 0;const r=s(5518),o=s(7534);class TextAreaField extends r.Field{getRows(){return this.getData().rows}getCols(){return this.getData().cols}}t.TextAreaField=TextAreaField,o.Helper.registerGlobalClass(TextAreaField)},3620:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBoxField=void 0;const r=s(5518),o=s(6920);class TextBoxField extends r.Field{}t.TextBoxField=TextBoxField,o.Helper.registerGlobalClass(TextBoxField)},1002:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Form=void 0;const r=s(5106),o=s(7534);class Form extends r.Model{constructor(){super(...arguments),this.dataSources=[],this.fields=[]}init(){this.createDataSources();for(const e of this.getData().fields){const t=o.Helper.getGlobalClass(e.class);if(!t)throw new Error(`no ${e.class} class`);const s=new t(e,this);s.init(),this.fields.push(s)}}deinit(){this.deinitDataSources();for(const e of this.fields)e.deinit();super.deinit()}fillDefaultValues(e){for(const t of this.fields)t.fillDefaultValue(e)}onDataSourceRefresh(e){this.emit("refresh",e)}onDataSourceInsert(e){this.getPage().onFormInsert(e),this.emit("insert",e)}onDataSourceUpdate(e){this.emit("update",e)}onDataSourceDelete(e){this.emit("delete",e)}async update(){if(console.debug("Form.update",this.getFullName(),this.isChanged()),this.getPage().deinited)throw new Error("page already deinited");if(!this.isChanged()&&!this.getDefaultDataSource().hasNewRows())throw new Error(`form model not changed or does not have new rows: ${this.getFullName()}`);await this.getDefaultDataSource().update()}isChanged(){return this.getDefaultDataSource().isChanged()}hasNew(){return this.getDefaultDataSource().hasNew()}async rpc(e,t){if(console.debug("Form.rpc",this.getFullName(),e,t),!e)throw new Error("no name");const s=await this.getApp().request("POST",{action:"rpc",uuid:this.getApp().getAttr("uuid"),page:this.getPage().getName(),form:this.getName(),name:e,params:t});if(s.errorMessage)throw new Error(s.errorMessage);return s}getKey(){return null}getDefaultDataSource(){const e=this.getDataSource("default");if(!e)throw new Error(`${this.getFullName()}: no default data source`);return e}getPage(){return this.getParent()}getApp(){return this.getPage().getApp()}async refresh(){await this.getDefaultDataSource().refresh()}findField(e){return this.fields.find((t=>t.getName()===e))}getField(e){const t=this.findField(e);if(!t)throw new Error(`${this.getFullName()}: no field ${e}`);return t}hasDefaultPersistentDataSource(){return this.getDefaultDataSource().isPersistent()}decodeRow(e){const t={};for(const s of this.fields){const r=s.getAttr("column");r&&(t[r]=s.getValue(e))}return t}}t.Form=Form},4169:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowForm=void 0;const r=s(1002),o=s(6920);class RowForm extends r.Form{init(){super.init(),this.isNewMode()&&this.getDefaultDataSource().newRow(this.createRow()),this.fillParams(this.getRow())}isNewMode(){const e=this.getAttr("newMode");return"true"===e||"false"!==e&&this.getPage().isNewMode()}fillParams(e){for(const t of this.fields)t.valueToPageParams(e)}onDataSourceUpdate(e){this.fillParams(this.getRow()),super.onDataSourceUpdate(e)}onDataSourceInsert(e){this.fillParams(this.getRow()),super.onDataSourceInsert(e)}getRow(e=!1){return this.getDefaultDataSource().getSingleRow(e)}getKey(){const e=this.getDefaultDataSource();if(e.isPersistent()){const t=this.getRow();return e.getRowKey(t)}return null}createRow(){const e={};return this.fillDefaultValues(e),e}discard(e=[]){console.debug("RowForm.discard",e),this.getDefaultDataSource().isChanged()&&(this.getDefaultDataSource().discard(),e.forEach((e=>{this.getField(e).valueToPageParams(this.getRow())})))}}t.RowForm=RowForm,o.Helper.registerGlobalClass(RowForm)},8184:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableForm=void 0;const r=s(1002),o=s(6920);class TableForm extends r.Form{}t.TableForm=TableForm,o.Helper.registerGlobalClass(TableForm)},5106:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Model=void 0;const r=s(5982),o=s(6920);class Model extends r.EventEmitter{constructor(e,t){if(!e.name)throw new Error("name required for model");super(),this.data=e,this.parent=t,this.deinited=!1}init(){}deinit(){if(this.deinited)throw new Error(`${this.getFullName()}: model already deinited`);this.deinited=!0}static getAttr(e,t){return e[t]}static getCol(e,t){return e[t]}static getName(e){return Model.getAttr(e,"name")}static getClassName(e){return Model.getAttr(e,"class")}isAttr(e){return this.data.hasOwnProperty(e)}getAttr(e){return this.data[e]}getCol(e){return this.data[e]}getClassName(){return this.getAttr("class")}getName(){return this.getAttr("name")}getFullName(){return this.parent?`${this.parent.getFullName()}.${this.getName()}`:this.getName()}getCaption(){return this.getAttr("caption")}findDataSource(e){return this.dataSources.find((t=>t.getName()===e))}getDataSource(e){const t=this.findDataSource(e);if(!t)throw new Error(`${this.getFullName()}: no data source ${e}`);return t}createDataSources(){for(const e of this.data.dataSources)try{const t=o.Helper.getGlobalClass(e.class);if(!t)throw new Error(`no ${e.class} class`);const s=new t(e,this);s.init(),this.dataSources.push(s)}catch(t){throw t.message=`${this.getFullName()}.${e.name}: ${t.message}`,t}}deinitDataSources(){for(const e of this.dataSources)e.deinit()}hasActions(){return this.data.actions.length>0}getParent(){if(!this.parent)throw new Error("np parent");return this.parent}getData(){return this.data}}t.Model=Model},5377:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Page=void 0;const r=s(5106),o=s(3677),i=s(6920),a=s(4169),n=s(8978);class Page extends r.Model{constructor(e,t,s){super(e,t),this.options=s,this.dataSources=[],this.forms=[],this.params={},s.onCreate&&s.onCreate(this)}init(){this.createDataSources(),this.createForms(),(0,n.debug)("page options:",this.options),(0,n.debug)("page params:",this.getParams())}deinit(){if(this.deinited)throw new Error(`page ${this.getFullName()} is already deinited`);this.deinitDataSources(),this.deinitForms(),super.deinit()}getOptions(){return this.options}createForms(){for(const e of this.getData().forms){const t=i.Helper.getGlobalClass(r.Model.getClassName(e));if(!t)throw new Error(`no ${r.Model.getClassName(e)} class`);const s=new t(e,this);s.init(),this.forms.push(s)}}deinitForms(){for(const e of this.forms)e.deinit()}getParams(){return Object.assign(Object.assign({},this.options.params||{}),this.params)}setParam(e,t){this.params[e]=void 0!==t?t:null}async update(){(0,n.debug)("Page.update",this.getFullName());for(const e of this.forms)(e.isChanged()||e.hasNew())&&await e.update()}discard(){(0,n.debug)("Page.discard",this.getFullName());for(const e of this.forms)e instanceof a.RowForm&&e.discard()}getKey(){for(const e of this.forms)if("RowForm"===e.getClassName())return e.getKey();return null}hasRowFormWithDefaultDs(){for(const e of this.forms)if("RowForm"===e.getClassName()&&e.getDefaultDataSource())return!0;return!1}hasRowFormWithDefaultSqlDataSource(){for(const e of this.forms)if("RowForm"===e.getClassName()&&e.hasDefaultPersistentDataSource())return!0;return!1}hasRowForm(){for(const e of this.forms)if("RowForm"===e.getClassName()&&"true"===e.getAttr("visible"))return!0;return!1}hasTableForm(){for(const e of this.forms)if("TableForm"===e.getClassName()&&"true"===e.getAttr("visible"))return!0;return!1}isNewMode(){return!!this.options.newMode}hasNew(){for(const e of this.forms)if(e.hasNew())return!0;return!1}getApp(){return this.getParent()}isModal(){return!!this.options.modal}onFormInsert(e){(0,n.debug)("Page.onFormInsert",e);for(const t of e.inserts){const e=o.DataSource.keyToParams(t);for(const t in e)this.setParam(t,e[t])}}async rpc(e,t){if(!e)throw new Error("no name");const s=await this.getApp().request("POST",{action:"rpc",uuid:this.getApp().getAttr("uuid"),page:this.getName(),name:e,params:t});if(s.errorMessage)throw new Error(s.errorMessage);return s}findForm(e){return this.forms.find((t=>t.getName()===e))}getForm(e){const t=this.findForm(e);if(!t)throw new Error(`${this.getFullName()}: no form ${e}`);return t}isSelectMode(){return!!this.options.selectMode}isFormInTab(){return this.isAttr("formInTab")&&"true"===this.getAttr("formInTab")}}t.Page=Page,i.Helper.registerGlobalClass(Page)},1166:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Table=void 0;const r=s(5106),o=s(7340),i=s(6920);class Table extends r.Model{constructor(){super(...arguments),this.columns=[]}init(){for(const e of this.getData().columns){const t=new o.Column(e,this);t.init(),this.addColumn(t)}}addColumn(e){this.columns.push(e)}getColumn(e){const t=this.columns.find((t=>t.getName()===e));if(!t)throw new Error(`table ${this.getFullName()}: no column ${e}`);return t}emitResult(e,t=null){return console.debug("Table.emitResult"),[...e.insert?[this.emitInsert(t,e.insert)]:[],...e.update?[this.emitUpdate(t,e.update)]:[],...e.delete?[this.emitDelete(t,e.delete)]:[],...e.refresh?[this.emitRefresh(t)]:[]]}emitInsert(e,t){return this.emit("insert",{source:e,inserts:t})}emitUpdate(e,t){return this.emit("update",{source:e,updates:t})}emitDelete(e,t){return this.emit("delete",{source:e,deletes:t})}emitRefresh(e){return this.emit("refresh",{source:e})}}t.Table=Table,i.Helper.registerGlobalClass(Table)},4847:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(3677),t),o(s(5377),t),o(s(1002),t),o(s(4169),t),o(s(8184),t),o(s(1839),t),o(s(9362),t),o(s(3620),t),o(s(2751),t),o(s(2693),t),o(s(8341),t),o(s(4769),t),o(s(7606),t),o(s(962),t),o(s(4926),t),o(s(8446),t),o(s(5220),t),o(s(1410),t),o(s(3861),t),o(s(8954),t),o(s(1166),t),o(s(7340),t),o(s(1709),t)},2668:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewerFrontHostApp=void 0;const o=r(s(6405)),i=s(7274),a=s(2686),n=s(7534),l=s(2599),c=s(7066);s(2625),s(4804),s(7401),s(2016),s(2876),s(1290),s(237),s(618),s(9641),s(9448),s(7063),s(6672),s(7992),s(4194),s(854),s(2180),s(4454),s(4548);class ViewerFrontHostApp extends n.FrontHostApp{constructor(e){if(!e.data)throw new Error("ViewerFrontHostApp: no data");super(e),this.options=e,this.applicationController=null}async run(){console.debug("ViewerFrontHostApp.run",this.getData());const e=new i.Application(this.getData());e.init();const t=this.applicationController=a.ApplicationController.create(e,this);t.init();const s=`.${t.getViewClass().name}__root`,r=document.querySelector(s);if(!r)throw new Error(`no root element: ${s}`);t.createView(r);try{await t.connect()}catch(e){this.logError(e)}}async onWindowPopState(e){await this.applicationController.onWindowPopState(e)}logError(e){console.error("FrontHostApp.logError",e);const t={type:"error",source:"client",message:e.message,stack:e.stack,data:JSON.stringify({href:window.location.href,platformVersion:this.getData().versions.platform,appVersion:this.getData().versions.app},null,4)};console.debug(`POST ${this.getData().logErrorUrl}`,t),fetch(this.getData().logErrorUrl,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).catch((e=>{console.error(e.message)}))}getData(){if(!this.options.data)throw new Error("no data");return this.options.data}alert(e){return console.debug("ViewerFrontHostApp.alert",e),new Promise(((t,s)=>{try{const r=document.querySelector(".alert-root");if(!r)throw new Error("no .alert-root");if(0===r.childElementCount){const s=this.alertCtrl=new l.AlertController(Object.assign(Object.assign({},e),{onClose:()=>{this.alertCtrl=null,o.default.unmountComponentAtNode(r),t()}}));n.Helper.createReactComponent(r,s.getViewClass(),{ctrl:s,key:0})}else s(new Error("alert already exists"))}catch(e){s(e)}}))}confirm(e){return console.debug("ViewerFrontHostApp.confirm",e),new Promise(((t,s)=>{try{const r=document.querySelector(".alert-root");if(!r)throw new Error("no .alert-root");if(0===r.childElementCount){const s=this.alertCtrl=new c.ConfirmController(Object.assign(Object.assign({},e),{onClose:e=>{this.alertCtrl=null,o.default.unmountComponentAtNode(r),t(e)}}));n.Helper.createReactComponent(r,s.getViewClass(),{ctrl:s})}else s(new Error("confirm already exists"))}catch(e){s(e)}}))}}t.ViewerFrontHostApp=ViewerFrontHostApp,n.Helper.registerGlobalClass(ViewerFrontHostApp)},3563:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketClient=void 0;t.WebSocketClient=class WebSocketClient{constructor(e={}){if(this.options=e,!e.applicationController)throw new Error("no options.applicationController");if(!e.protocol)throw new Error("no options.protocol");this.url=`${e.protocol}://${window.location.host}/?${this.createUriParamsString(e)}`,this.webSocket=null,this.refreshTimeoutId=null,this.RECONNECT_TIMEOUT=10,this.REFRESH_TIMEOUT=3600}createUriParamsString(e){const t={route:e.route,uuid:e.uuid,userId:e.userId,version:this.getApp().getModel().getData().versions.app};return Object.keys(t).map((e=>`${e}=${encodeURIComponent(t[e])}`)).join("&")}connect(){return console.debug("WebSocketClient.connect",this.url),new Promise(((e,t)=>{this.webSocket=new WebSocket(this.url),this.webSocket.onclose=async e=>{this.webSocket=null,t(new Error(`Connection failed ${e.code}`))},this.webSocket.onopen=t=>{this.webSocket.onclose=this.onClose.bind(this),this.webSocket.onmessage=this.onMessage.bind(this),this.startRefreshTimeout(),e(t)}}))}async onRefreshTimeout(){this.refreshTimeoutId=null,this.send("ping"),this.startRefreshTimeout()}send(e){console.debug("WebSocketClient.send",e),this.webSocket.send(e)}startRefreshTimeout(){this.refreshTimeoutId=setTimeout(this.onRefreshTimeout.bind(this),1e3*this.REFRESH_TIMEOUT)}resetRefreshTimeout(){this.refreshTimeoutId&&(clearTimeout(this.refreshTimeoutId),this.refreshTimeoutId=null)}async reconnect(){console.debug("WebSocketClient.reconnect");try{await this.connect()}catch(e){console.error(e),console.debug(`waiting ${this.RECONNECT_TIMEOUT} sec for socket reconnect...`),setTimeout((async()=>await this.reconnect()),1e3*this.RECONNECT_TIMEOUT)}}async onClose(e){console.error("WebSocketClient.onClose",e),this.getApp().getHostApp().logError(new Error(`websocket close ${this.getApp().getModel().getDomain()}/${this.getApp().getModel().getName()}`)),this.resetRefreshTimeout(),this.webSocket.onclose=null,this.webSocket.onmessage=null,this.webSocket=null,await this.reconnect()}async onMessage(e){console.debug("WebSocketClient.onMessage",JSON.parse(e.data));const t=JSON.parse(e.data);"result"===t.type&&(this.getApp().getView().disableRerender(),await this.getApp().getModel().emitResult(t.data),this.getApp().getView().enableRerender(),this.getApp().getView().rerender())}getApp(){return this.options.applicationController}}},9249:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(9274),t),o(s(2668),t),o(s(4847),t),o(s(3375),t)},4432:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(2855),t),o(s(6224),t),o(s(7756),t),o(s(2851),t)},2855:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyToKeyTuple=t.keyTupleToKey=void 0;t.keyTupleToKey=e=>JSON.stringify(e);t.keyToKeyTuple=e=>JSON.parse(e)},3986:e=>{"use strict";e.exports=require("body-parser")},4357:e=>{"use strict";e.exports=require("colors")},3211:e=>{"use strict";e.exports=require("colors/safe")},9710:e=>{"use strict";e.exports=require("cookie-parser")},9632:e=>{"use strict";e.exports=require("ejs")},6860:e=>{"use strict";e.exports=require("express")},6508:e=>{"use strict";e.exports=require("express-session")},4230:e=>{"use strict";e.exports=require("glob")},8013:e=>{"use strict";e.exports=require("mongodb")},2744:e=>{"use strict";e.exports=require("mysql")},4809:e=>{"use strict";e.exports=require("node-fetch")},5900:e=>{"use strict";e.exports=require("pg")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},8684:e=>{"use strict";e.exports=require("react-dom/server")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2488:e=>{"use strict";e.exports=require("slash")},5828:e=>{"use strict";e.exports=require("uuid")},5352:e=>{"use strict";e.exports=require("ws")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")},4147:e=>{"use strict";e.exports=JSON.parse('{"name":"qforms","version":"0.30.0","description":"A fullstack framework/platform based on Express and React for building Web UI for databases.","main":"dist/index.js","files":["dist"],"dependencies":{"body-parser":"^1.19.1","colors":"^1.4.0","cookie-parser":"^1.4.6","ejs":"~3.1.7","express":"^4.17.2","express-session":"^1.17.2","glob":"^5.0.5","mongodb":"^4.13.0","mysql":"^2.18.1","node-fetch":"^2.6.7","pg":"^8.11.0","react":"^17.0.2","react-dom":"^17.0.2","slash":"^1.0.0","uuid":"^8.3.2","ws":"^2.3.1"},"devDependencies":{"@babel/cli":"^7.16.0","@babel/core":"^7.16.5","@babel/plugin-proposal-class-properties":"^7.16.5","@babel/plugin-transform-react-jsx":"^7.16.5","@babel/preset-react":"^7.18.6","@types/cookie-parser":"^1.4.3","@types/express":"^4.17.14","@types/express-session":"^1.17.6","@types/glob":"^8.1.0","@types/jest":"^29.4.0","@types/mysql":"^2.15.21","@types/node":"^14.18.34","@types/node-fetch":"^2.6.4","@types/pg":"^8.6.6","@types/react":"^17.0.52","@types/react-dom":"^17.0.18","@types/slash":"^3.0.0","@types/uuid":"^9.0.2","@types/ws":"^8.5.5","@typescript-eslint/eslint-plugin":"^5.45.1","@typescript-eslint/parser":"^5.45.1","babel-loader":"^9.1.0","babel-preset-react-app":"^3.1.2","chai":"^3.2.0","copy-webpack-plugin":"^11.0.0","css-loader":"^6.7.3","del":"^1.2.1","eslint":"^8.29.0","eslint-config-airbnb":"^19.0.4","eslint-config-airbnb-typescript":"^17.0.0","eslint-config-prettier":"^8.6.0","eslint-plugin-import":"^2.26.0","eslint-plugin-jsx-a11y":"^6.6.1","eslint-plugin-prettier":"^4.2.1","eslint-plugin-react":"^7.31.11","eslint-plugin-react-hooks":"^4.6.0","gulp":"^4.0.2","gulp-babel":"^8.0.0","gulp-clean-css":"^4.3.0","gulp-concat":"^2.6.0","gulp-hash-filename":"^3.0.0","gulp-less":"^4.0.1","gulp-minify":"^3.1.0","gulp-sourcemaps":"^3.0.0","gulp-typescript":"^6.0.0-alpha.1","gulp-uglify":"^3.0.2","jest":"^29.4.3","less-loader":"^11.1.0","mini-css-extract-plugin":"^2.7.2","nodemon":"^2.0.20","null-loader":"^4.0.1","prettier":"^2.8.4","should":"^7.0.4","terser-webpack-plugin":"^5.3.6","through":"^2.3.8","ts-jest":"^29.0.5","ts-loader":"^9.3.1","typescript":"^4.9.3","webpack":"^5.74.0","webpack-cli":"^4.10.0","webpack-node-externals":"^3.0.0"},"scripts":{"build":"npx gulp build-dev","start":"NODE_ENV=development node dist/start.js","start:apps":"NODE_ENV=development QFORMS_LOG_LEVEL=log APPS_DIR_PATH=~/projects/qforms-apps node dist/start.js","nodemon-start":"NODE_ENV=development nodemon --watch dist --watch apps dist/start.js","webpack-back-index":"NODE_ENV=development webpack --config webpack.config.back.index.js","webpack-back-start":"NODE_ENV=development webpack --config webpack.config.back.start.js","webpack-front-index":"NODE_ENV=development webpack --config webpack.config.index.js","webpack-front-monitor":"NODE_ENV=development webpack --config webpack.config.monitor.js","webpack-front-editor":"NODE_ENV=development webpack --config webpack.config.editor.js","webpack-front-editor-watch":"NODE_ENV=development webpack --config webpack.config.editor.js --watch","webpack-front-viewer":"NODE_ENV=development webpack --config webpack.config.viewer.js","webpack-front-viewer-watch":"NODE_ENV=development webpack --config webpack.config.viewer.js --watch","docker:build":"npx gulp docker-build","docker:run":"npx gulp docker-run","prettier:write":"npx prettier --write \\"src/**/*.{ts,tsx,less}\\"","test":"jest --coverage","build:prod":"npx gulp build-prod","tsc-build":"tsc --build tsconfig.back.json","tsc-build-watch":"tsc --build tsconfig.back.json --watch"},"repository":{"type":"git","url":"https://github.com/alexn1/qforms.git"},"keywords":["web","ui","database"],"author":{"name":"Alexander Nesterenko","email":"alex140@gmail.com","url":"https://github.com/alexn1"},"license":"MIT","bugs":{"url":"https://github.com/alexn1/qforms/issues"},"homepage":"https://github.com/alexn1/qforms"}')},7526:e=>{"use strict";e.exports=JSON.parse('{"login":{"login":"Login","username":"Username","password":"Password","signIn":"Sign in","WrongUsernameOrPassword":"Wrong username or password"},"application":{"logout":"Logout","error":"Error","alert":"Alert","confirm":"Confirm","versionNotification":"New version is available. Please refresh page."},"page":{"create":"Create","cancel":"Cancel","saveAndClose":"Save and close","save":"Save","close":"Close","refresh":"Refresh","discard":"Discard","actions":"Actions","select":"Select","reset":"Reset"},"form":{"refresh":"Refresh","new":"New","delete":"Delete","areYouSure":"Are you sure?","count":"Count","previous":"Previous","next":"Next","edit":"Edit","save":"Save","cancel":"Cancel","discard":"Discard","actions":"Actions","required":"required","phoneNumberFormatError":"phone number format error"},"field":{"selectValue":"select value","fillValue":"fill in this field","timeNotValid":"time not valid","clear":"Clear"},"error":{"notNumber":"not a number","invalidDate":"invalid date"},"confirm":{"yes":"Yes","no":"No"}}')},2964:e=>{"use strict";e.exports=JSON.parse('{"login":{"login":"","signIn":"","username":"","password":"","WrongUsernameOrPassword":"   "},"application":{"logout":"","error":"","alert":"!","confirm":"","versionNotification":"  .   ."},"page":{"create":"","cancel":"","saveAndClose":"  ","save":"","close":"","refresh":"","discard":"","actions":"","select":"","reset":""},"form":{"refresh":"","new":"","delete":"","areYouSure":" ?","count":"","previous":"","next":"","edit":"","save":"","cancel":"","discard":"","actions":"","required":"","phoneNumberFormatError":"  "},"field":{"selectValue":" ","fillValue":" ","timeNotValid":"  ","clear":""},"error":{"notNumber":"  ","invalidDate":"  "},"confirm":{"yes":"","no":""}}')}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(s.exports,s,s.exports,__webpack_require__),s.exports}var __webpack_exports__=__webpack_require__(4432);return __webpack_exports__})()));